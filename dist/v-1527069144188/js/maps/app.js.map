{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsModules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","projectLoaded","projectService","$route","ref","setSection","current","$$route","section","params","pslug","setProjectBySlug","cleanProject","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","template","redirectTo","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","errorHandlingService","httpResponseError","response","nextUrl","search","status","config","cancelable","closeAll","error","url","indexOf","force_next","unauthorized","next","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","redirectToBlockedPage","responseOk","block","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","ljs","load","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","navigationBarService","lightboxService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","getLightboxOpen","preventDefault","start","setAll","addMobileViewport","removeMobileViewport","enableHeader","value","plugin","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","notfound","permissionDenied","q","Base","Service","Controller","DEFAULT_COLOR_LIST","addClass","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","getDefaulColorList","getMatches","getRandomDefaultColor","groupBy","isEmail","isImage","isPdf","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","el","className","classList","add","str","breakTag","replace","object","dependencies","methods","keys","forIn","isFunction","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","sample","clone","string","regex","index","matches","exec","FiltersMixin","PageMixin","UsFiltersMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","project","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","existing","location","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","applyStoredFilters","projectSlug","getFilters","storeFilters","filtersHashSuffix","hash","ns","storage","set","formatSelectedFilters","list","urlIds","invalidAppliedTags","invalidTags","selectedFilters","selectedIds","validAppliedTags","it","find","sit","dataType","color","changeQ","filtersReloadContent","generateFilters","removeFilter","addFilter","newFilter","category","selectCustomFilter","customFilter","saveCustomFilter","urlfilters","assigned_to","owner","epic","filterRemoteStorageService","storeCustomFiltersName","userFilters","removeCustomFilter","milestone","loadFilters","storeFiltersName","userstories","filtersData","assignedTo","customFiltersRaw","selected","statuses","tagsWithAtLeastOneElement","tag","count","full_name","owners","epics","subject","filterQ","translate","content","hideEmpty","totalTaggedElements","customFilters","forOwn","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$routeParams","decodeURIComponent","clear","removeToken","$inject","rootscope","model","http","urls","config1","currentUserService1","themeService","analytics","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","setUserId","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","remove","setToken","token","getToken","auth_token","$broadcast","login","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","templateFn","publicRegisterEnabled","encodeURIComponent","restrict","directive","$window","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","trackEvent","href","onKeyUp","target","currentTarget","iscapsLockActivated","loginFormType","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","_error_message","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","invitation_token","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","onresize","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","create-project-scrum","create-project-kanban","create-project-duplicate","create-project-import","create-project-import-platform","profile","user-profile","blocked-project","project-detail-ref","project-backlog","project-taskboard","project-kanban","project-issues","project-epics","project-search","project-epics-detail","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-list","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-project-values-tags","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-third-parties-gogs","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Autofocus","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LightboxClose","ProjectUrl","Qqueue","QueueModelTransformation","SelectedText","Svg","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","negation","my_permissions","classes","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","qqueue1","repo","model1","setObject","scope1","prop","attrs","cloneDeep","_attrs","_name","getObj","save","transformation","defered","comment","modified","omit","_modifiedAttrs","assign","$templateCache","lodash","tmp","elm","onClose","svgIcon","svgTitle","svgTitleTranslate","svgTitleTranslateValues","$timeout","$parse","$element","ngShow","focus","preload","spinner","src","onLoad","image","Image","onload","transclude","show","prepend","hide","DetailController","navurls","issue","task","us","wikipage","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","reconnectTryInterval","setInterval","Error","sendMessage","cmd","error1","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","create","feedback","finish","open","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","childScope","$new","n","o","estimated_start","subtract","estimated_end","$","$destroy","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","createTask","reset","default_task_status","openNewRelatedTask","$rs","_isEditable","_isVisible","loadTasks","tasks","usId","us_order","showRelatedTasks","avatarService","$ctrl","autoSave","notAutoSave","updateRelatedTask","avatar","member","getAvatar","imgurl","bg","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-myself","user-weekly","user-calendar","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-contact","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","epic-statuses","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","milestones","epic-upvote","epic-downvote","epic-watch","epic-unwatch","epic-related-userstories","epic-related-userstories-bulk-create","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-milestone","bulk-update-us-miles-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","task-filters","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/epic","history/us","history/issue","history/task","history/wiki","attachments/epic","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/epic","custom-attributes/userstory","custom-attributes/task","custom-attributes/issue","custom-attributes-values/epic","custom-attributes-values/userstory","custom-attributes-values/task","custom-attributes-values/issue","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","epics-csv","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","importers-trello-auth-url","importers-trello-authorize","importers-trello-list-projects","importers-trello-list-users","importers-trello-import-project","importers-jira-auth-url","importers-jira-authorize","importers-jira-list-projects","importers-jira-list-users","importers-jira-import-project","importers-github-auth-url","importers-github-authorize","importers-github-list-projects","importers-github-list-users","importers-github-import-project","importers-asana-auth-url","importers-asana-authorize","importers-asana-list-projects","importers-asana-list-users","importers-asana-import-project","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","navUrls","projectService1","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadProject","epicStatusById","epic_statuses","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","parseHTML","activeSection","trackPage","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","ref1","uuid","s","g","r","m","createElement","getElementsByTagName","async","parentNode","insertBefore","document","page","action","label","ecViewPlan","plan","plan_id","quantity","position","ecClickPlan","ecListPlans","arg","plans","ecAddToCart","plan_name","plan_price","price","ecConfirmChange","step","ecPurchase","revenue","BindScope","jQuery","CompileHtmlDirective","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableSubjectDirective","ListItemAssignedtoDirective","ListItemEpicStatusDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","UserDisplayDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","picker","Pikaday","destroy","setDate","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner_extra_info","created_date","tgUserId","$modelTransform","deleteWatcher","isEditable","renderWatchers","requiredPerm","watchers","transform","watcherId","watcherIds","revert","pull","$currentUserService","renderAssignedTo","newObj","_isModified","copy","assigned_to_extra_info","assignedObject","fullName","isIocaine","isUnassigned","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","click","tgListitemEpicStatus","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","tgListitemIssueStatus","issueTypeById","domNode","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","append","icon","detailImage","svgContainer","useSVG","createElementNS","setAttributeNS","appendChild","spin","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","RICHTEXT_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","toggleCollapse","requiredEditionPerm","$selectedText","wysiwygService","setFocusAndSelectOnInputField","edit","editable","attributeHtml","getHTML","onSelect","saveCustomRichText","markdown","cancelCustomRichText","tgCustomAttributeValue","customAttributeValue","stopPropagation","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","$setViewValue","mainTemplate","calculateTotalPoints","calculateRoles","$watchCollection","$qqueue","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","offset","top","height","clientHeight","byRefFilter","darkerFilter","defaultFilter","inArray","markdownToHTML","momentFormat","momentFromNow","toMutableFilter","yesNoFilter","defaultValue","without_suffix","fromNow","memoizedMutable","toMutable","js","memoize","List","$filterFilter","cleanRef","substr","luminosity","black","c","j","newColor","white","wysiwigService","$filter","arrayFilter","listItem","AssignedToLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","onEsc","docEl","lightboxContent","not","firstField","activeElement","blur","code","which","$applyAsync","removeAttr","lightboxEl","dispatch","prev","trigger","$attr","visible","$tgrepo","unblock","finishCallback","blocked_note","watch","ngmodel","attachmentsService","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","addAttachment","attachment","deleteAttachment","addTag","inserted","itemtags","projectTags","tags_colors","deleteTag","statusList","usStatusList","attachments","is_archived","createEditUsOpen","team_requirement","client_requirement","promises","upload","file","broadcastEvent","include_attachments","include_tasks","getByRef","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","normalizedString","toUpperCase","visibleUsers","partial","showMore","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","diff","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","scrollTop","left","fadeOut","fadeIn","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsBacklogDirective","LbTagLineDirective","TagsDirective","formatter","parser","isArray","$formatters","$parsers","tgColorizeBacklogTags","COMMA_KEY","ENTER_KEY","autocomplete","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","withoutColors","has","tagsColors","style","fromCharCode","Awesomplete","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","ussToAdd","newSprint","estimated_finish","realClone","sprintsCounter","sprints","__all__","milestonesCounter","openSprints","sortedSprints","closed","uss","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","rs2","modelTransform","backlogOrder","milestonesOrder","disablePagination","firstLoadComplete","showTags","activeFilters","showGraphPlaceholder","displayVelocity","initializeEventHandlers","getShowTags","loadUserstories","loadProjectStats","ussToMove","loadSprints","loadClosedSprints","findIndex","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","loadAllPaginatedUserstories","toggleShowTags","storeShowTags","toggleActiveFilters","toggleVelocityForecasting","visibleUserStories","forecastedStories","stats","defined_points","completedPercentage","total_milestones","calculateForecasting","setMilestonesOrder","len1","results1","user_stories","sprint_order","closedSprints","totalClosedMilestones","closedSprintsById","totalMilestones","totalOpenMilestones","sprintsById","currentSprint","findCurrentSprint","reverse","resetPagination","pageSize","loadingUserstories","storeQueryParams","listUnassigned","header","backlog_order","loadBacklog","backlog_points_sum","current_sum","assigned_points","speed","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","order","usList","newUsIndex","newSprintId","afterDestination","beforeDestination","currentSprintId","len2","len3","len4","len5","len6","modifiedUs","oldSprintId","options","orderField","orderList","p","previous","previousWithTheSameOrder","ref2","setOrders","setPreviousOrders","startIndex","listIt","moveIt","bulkUpdateMilestone","bulkUpdateBacklogOrder","set-orders","updateUserStoryStatus","editUserStory","$event","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","openFilterInit","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","domElement","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","moveToSprintDom","selectedUsDom","toggleClass","shiftKey","elements","nextAll","prevAll","nextUntil","prevUntil","ussToMoveList","sidebar","hideText","showText","filtersSearch","numberOfRoles","roleName","is","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogSortableDirective","deleteElement","drake","initIsBacklog","scroll","dragula","copySortSource","isContainer","contains","moves","container","isChecked","dragMultiple","dragMultipleItems","firstElement","isBacklog","sameContainer","autoScroll","margin","pixels","scrollWhenOutside","down","dragging","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","mode","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","tagsToAdd","sprintId","user_story","createEditTaskOpen","console","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","rs1","q1","taskboardTasksService","openFilter","usTasks","_setMeta","setZoom","zoomLevel","zoom","previousZoomLevel","isFirstLoad","resetFolds","zoomLoading","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","refreshTagsColors","replaceModel","taskMove","onAssignedToChanged","userid","taskModel","loadTaskboard","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","res","completed_points","completed_tasks","setUserstories","sslug","setRolePoints","showPlaceHolder","tasksRaw","editTask","getTask","getIn","editingTask","oldStatusId","moveUpdateData","getTaskModel","move","status__is_archived","set_orders","assignOrders","addNewTask","toggleFold","changeTaskAssignedTo","getPoint","getRole","pointsByRole","poitnId","tableBodyDom","tableHeaderDom","scrollLeft","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","ctrl","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","TaskboardSortableDirective","containers","filterError","itemEl","newParentScope","oldParentScope","tdom","$tgConfirm","accepts","cancel","itemIndex","itemTask","newStatusId","newUsId","oldUsId","parentEl","st","TaskboardTasksService","foldStatusChanged","Map","taskId","refreshRawOrder","taskboard_order","invert","findedTask","findedIndex","usItem","taksWithoutMoved","taskByUsStatus","task_id","images","thumbnail_card_url","colorized_tags","KanbanUserstoriesService","userstoriesRaw","archivedStatus","statusHide","usByStatus","addArchivedStatus","isUsInArchivedHiddenStatus","getUsModel","hideStatus","deleteStatus","showStatus","getStatus","toDelete","archived","difference","kanban_order","usByStatusWithoutMoved","moveToEnd","getUs","findedUs","usModel","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanWipLimitDirective","kanbanUserstoriesService1","kanbanUserstoriesService","openArchived","loadUserStoriesForStatus","hideUserStoriesForStatus","editUs","editingUserStory","changeUsAssignedTo","listAll","filteredStatus","loadKanban","newStatus","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","hasArchived","itemUs","userStoriesLoaded","updateTableWidth","folds","kanban","redrawWipLimit","tgKanbanWipLimit","wip_limit","KanbanSortableDirective","EpicDetailController","EpicStatusButtonDirective","EpicStatusDisplayDirective","epicRef","epicref","initializeOnDeleteGoToUrl","epicSubject","epicStatus","statusById","epicDescription","description_html","loadEpic","immutableProject","immutableEpic","epicId","commentModel","neighbors","previousUrl","listInEpic","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","onSelectColor","onSelectColorError","onSelectColorSuccess","is_closed","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","ref3","issueSubject","issueStatus","issueType","typeById","issueSeverity","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","priorityList","issueId","typees","severityes","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","createIssueOpen","default_issue_status","default_issue_type","default_priority","default_severity","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssuesController","IssuesDirective","loadIssues","voting","myFiltersHashSuffix","orderBy","order_by","types","issueStatusList","issueTypes","loadIssuesRequests","models","paginatedBy","addNewIssue","addIssuesInBulk","upVoteIssue","downVoteIssue","getOrderBy","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","svg","finalOrder","newOrder","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","configService","usRef","usref","tribeEnabled","tribeHost","onTimeSet","vm","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","httpParams","kanbanStaus","noMilestone","pick","onTribeInfo","publishDesc","publishTitle","alt","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","filtersQ","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","loadProjects","class","isCurrentUser","WikiDetailController","WikiSummaryDirective","WikiWysiwyg","moveLink","loadWiki","wikiSlug","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","getBySlug","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","splice","saveAll","last_modifier","wikiPage","attachmentsFullService","wikiHistoryService","uploadFile","editableDescription","saveDescription","loadHistoryEntries","uploadFiles","files","storageKey","WikiNavDirective","linkWikiLinks","addWikiLinkPermission","deleteWikiLinkPermission","direction","mirrorContainer","linkId","parents","newLink","loadPromise","WikiPagesListController","loadWikiPages","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","confirmService","transferRequest","lightboxService1","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","bindToController","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","canAddUsers","max_memberships","total_memberships","httpFilters","getUrlFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","fetchProject","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvEpicDirective","CsvExporterController","CsvExporterEpicsController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","epicStatusList","issueTypesList","prioritiesList","severitiesList","openDeleteLightbox","privacyChanged","isAttributeModified","newUrl","is_private","initializeFields","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","errorMsg","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectTagsController","ProjectTagsDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","colorList","allowEmpty","tgAllowEmpty","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","mixingClass","cancelMixingTags","confirmMixingTags","toggleMixingFromTags","startMixingTags","editTag","createTag","filterAndSortTags","loadTags","projectTagsAll","tagsFilter","from_tag","to_tag","loadingDelete","mixingTags","toTag","fromTags","loadingMixing","mixTags","initializeMixingTags","initializeTagsFilter","originalTag","loadingEdit","loadingCreate","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","forceLoadProject","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","epicPermissions","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","GogsController","GogsWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","gogs","DeleteProjectDirective","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","ContribController","ContribUserSettingsController","currentPlugin","head","FiltersStorageService","HttpService","cacheFactory","cache","removeAll","locationFactory","lastRoute","Model","ModelService","dataTypes","_dataTypes","setAttrs","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","setAttr","getter","self","setter","enumerable","configurable","isModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","returnHeaders","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","hashSuffix","getQueryParams","editComment","activityId","commentData","getCommentHistory","deleteComment","undeleteComment","history","listInAllProjects","project_id","bulk_issues","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","mdrender","listByUser","bulkCreateMemberships","invitation_extra_text","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_epics_csv_uuid","regenerate_userstories_csv_uuid","regenerate_tasks_csv_uuid","regenerate_issues_csv_uuid","from_tags","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","isPrivate","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","u","hashSuffixUsRowModes","userStoryId","milestone_id","bulk_tasks","bulkUpdateTaskTaskboardOrder","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","page_size","status_id","bulk_stories","milestoneId","bulkUpdateKanbanOrder","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AssignedItemDirective","AssignedToSelectorController","assigned","_getAssignedMember","_filterAssignedMember","assignedMember","nonAssignedMembers","AssignedToSelectorDirective","onRemoveAssigned","onAssignTo","AssignedToController","has_permissions","_closeAndRemoveAssigned","_closeAndAssign","onSelectAssignedTo","on-remove-assigned","on-assign-to","assignTo","AttachmentLinkDirective","attachmentsPreviewService","tgAttachmentLink","fileId","AttachmentGalleryDirective","onDelete","AttachmentController","is_deprecated","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","dataTransfer","originalEvent","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","uploading","from_comment","oldIndex","setIn","oldAttachment","AttachmentsPreviewController","getCurrent","hasPagination","getIndex","attachmentIndex","findLast","AttachmentPreviewLightboxDirective","AttachmentsPreviewService","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","AutoSelectDirective","AvatarDirective","attributeName","tgAvatarBig","avatarBig","BelongToEpicsDirective","isIterable","immutable_epics","BindCode","$sce","wysiwygCodeHightlighterService","compile","tElement","tAttrs","tgBindCodeGetter","tgBindCodeWatch","tgBindCode","$$addBindingClass","$$addBindingInfo","getTrustedHtml","addHightlighter","BoardZoomDirective","levels","CardSlideshowController","cardSlideshowDirective","CardController","hasTasks","hasVisibleAttachments","onToggleFold","getClosedTasks","closedTasksPercent","getPermissionsKey","_setVisibility","related","slides","isRelatedTasksVisible","isSlideshowVisible","getNavKey","cardDirective","onClickAssignedTo","onClickEdit","ClickInputFile","inputFile","ColorSelectorController","checkIsColorRequired","displayColorList","userCanChangeColor","isColorRequired","dropRight","setColor","customColor","resetColor","initColor","toggleColorList","onSelectDropdownColor","onKeyDown","ColorSelectorDirective","_timeout","mouseenter","mouseleave","StoryHeaderController","loadingSubject","originalSubject","saveSubject","_checkNav","_checkPermissions","editSubject","onEditSubjectError","onEditSubjectSuccess","DetailHeaderDirective","FileChangeDirective","tgFileChange","FilterRemoteStorageService","myFilters","innerPromise","FilterSlideDownDirective","ngIf","contentHeight","wrapperHeight","outerHeight","context","nextSibling","max-height","FilterController","opened","customFilterForm","customFilterName","toggleFilterCategory","filterName","isOpen","onSaveCustomFilter","onChangeQ","onRemoveFilter","filterCategory","onAddFilter","onRemoveCustomFilter","onSelectCustomFilter","isFilterSelected","FilterDirective","filtersForm","$dirty","defaultQ","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","checkPermissionsService","getConfig","dashboard","steps","backlog","check","joyRide","joyRides","KanbanBoardZoomDirective","getZoomView","zooms","zoomIndex","onZoomChange","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","menu","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","fixed","TagOptionDirective","containerHeight","selectedPosition","onSelectTag","colorArray","TagLineCommonController","tagLineService","disableColorSelection","newTag","_createColorsArray","projectTagColors","createColorsArray","displayTagInput","addNewTag","onAddTag","selectColor","TagLineCommonDirective","tagName","loadingAddTag","loadingRemoveTag","onDeleteTag","TagLineController","onDeleteTagError","onDeleteTagSuccess","onAddTagError","onAddTagSuccess","TagLineDirective","TagLineService","myPermissions","projectPermissions","TagDirective","hasPermissions","TaskboardZoomDirective","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","TribeButtonDirective","locationService","port","TribeLinkedDirective","gigTitle","gigId","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","CommentEditWysiwyg","CommentWysiwyg","saveComment","onAddComment","onChange","CustomFieldEditWysiwyg","ItemWysiwyg","WysiwygCodeHightlighterService","Prism","plugins","customClass","prefix","getLanguages","languages","getJSON","_languages_","getLanguageInClassList","lan","loadLanguage","replaceCodeBrToNl","replaceWith","hightlightCode","highlightElement","codes","WysiwygCodeLightbox","textarea","querySelector","codeLanguage","onSave","WysiwygMentionService","cancelablePromise","searchEmoji","filteredEmojis","searchEmojiByName","searchUser","searchProps","searchItem","searchTypes","items","mention","Medium","wysiwygMentionService","AlignRightButton","CodeButton","CustomPasteHandler","addCodeBlockAndHightlight","getIcon","getRangeCodeBlock","isCodeBlockSelected","oldIsBlockContainer","refreshCodeBlocks","removeCodeBlockAndHightlight","removeSelections","removeAllRanges","endContainer","parentsUntil","mediumInstance","pre","innerText","replaceChild","checkContentChanged","extract","startContainer","insertAfter","extractContents","mainChildren","preList","innerHTML","removeChild","querySelectorAll","setAttribute","nextElementSibling","nodeName","MediumEditor","extensions","button","toolbar","buttons","contentDefault","handleClick","getButton","getSelectionRange","commonAncestorContainer","textAlign","execCommand","tagNames","getExtensionByName","hideToolbar","paste","doPaste","pastedHTML","pastedPlain","replaceing","clipboardData","reader","FileReader","util","insertHTMLCommand","readAsDataURL","ftype","img","getElementById","htmlEntities","isBlockContainer","cancelWithConfirmation","change","clean","codeBlockSelected","discardLocalStorage","editorMarkdown","editorMedium","getCurrentContent","isDraft","isEditOnly","isOutdated","localSave","notPersist","saveEnd","setEditMode","setHtmlMedium","throttleChange","updateMarkdownWithCurrentHtml","uploadEnd","editonly","codeEditorVisible","codeLans","loadEmojis","saveSnippet","codePre","saving","outdated","onCancel","pasteHTML","store","getMarkdown","throttle","imageDragging","placeholder","autolist","AutoList","alignright","mediumMention","MentionExtension","getItems","mentionCb","changeMarkdown","getAttribute","onUploadFile","currentCodeLanguage","unwatchLoader","WysiwygService","emojis","setEmojiImagePath","getEmojiById","getEmojiByName","replaceImgsByEmojiName","emoji","emojiId","emojiIds","regexImgs","replaceEmojiNameByImgs","pipeLinks","p1","linkParams","replaceUrls","links","createTextNode","searchWikiLinks","removeTrailingListBr","cleanIssueConverter","codeLanguageConverter","node","firstChild","textContent","toMarkdown","gfm","converters","parseMentionMatches","prevChar","serviceName","tagBuilder","charAt","lastIndex","groupIndex","Autolinker","Mention","matchedText","autoLinkHTML","autolinker","matchRegexStr","matcher","matcherRegexes","twitter","hashtag","replaceFn","profileUrl","getType","getMention","getHashtag","parseMatches","md","breaks","markdownit","markdownitLazyHeaders","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","CreateEpicController","epicsService","newEpic","default_epic_status","createEpic","validateForm","onCreateEpic","setFormErrors","CreateEpicDirective","errors","EpicRowController","displayUserStories","displayAssignedTo","displayStatusList","loadingStatus","_calculateProgressBar","progress","canEditEpics","toggleUserStoryList","listRelatedUserStories","epicStories","updateStatus","updateEpicStatus","updateAssignedTo","assignLoader","updateEpicAssignedTo","EpicRowDirective","EpicsDashboardController","setfn","isEpicsDashboardEnabled","fetchEpics","notFound","canCreateEpics","on-create-epic","EpicsSortableDirective","tgEpicsSortable","EpicsTableController","displayOptions","displayVotes","votes","_disablePagination","_loadingEpics","toggleEpicTableOptions","reorderEpic","nextPage","hoverEpicTableOption","timer","hideEpicTableOption","updateViewOptions","EpicsTableDirective","StoryRowController","totalTasksCompleted","story","StoryRowDirective","EpicsService","resources","xhrError","_epics","_page","epicData","withoutMoved","fromPairs","epics_order","reorder","reorderRelatedUserstory","epicUserstories","userstoryId","replaceEpic","RelatedUserStoriesController","showCreateRelatedUserstoriesLightbox","showRelatedUserStoriesSection","userCanSort","loadRelatedUserstories","RelatedUserstoriesCreateController","projectUserstories","filterUss","selectedProjectId","filterText","excludeIds","filteredData","saveRelatedUserStory","selectedUserstoryId","onSavedRelatedUserstory","validateExistingUserstoryForm","setExistingUserstoryFormErrors","addRelatedUserstory","bulkCreateRelatedUserStories","userstoriesText","onCreatedRelatedUserstory","validateNewUserstoryForm","setNewUserstoryFormErrors","RelatedUserstoriesCreateDirective","existingUserstoryForm","newUserstoryForm","showLightbox","selectProject","selectedUserstory","searchUserstory","relatedUserstoriesText","selectedProject","onUpdateSearchUserstory","RelatedUserstoriesSortableDirective","tgRelatedUserstoriesSortable","RelatedUserStoriesDirective","RelatedUserstoryRowController","setAvatarData","getAssignedToFullNameDisplay","onDeleteRelatedUserstory","deleteRelatedUserstory","RelatedUserstoryRowDirective","ExternalAppController","externalAppsService","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","CommentController","permissionService","hiddenDeletedComment","showDeletedComment","hideDeletedComment","checkCancelComment","onEditMode","commentId","canEditDeleteComment","pk","onEditComment","displayCommentHistory","CommentDirective","editing","deleting","onDeleteComment","onRestoreDeletedComment","CommentsController","initializePermissions","canAddCommentPermission","CommentsDirective","comments","LightboxDisplayHistoricController","_loadHistoric","commentHistoryEntries","LightboxDisplayHistoricDirective","HistoryEntryDirective","entry","HistoryTabsDirective","showCommentTab","showActivityTab","onActiveComments","onActiveActivities","onOrderComments","activeTab","commentsNum","activitiesNum","onReverse","HistorySectionController","viewComments","_loadHistory","_getComments","_getActivities","activities","values_diff","showHistorySection","toggleEditMode","onActiveHistoryTab","restoreDeletedComment","addComment","HistorySectionDirective","ActivitiesDiffController","diffTags","diffRemoveTags","diffAddTags","HistoryDiffDirective","HistoryDirective","DutyDirective","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","_getValidDutiesAndAttachProjectInfo","watching","objType","duties","dutyType","getWorkInProgress","assignedEpicsPromise","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_epics","params_issues","params_tasks","params_uss","projectsPromise","watchingEpicsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","status__is_closed","HomeProjectListDirective","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","InviteMembersFormController","rolesValues","defaultMaxInvites","_areRolesValidated","roleIds","contactsToInvite","emailsToInvite","_checkLimitMemberships","pendingMembersCount","membersLimit","showWarningMessage","sendInvites","setInvitedContacts","role_id","inviteContactsMessage","InviteMembersFormDirective","onDisplayContactList","onRemoveInvitedContact","onRemoveInvitedEmail","onSendInvites","AddMembersController","userService","displayContactList","_getContacts","excludeProjectId","getContacts","_filterContacts","invited","contact","inviteSuggested","removeContact","testEmptyContacts","inviteEmail","emailData","removeEmail","LightboxAddMembersDirective","SuggestAddMembersController","contactQuery","filterContacts","filteredContacts","setInvited","onInviteSuggested","SuggestAddMembersDirective","onInviteEmail","DropdownProjectListDirective","newProject","DropdownUserDirective","authService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","supportUrl","NavigationBarService","enabledHeader","ProfileBarController","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileCalendarController","ProfileLikedController","ProfileReadyController","ProfileVotedController","ProfileWatchedController","ProfileWeeklyController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByEpics","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showEpicsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","tabName","getLiked","getVoted","getWatched","getMySelf","getWeekly","_getUrl","getCalendarUrl","loadUrl","loadDocs","docs","ProfileCalendarDirective","ProfileLikedDirective","ProfileReadyDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileWeeklyDirective","base1","base2","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","userFullName","userUsername","BlockedProjectExplanationDirective","ContactProjectButtonController","launchContactForm","ContactProjectButtonDirective","layout","ContactProjectLbController","contactProject","sendingFeedback","ContactProjectLbDirective","inject","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","AsanaImportProjectFormController","canCreatePublicProjects","canCreatePrivateProjects","projectForm","platformName","keepExternalReference","project_type","checkUsersLimit","limitMembersPrivateProject","canAddMembersPrivateProject","limitMembersPublicProject","canAddMembersPublicProject","saveForm","onSaveProjectDetails","canCreateProject","isDisabled","AsanaImportProjectFormDirective","onCancelForm","fetchingUsers","AsanaImportController","asanaImportService","importProjectService","projectUsers","startProjectSelector","fetchProjects","onSelectProject","fetchUsers","onCancelMemberSelection","startImport","importProject","importPromise","submitUserSelection","AsanaImportDirective","AsanaImportService","asanaImporter","listProjects","listUsers","userBindings","projectType","getAuthUrl","authUrl","authorize","CreatetProjectFormController","projectUrl","creation_template","formSubmitLoading","CreateProjectFormDirective","createProjectMembersRestrictionsDirective","createProjectRestrictionsDirective","CreateProjectController","displayScrumDesc","displayKanbanDesc","displayHelp","DuplicateProjectController","refreshReferenceProject","getProjectBySlug","referenceProject","invitedMembers","toggleInvitedMember","duplicate","DuplicateProjectDirective","GithubImportProjectFormController","GithubImportProjectFormDirective","GithubImportController","githubImportService","GithubImportDirective","GithubImportService","githubImporter","callbackUri","ImportProjectMembersController","selectImportUserLightbox","warningImportUsers","displayEmailSelector","cancelledUsers","selectedUsers","selectableUsers","userContacts","fetchUser","refreshSelectableUsers","searchingUser","beforeSubmitUsers","confirmUser","externalUser","taigaUser","discardSuggestedUser","unselectUser","getSelectedMember","isMemberSelected","userSelected","showSuggestedMatch","getDistinctSelectedTaigaUsers","ids","importMoreUsersDisabled","isImportMoreUsersDisabled","ImportProjectMembersDirective","platform","ImportProjectSelectorController","ImportProjectSelectorDirective","noProjectsMsg","ImportTaigaController","importTaiga","ImportTaigaDirective","LbImportErrorDirective","ImportProjectController","trelloService","jiraService","githubService","asanaService","tgNavUrls","asanaOauthToken","githubOauthToken","jiraOauthToken","jiraOauthVerifier","locationSearch","trelloOauthToken","from","cancelCurrentImport","oauth_verifier","oauth_token","jiraUrl","err","absUrl","unfoldOptions","unfoldedOptions","isActiveImporter","backToCreate","ImportProjectDirective","onCancelImport","ImportProjectService","importSuccess","importError","restrictionError","getRestrictionError","error_message","errorKey","maxMemberships","membersError","privateError","publicError","InviteMembersController","InviteMembersDirective","onToggleInvitedMember","SingleMemberDirective","disabled","JiraImportProjectFormController","importer_type","create_subissues","JiraImportProjectFormDirective","JiraImportController","jiraImportService","JiraImportDirective","JiraImportService","jiraImporter","importerType","SelectImportUserLightboxCtrl","invalid","assignUser","onSelectUser","userEmail","SelectImportUserLightboxDirective","TrelloImportProjectFormController","TrelloImportProjectFormDirective","TrelloImportController","trelloImportService","TrelloImportDirective","TrelloImportService","trelloImporter","verifyCode","WarningUserImportDirective","onConfirm","ProjectsListingController","ProjectController","activeMembers","ProjectsService","getProjectStats","paginate","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","loadingAccept","loadingReject","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","bulk_userstories","AsanaResource","GithubResource","JiraResource","TrelloResource","users_bindings","keep_external_reference","jira_url","projectTemplate","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceProperty","warn","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","exclude_project","user_id","getProfileTimeline","getUserTimeline","listAllInProject","epicIid","getWikiHistory","wikiHistory","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","metas","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","AvatarService","modulo","COLORS","IMAGES","logos","getDefault","murmurhash3_32_gc","getUnnamed","avatarParamName","gravatar","logoUrl","photo","root","gravatar_id","CheckPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","totalMembers","membersResult","ErrorHandlingService","errorHandling","showingError","blocked","LightboxFactory","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","ProjectService","userActivityService","interval","_project","_section","_sectionsBreadcrumb","_activeMembers","e2e","autoRefresh","intervalId","onInactive","onActive","ThemeService","themeName","stylesheetEl","UserActivityService","resetTimer","subscriptionsActive","subscriptionsInactive","isActive","startTimer","idleTimeout","timerId","_fireInactive","_fireActive","_unSubscriptionsActive","_unSubscriptionsInactive","UserService","pageNumber","objectType","textQuery","contactsFiltered","contactId","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","description_diff","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","related_us_name","epic_name","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","span","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","moveInBacklog","deleteIn","_addEntyAttributes","filterNot","IsolateClickDirective","WikiHistoryDiffDirective","WikiHistoryEntryDirective","singleHistoryEntry","historyEntry","WikiHistoryController","historyEntries","initializeHistoryEntries","setWikiId","WikiHistoryDirective","WikiHistoryService","_wikiId","_historyEntries"],"mappings":"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","file":"../app.js","sourcesContent":["\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsModules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ],\n        projectLoaded: [\n          \"$q\", \"tgProjectService\", \"$route\", function($q, projectService, $route) {\n            var deferred, ref;\n            deferred = $q.defer();\n            projectService.setSection((ref = $route.current.$$route) != null ? ref.section : void 0);\n            if ($route.current.params.pslug) {\n              projectService.setProjectBySlug($route.current.params.pslug).then(deferred.resolve);\n            } else {\n              projectService.cleanProject();\n              deferred.resolve();\n            }\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/new\", {\n      title: \"PROJECT.CREATE.TITLE\",\n      templateUrl: \"projects/create/create-project.html\",\n      loader: true,\n      controller: \"CreateProjectCtrl\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/new/scrum\", {\n      title: \"PROJECT.CREATE.TITLE\",\n      template: \"<tg-create-project-form type=\\\"scrum\\\"></tg-create-project-form>\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/new/kanban\", {\n      title: \"PROJECT.CREATE.TITLE\",\n      template: \"<tg-create-project-form type=\\\"kanban\\\"></tg-create-project-form>\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/new/duplicate\", {\n      title: \"PROJECT.CREATE.TITLE\",\n      template: \"<tg-duplicate-project></tg-duplicate-project>\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/new/import/:platform?\", {\n      title: \"PROJECT.CREATE.TITLE\",\n      template: \"<tg-import-project></tg-import-project>\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/t/:ref\", {\n      loader: true,\n      controller: \"DetailController\",\n      template: \"\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/epics\", {\n      section: \"epics\",\n      templateUrl: \"epics/dashboard/epics-dashboard.html\",\n      loader: true,\n      controller: \"EpicsDashboardCtrl\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/epic/:epicref\", {\n      templateUrl: \"epic/epic-detail.html\",\n      loader: true,\n      section: \"epics\"\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki-list\", {\n      templateUrl: \"wiki/wiki-list.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/tags\", {\n      templateUrl: \"admin/admin-project-values-tags.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gogs\", {\n      templateUrl: \"admin/admin-third-parties-gogs.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      templateUrl: \"error/not-found.html\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService, errorHandlingService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl, search;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          errorHandlingService.error();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = $location.url();\n          search = $location.search();\n          if (search.force_next) {\n            $location.url($navUrls.resolve(\"login\")).search(\"force_next\", search.force_next);\n          } else {\n            $location.url($navUrls.resolve(\"login\")).search({\n              \"unauthorized\": true,\n              \"next\": nextUrl\n            });\n          }\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", \"tgErrorHandlingService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, errorHandlingService) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        return errorHandlingService.block();\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"tgErrorHandlingService\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    if (lang !== 'en') {\n      ljs.load((\"/\" + window._version + \"/locales/moment-locales/\") + lang + \".js\");\n    }\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, loaderService, navigationBarService, errorHandlingService, lightboxService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    $rootscope.$on('$locationChangeStart', function(event) {\n      errorHandlingService.init();\n      if (lightboxService.getLightboxOpen().length) {\n        event.preventDefault();\n        return lightboxService.closeAll();\n      }\n    });\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  pluginsModules = _.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  });\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"taigaHistory\", \"taigaWikiHistory\", \"taigaEpics\", \"taigaUtils\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\", \"ui.bootstrap.datetimepicker\"].concat(pluginsModules);\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgLoader\", \"tgNavigationBarService\", \"tgErrorHandlingService\", \"lightboxService\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.errorHandlingService.notfound();\n        } else if (xhr.status === 403) {\n          this.errorHandlingService.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var DEFAULT_COLOR_LIST, addClass, bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, getDefaulColorList, getMatches, getRandomDefaultColor, groupBy, isEmail, isImage, isPdf, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  addClass = function(el, className) {\n    if (el.classList) {\n      return el.classList.add(className);\n    } else {\n      return el.className += ' ' + className;\n    }\n  };\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0 && _.isFunction(value)) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm|svg|psd)/i) !== null;\n  };\n\n  isEmail = function(name) {\n    return (name != null) && name.match(/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/) !== null;\n  };\n\n  isPdf = function(name) {\n    return name.match(/\\.(pdf)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  DEFAULT_COLOR_LIST = ['#fce94f', '#edd400', '#c4a000', '#8ae234', '#73d216', '#4e9a06', '#d3d7cf', '#fcaf3e', '#f57900', '#ce5c00', '#729fcf', '#3465a4', '#204a87', '#888a85', '#ad7fa8', '#75507b', '#5c3566', '#ef2929', '#cc0000', '#a40000', '#222222'];\n\n  getRandomDefaultColor = function() {\n    return _.sample(DEFAULT_COLOR_LIST);\n  };\n\n  getDefaulColorList = function() {\n    return _.clone(DEFAULT_COLOR_LIST);\n  };\n\n  getMatches = function(string, regex, index) {\n    var match, matches;\n    index || (index = 1);\n    matches = [];\n    match = null;\n    while (match = regex.exec(string)) {\n      if (index === -1) {\n        matches.push(match);\n      } else {\n        matches.push(match[index]);\n      }\n    }\n    return matches;\n  };\n\n  taiga = this.taiga;\n\n  taiga.addClass = addClass;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.isEmail = isEmail;\n\n  taiga.isPdf = isPdf;\n\n  taiga.patch = patch;\n\n  taiga.getRandomDefaultColor = getRandomDefaultColor;\n\n  taiga.getDefaulColorList = getDefaulColorList;\n\n  taiga.getMatches = getMatches;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, UsFiltersMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    FiltersMixin.prototype.applyStoredFilters = function(projectSlug, key) {\n      var filters;\n      if (_.isEmpty(this.location.search())) {\n        filters = this.getFilters(projectSlug, key);\n        if (Object.keys(filters).length) {\n          this.location.search(filters);\n          this.location.replace();\n          return true;\n        }\n      }\n      return false;\n    };\n\n    FiltersMixin.prototype.storeFilters = function(projectSlug, params, filtersHashSuffix) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = taiga.generateHash([projectSlug, ns]);\n      return this.storage.set(hash, params);\n    };\n\n    FiltersMixin.prototype.getFilters = function(projectSlug, filtersHashSuffix) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = taiga.generateHash([projectSlug, ns]);\n      return this.storage.get(hash) || {};\n    };\n\n    FiltersMixin.prototype.formatSelectedFilters = function(type, list, urlIds) {\n      var invalidAppliedTags, invalidTags, selectedFilters, selectedIds, validAppliedTags;\n      selectedIds = urlIds.split(',');\n      selectedFilters = _.filter(list, function(it) {\n        return selectedIds.indexOf(_.toString(it.id)) !== -1;\n      });\n      invalidTags = _.filter(selectedIds, function(it) {\n        return !_.find(selectedFilters, function(sit) {\n          return _.toString(sit.id) === it;\n        });\n      });\n      invalidAppliedTags = _.map(invalidTags, function(it) {\n        return {\n          id: it,\n          key: type + \":\" + it,\n          dataType: type,\n          name: it\n        };\n      });\n      validAppliedTags = _.map(selectedFilters, function(it) {\n        return {\n          id: it.id,\n          key: type + \":\" + it.id,\n          dataType: type,\n          name: it.name,\n          color: it.color\n        };\n      });\n      return invalidAppliedTags.concat(validAppliedTags);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n  UsFiltersMixin = (function() {\n    function UsFiltersMixin() {}\n\n    UsFiltersMixin.prototype.changeQ = function(q) {\n      this.replaceFilter(\"q\", q);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.removeFilter = function(filter) {\n      this.unselectFilter(filter.dataType, filter.id);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.addFilter = function(newFilter) {\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.selectCustomFilter = function(customFilter) {\n      this.replaceAllFilters(customFilter.filter);\n      this.filtersReloadContent();\n      return this.generateFilters();\n    };\n\n    UsFiltersMixin.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      filters.epic = urlfilters.epic;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName).then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.storeCustomFiltersName).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    UsFiltersMixin.prototype.removeCustomFilter = function(customFilter) {\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName).then((function(_this) {\n        return function(userFilters) {\n          delete userFilters[customFilter.id];\n          _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.storeCustomFiltersName).then(_this.generateFilters);\n          return _this.generateFilters();\n        };\n      })(this));\n    };\n\n    UsFiltersMixin.prototype.generateFilters = function(milestone) {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), this.storeFiltersName);\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.epic = urlfilters.epic;\n      loadFilters.q = urlfilters.q;\n      if (milestone) {\n        loadFilters.milestone = milestone;\n      }\n      return this.q.all([this.rs.userstories.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, this.storeCustomFiltersName)]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, epic, owner, selected, statuses, tags, tagsWithAtLeastOneElement;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          epic = _.map(data.epics, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n              it.name = \"#\" + it.ref + \" \" + it.subject;\n            } else {\n              it.id = \"null\";\n              it.name = \"Not in an epic\";\n            }\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.epic) {\n            selected = _this.formatSelectedFilters(\"epic\", epic, loadFilters.epic);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.EPIC\"),\n              dataType: \"epic\",\n              content: epic\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    return UsFiltersMixin;\n\n  })();\n\n  taiga.UsFiltersMixin = UsFiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams', '$tgAuth'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams, $auth) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        if (!$routeParams['force_login']) {\n          url = $navUrls.resolve(\"home\");\n          if ($routeParams['next']) {\n            url = decodeURIComponent($routeParams['next']);\n            $location.search('next', null);\n          }\n          if ($routeParams['unauthorized']) {\n            $auth.clear();\n            $auth.removeToken();\n          } else {\n            $location.url(url);\n          }\n        }\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\", \"$tgAnalytics\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config1, translate, currentUserService1, themeService, analytics) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config1;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      this.analytics = analytics;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        this.currentUserService.setUser(this.userData);\n      } else {\n        this.userData = null;\n      }\n      return this.analytics.setUserId();\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          _this.rootscope.$broadcast(\"auth:refresh\", user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          _this.rootscope.$broadcast(\"auth:login\", user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      this._setLocales();\n      this.rootscope.$broadcast(\"auth:logout\");\n      return this.analytics.setUserId();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          _this.rootscope.$broadcast(\"auth:register\", user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['force_next']) {\n        nextUrl = encodeURIComponent($routeParams['force_next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate, $window, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      if ($routeParams['force_next']) {\n        $scope.nextUrl = decodeURIComponent($routeParams['force_next']);\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        $analytics.trackEvent(\"auth\", \"login\", \"user login\", 1);\n        if ($scope.nextUrl.indexOf('http') === 0) {\n          return $window.location.href = $scope.nextUrl;\n        } else {\n          return $location.url($scope.nextUrl);\n        }\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      $scope.onKeyUp = function(event) {\n        var target, value;\n        target = angular.element(event.currentTarget);\n        value = target.val();\n        $scope.iscapsLockActivated = false;\n        if (value !== value.toLowerCase()) {\n          return $scope.iscapsLockActivated = true;\n        }\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", \"$window\", \"$tgAnalytics\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        if ($scope.nextUrl.indexOf('http') === 0) {\n          return $window.location.href = $scope.nextUrl;\n        } else {\n          return $location.url($scope.nextUrl);\n        }\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", \"$window\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $config, $params, $navUrls, $analytics, $translate, config) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        $scope.invitation = invitation;\n        return $scope.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType;\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          data = $scope.dataLogin;\n          promise = $auth.login({\n            username: data.username,\n            password: data.password,\n            invitation_token: data.token\n          }, loginFormType);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgConfig\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              $location.path($navUrls.resolve(\"home\"));\n              return $location.replace();\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n          $location.replace();\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/project/new\",\n    \"create-project-scrum\": \"/project/new/scrum\",\n    \"create-project-kanban\": \"/project/new/kanban\",\n    \"create-project-duplicate\": \"/project/new/duplicate\",\n    \"create-project-import\": \"/project/new/import\",\n    \"create-project-import-platform\": \"/project/new/import/:platform\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-detail-ref\": \"/project/:project/t/:ref\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-epics\": \"/project/:project/epics\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-epics-detail\": \"/project/:project/epic/:ref\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-list\": \"/project/:project/wiki-list\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-project-values-tags\": \"/project/:project/admin/project-values/tags\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-third-parties-gogs\": \"/project/:project/admin/third-parties/gogs\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Autofocus, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LightboxClose, ProjectUrl, Qqueue, QueueModelTransformation, SelectedText, Svg, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      if (project.toJS) {\n        project = project.toJS();\n      }\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  QueueModelTransformation = (function(superClass) {\n    extend(QueueModelTransformation, superClass);\n\n    QueueModelTransformation.$inject = [\"$tgQqueue\", \"$tgRepo\", \"$q\", \"$tgModel\"];\n\n    function QueueModelTransformation(qqueue1, repo, q, model1) {\n      this.qqueue = qqueue1;\n      this.repo = repo;\n      this.q = q;\n      this.model = model1;\n    }\n\n    QueueModelTransformation.prototype.setObject = function(scope1, prop) {\n      this.scope = scope1;\n      this.prop = prop;\n    };\n\n    QueueModelTransformation.prototype.clone = function() {\n      var attrs, model;\n      attrs = _.cloneDeep(this.scope[this.prop]._attrs);\n      model = this.model.make_model(this.scope[this.prop]._name, attrs);\n      return model;\n    };\n\n    QueueModelTransformation.prototype.getObj = function() {\n      return this.scope[this.prop];\n    };\n\n    QueueModelTransformation.prototype.save = function(transformation) {\n      var defered;\n      defered = this.q.defer();\n      this.qqueue.add((function(_this) {\n        return function() {\n          var clone, comment, modified, obj, success;\n          obj = _this.getObj();\n          comment = obj.comment;\n          obj.comment = '';\n          clone = _this.clone();\n          modified = _.omit(obj._modifiedAttrs, ['version']);\n          clone = _.assign(clone, modified);\n          transformation(clone);\n          if (comment.length) {\n            clone.comment = comment;\n          }\n          success = function() {\n            _this.scope[_this.prop] = clone;\n            return defered.resolve.apply(null, arguments);\n          };\n          return _this.repo.save(clone).then(success, defered.reject);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    return QueueModelTransformation;\n\n  })(taiga.Service);\n\n  module.service(\"$tgQueueModelTransformation\", QueueModelTransformation);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function() {\n    var template;\n    template = \"<tg-svg class=\\\"capslock\\\" ng-if=\\\"capslockIcon && iscapsLockActivated\\\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgCapslock\", [Capslock]);\n\n  LightboxClose = function() {\n    var link, template;\n    template = \"<a class=\\\"close\\\" ng-click=\\\"onClose()\\\" href=\\\"\\\" title=\\\"{{'COMMON.CLOSE' | translate}}\\\">\\n    <tg-svg svg-icon=\\\"icon-close\\\"></tg-svg>\\n</a>\";\n    link = function(scope, elm, attrs) {};\n    return {\n      scope: {\n        onClose: '&'\n      },\n      link: link,\n      template: template\n    };\n  };\n\n  module.directive(\"tgLightboxClose\", [LightboxClose]);\n\n  Svg = function() {\n    var template;\n    template = \"<svg class=\\\"{{ 'icon ' + svgIcon }}\\\">\\n    <use xlink:href=\\\"\\\" ng-attr-xlink:href=\\\"{{ '#' + svgIcon }}\\\">\\n        <title ng-if=\\\"svgTitle\\\">{{svgTitle}}</title>\\n        <title ng-if=\\\"svgTitleTranslate\\\">{{svgTitleTranslate | translate: svgTitleTranslateValues}}</title>\\n    </use>\\n</svg>\";\n    return {\n      scope: {\n        svgIcon: \"@\",\n        svgTitle: \"@\",\n        svgTitleTranslate: \"@\",\n        svgTitleTranslateValues: \"=\"\n      },\n      template: template\n    };\n  };\n\n  module.directive(\"tgSvg\", [Svg]);\n\n  Autofocus = function($timeout, $parse, animationFrame) {\n    return {\n      restrict: 'A',\n      link: function($scope, $element, attrs) {\n        var model;\n        if (attrs.ngShow) {\n          model = $parse(attrs.ngShow);\n          return $scope.$watch(model, function(value) {\n            if (value === true) {\n              return $timeout(function() {\n                return $element[0].focus();\n              });\n            }\n          });\n        } else {\n          return $timeout(function() {\n            return $element[0].focus();\n          });\n        }\n      }\n    };\n  };\n\n  module.directive('tgAutofocus', ['$timeout', '$parse', \"animationFrame\", Autofocus]);\n\n  module.directive('tgPreloadImage', function() {\n    var preload, spinner, template;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    template = \"<div>\\n    <ng-transclude></ng-transclude>\\n</div>\";\n    preload = function(src, onLoad) {\n      var image;\n      image = new Image();\n      image.onload = onLoad;\n      image.src = src;\n      return image;\n    };\n    return {\n      template: template,\n      transclude: true,\n      replace: true,\n      link: function(scope, el, attrs) {\n        var image, onLoad, timeout;\n        image = el.find('img:last');\n        timeout = null;\n        onLoad = function() {\n          el.find('.loading-spinner').remove();\n          image.show();\n          if (timeout) {\n            clearTimeout(timeout);\n            return timeout = null;\n          }\n        };\n        return attrs.$observe('preloadSrc', function(src) {\n          if (timeout) {\n            clearTimeout(timeout);\n          }\n          el.find('.loading-spinner').remove();\n          timeout = setTimeout(function() {\n            return el.prepend(spinner);\n          }, 200);\n          image.hide();\n          return preload(src, onLoad);\n        });\n      }\n    };\n  });\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/detail.coffee\n */\n\n(function() {\n  var DetailController, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaCommon\");\n\n  DetailController = (function() {\n    DetailController.$inject = ['$routeParams', '$tgRepo', \"tgProjectService\", \"$tgNavUrls\", \"$location\"];\n\n    function DetailController(params, repo, projectService, navurls, location) {\n      this.params = params;\n      this.repo = repo;\n      this.projectService = projectService;\n      this.navurls = navurls;\n      this.location = location;\n      this.repo.resolve({\n        pslug: this.params.pslug,\n        ref: this.params.ref\n      }).then((function(_this) {\n        return function(result) {\n          var url;\n          if (result.issue) {\n            url = _this.navurls.resolve('project-issues-detail', {\n              project: _this.projectService.project.get('slug'),\n              ref: _this.params.ref\n            });\n          } else if (result.task) {\n            url = _this.navurls.resolve('project-tasks-detail', {\n              project: _this.projectService.project.get('slug'),\n              ref: _this.params.ref\n            });\n          } else if (result.us) {\n            url = _this.navurls.resolve('project-userstories-detail', {\n              project: _this.projectService.project.get('slug'),\n              ref: _this.params.ref\n            });\n          } else if (result.epic) {\n            url = _this.navurls.resolve('project-epics-detail', {\n              project: _this.projectService.project.get('slug'),\n              ref: _this.params.ref\n            });\n          } else if (result.wikipage) {\n            url = _this.navurls.resolve('project-wiki-page', {\n              project: _this.projectService.project.get('slug'),\n              slug: _this.params.ref\n            });\n          }\n          return _this.location.path(url);\n        };\n      })(this));\n    }\n\n    return DetailController;\n\n  })();\n\n  module.controller(\"DetailController\", DetailController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/epics.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaEpics\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.error = false;\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats, reconnectTryInterval;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      reconnectTryInterval = this.config.get(\"eventsReconnectTryInterval\", 10000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.setupConnection();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      this.sendMessage(message);\n      this.startHeartBeatMessages();\n      return this.notifications();\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      this.error = true;\n      return setTimeout(this.setupConnection, this.reconnectTryInterval);\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      this.stopHeartBeatMessages();\n      return setTimeout(this.setupConnection, this.reconnectTryInterval);\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      this.childScope = $scope.$new();\n      $scope.$watch(\"task.estimated_start\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.task.estimated_start = moment($scope.task.estimated_start).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.task.estimated_start = moment($scope.task.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      $scope.$watch(\"task.estimated_end\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.task.estimated_end = moment($scope.task.estimated_end).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.task.estimated_end = moment($scope.task.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        task.estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n        task.estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        this.childScope.$destroy();\n        this.childScope = $scope.$new();\n        $el.off();\n        $el.html($compile(templateEdit({\n          task: task\n        }))(childScope));\n        $el.find(\".task-name input\").val(task.subject);\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $translate, $analytics) {\n    var link, newTask;\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render, reset;\n      createTask = function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        task.estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n        task.estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      };\n      close = function() {\n        $el.off();\n        return $scope.openNewRelatedTask = false;\n      };\n      reset = function() {\n        newTask = {\n          subject: \"\",\n          assigned_to: null\n        };\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        return $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n      };\n      render = function() {\n        if ($scope.openNewRelatedTask) {\n          return;\n        }\n        $scope.openNewRelatedTask = true;\n        return $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              reset();\n              return $el.find('input').focus();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n      };\n      $scope.save = function() {\n        return createTask(newTask).then(function() {\n          return close();\n        });\n      };\n      taiga.bindOnce($scope, \"us\", reset);\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return $scope.$apply(render);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      templateUrl: 'task/related-task-create-form.html'\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$translate\", \"$tgAnalytics\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, function(x) {\n              return [x.us_order, x.ref];\n            });\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate, avatarService) {\n    var link, template;\n    template = _.template(\"<img style=\\\"background-color: <%- bg %>\\\" src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var avatar, ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\")\n        };\n        member = $scope.usersById[task.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = avatar.bg;\n        if (member) {\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $scope.$watch($attrs.tgRelatedTaskAssignedToInlineEdition, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n        return updateRelatedTask(task);\n      });\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", \"tgAvatarService\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-myself\": \"/users/%s/my_self\",\n    \"user-weekly\": \"/calender/weekly\",\n    \"user-calendar\": \"/calender/ics\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-contact\": \"contact\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"epic-statuses\": \"/epic-statuses\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"milestones\": \"/milestones\",\n    \"epics\": \"/epics\",\n    \"epic-upvote\": \"/epics/%s/upvote\",\n    \"epic-downvote\": \"/epics/%s/downvote\",\n    \"epic-watch\": \"/epics/%s/watch\",\n    \"epic-unwatch\": \"/epics/%s/unwatch\",\n    \"epic-related-userstories\": \"/epics/%s/related_userstories\",\n    \"epic-related-userstories-bulk-create\": \"/epics/%s/related_userstories/bulk_create\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-milestone\": \"/userstories/bulk_update_milestone\",\n    \"bulk-update-us-miles-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"bulk-update-us-milestone\": \"/userstories/bulk_update_milestone\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"task-filters\": \"/tasks/filters_data\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/epic\": \"/history/epic\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki/%s\",\n    \"attachments/epic\": \"/epics/attachments\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/epic\": \"/epic-custom-attributes\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes-values/epic\": \"/epics/custom-attributes-values\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"epics-csv\": \"/epics/csv?uuid=%s\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\",\n    \"importers-trello-auth-url\": \"/importers/trello/auth_url\",\n    \"importers-trello-authorize\": \"/importers/trello/authorize\",\n    \"importers-trello-list-projects\": \"/importers/trello/list_projects\",\n    \"importers-trello-list-users\": \"/importers/trello/list_users\",\n    \"importers-trello-import-project\": \"/importers/trello/import_project\",\n    \"importers-jira-auth-url\": \"/importers/jira/auth_url\",\n    \"importers-jira-authorize\": \"/importers/jira/authorize\",\n    \"importers-jira-list-projects\": \"/importers/jira/list_projects\",\n    \"importers-jira-list-users\": \"/importers/jira/list_users\",\n    \"importers-jira-import-project\": \"/importers/jira/import_project\",\n    \"importers-github-auth-url\": \"/importers/github/auth_url\",\n    \"importers-github-authorize\": \"/importers/github/authorize\",\n    \"importers-github-list-projects\": \"/importers/github/list_projects\",\n    \"importers-github-list-users\": \"/importers/github/list_users\",\n    \"importers-github-import-project\": \"/importers/github/import_project\",\n    \"importers-asana-auth-url\": \"/importers/asana/auth_url\",\n    \"importers-asana-authorize\": \"/importers/asana/authorize\",\n    \"importers-asana-list-projects\": \"/importers/asana/list_projects\",\n    \"importers-asana-list-users\": \"/importers/asana/list_users\",\n    \"importers-asana-import-project\": \"/importers/asana/import_project\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgEpicsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate, errorHandlingService, projectService1) {\n      var description, loadSearchData, title;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService1;\n      this.scope.sectionName = \"Search\";\n      this.loadInitialData();\n      title = this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        projectDescription: this.scope.project.description\n      });\n      this.appMetaService.setAll(title, description);\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.epicStatusById = groupBy(project.epic_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.severityById = groupBy(project.severities, function(x) {\n        return x.id;\n      });\n      this.scope.priorityById = groupBy(project.priorities, function(x) {\n        return x.id;\n      });\n      this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n        return x.id;\n      });\n      return project;\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.scope.projectId = project.id;\n      return this.fillUsersAndRoles(project.members, project.roles);\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location, $analytics) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"epics\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        epics: $templatecache.get(\"search-epics\"),\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          $location.search(\"text\", searchTerm);\n        }\n        return $analytics.trackPage($location.url(), \"Search\");\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", \"$tgAnalytics\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"ec\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      this.initialized = true;\n      return this.setUserId();\n    };\n\n    AnalyticsService.prototype.setUserId = function() {\n      var ref, ref1;\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga('set', 'userId', (ref = this.rootscope) != null ? (ref1 = ref.user) != null ? ref1.uuid : void 0 : void 0);\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    AnalyticsService.prototype.ecViewPlan = function(plan) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      this.win.ga('ec:addProduct', {\n        'id': plan.plan_id,\n        'name': plan.name,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'detail');\n      return this.trackEvent(\"ecommerce\", \"view-product-detail\", plan.name, plan.plan_id);\n    };\n\n    AnalyticsService.prototype.ecClickPlan = function(plan) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      this.win.ga('ec:addProduct', {\n        'id': plan.plan_id,\n        'name': plan.name,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'click');\n      return this.trackEvent(\"ecommerce\", \"click-product\", plan.name, plan.plan_id);\n    };\n\n    AnalyticsService.prototype.ecListPlans = function(arg, page) {\n      var i, len, plan, plans, position;\n      plans = arg[0];\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      position = 1;\n      for (i = 0, len = plans.length; i < len; i++) {\n        plan = plans[i];\n        this.win.ga('ec:addImpression', {\n          'id': plan.plan_id,\n          'name': plan.name,\n          'list': page,\n          'position': position\n        });\n        position++;\n      }\n      return this.trackEvent(\"ecommerce\", \"list-plans\");\n    };\n\n    AnalyticsService.prototype.ecAddToCart = function(plan_id, plan_name, plan_price) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      this.win.ga('ec:addProduct', {\n        'id': plan_id,\n        'name': plan_name,\n        'price': plan_price,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'add');\n      return this.trackEvent('ecommerce', 'add-to-cart', 'Collect Payment Info', null);\n    };\n\n    AnalyticsService.prototype.ecConfirmChange = function(plan_id, plan_name, plan_price) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      this.win.ga('ec:addProduct', {\n        'id': plan_id,\n        'name': plan_name,\n        'price': plan_price,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'checkout', {\n        'step': 1\n      });\n      return this.trackEvent(\"ecommerce\", \"start-checkout\", \"start\", 1);\n    };\n\n    AnalyticsService.prototype.ecPurchase = function(plan_id, plan_name, plan_price) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      this.win.ga('ec:addProduct', {\n        'id': plan_id,\n        'name': plan_name,\n        'price': plan_price,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'checkout', {\n        'step': 2\n      });\n      this.trackEvent(\"ecommerce\", \"end-checkout\", \"end\", 2);\n      this.win.ga('ec:addProduct', {\n        'id': plan_id,\n        'name': plan_name,\n        'price': plan_price,\n        'category': \"plans\",\n        'quantity': 1,\n        'position': 1\n      });\n      this.win.ga('ec:setAction', 'purchase', {\n        'id': plan_id,\n        'revenue': plan_price\n      });\n      return this.trackEvent('ecommerce', 'checkout', 'Plan checkout', null);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableSubjectDirective, ListItemAssignedtoDirective, ListItemEpicStatusDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, UserDisplayDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0]\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          if ($el.picker) {\n            $el.picker.destroy();\n          }\n          return initialize();\n        };\n      })(this));\n      $attrs.$observe(\"pickerValue\", function(val) {\n        $el.val(val);\n        if (val != null) {\n          if ($el.picker) {\n            $el.picker.destroy();\n          }\n          initialize();\n        }\n        return $el.picker.setDate(val);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        unbind();\n        return $el.picker.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var avatar, ref;\n        if (model != null) {\n          avatar = avatarService.getAvatar(model.owner_extra_info);\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\")\n          };\n          $scope.owner.avatar = avatar.url;\n          $scope.owner.bg = avatar.bg;\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", \"tgAvatarService\", CreatedByDisplayDirective]);\n\n  UserDisplayDirective = function($template, $compile, $translate, $navUrls, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var avatar, id;\n      id = $attrs.tgUserId;\n      $scope.user = $scope.usersById[id] || {\n        full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\")\n      };\n      avatar = avatarService.getAvatar($scope.usersById[id] || null);\n      $scope.user.avatar = avatar.url;\n      $scope.user.bg = avatar.bg;\n      $scope.url = $scope.user.is_active ? $navUrls.resolve(\"user-profile\", {\n        username: $scope.user.username\n      }) : \"\";\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      scope: true,\n      templateUrl: \"common/components/user-display.html\"\n    };\n  };\n\n  module.directive(\"tgUserDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", \"tgAvatarService\", UserDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $modelTransform, $template, $compile, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(watchers) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watchers;\n          return item;\n        });\n        transform.then(function() {\n          watchers = _.map(watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      deleteWatcher = function(watcherIds) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watcherIds;\n          return item;\n        });\n        transform.then(function() {\n          var item, watchers;\n          item = $modelTransform.getObj();\n          watchers = _.map(item.watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          item.revert();\n          return $confirm.notify(\"error\");\n        });\n      };\n      renderWatchers = function(watchers) {\n        $scope.watchers = watchers;\n        return $scope.isEditable = isEditable();\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        watchers = _.filter(watchers, function(it) {\n          return !!it;\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      templateUrl: \"common/components/watchers.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $modelTransform, $template, $translate, $compile, $currentUserService, avatarService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(userId) {\n        var currentLoading, item, newObj, obj, transform;\n        item = $model.$modelValue.clone();\n        item.assigned_to = userId;\n        currentLoading = $loading().target($el).start();\n        if (!item._isModified) {\n          currentLoading.finish();\n          obj = $scope.usersById[userId];\n          newObj = angular.copy(obj);\n          newObj.assigned_to_extra_info = obj;\n          newObj.assigned_to = obj;\n          delete newObj.assigned_to.assigned_to;\n          delete newObj.assigned_to.assigned_to_extra_info;\n          renderAssignedTo(newObj);\n          $rootscope.$broadcast(\"object:updated\");\n          return newObj;\n        }\n        transform = $modelTransform.save(function(item) {\n          item.assigned_to = userId;\n          return item;\n        });\n        transform.then(function() {\n          currentLoading.finish();\n          renderAssignedTo($modelTransform.getObj());\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      renderAssignedTo = function(assignedObject) {\n        var avatar, bg, ctx, fullName, html, isIocaine, isUnassigned;\n        avatar = avatarService.getAvatar(assignedObject != null ? assignedObject.assigned_to_extra_info : void 0);\n        bg = null;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          isUnassigned = false;\n          bg = avatar.bg;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          avatar: avatar.url,\n          bg: bg,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (!$model.$modelValue) {\n          return;\n        }\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", \"tgAvatarService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $modelTransform, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(subject) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.subject = subject;\n          return item;\n        });\n        transform.then((function(_this) {\n          return function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          };\n        })(this));\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('.edit-subject').hide();\n          return $el.find('.view-subject').show();\n        }\n      });\n      $el.find('.edit-subject').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  ListItemEpicStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var epic;\n      epic = $scope.$eval($attrs.tgListitemEpicStatus);\n      return bindOnce($scope, \"epicStatusById\", function(epicStatusById) {\n        return $el.html(epicStatusById[epic.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemEpicStatus\", ListItemEpicStatusDirective);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate, avatarService) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var avatar, ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\")\n        };\n        member = usersById[item.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = avatar.bg;\n        if (member) {\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", \"tgAvatarService\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      if (title) {\n        el.find(\".title\").text(title);\n      }\n      if (subtitle) {\n        el.find(\".subtitle\").text(subtitle);\n      }\n      if (message) {\n        el.find(\".message\").text(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, svgContainer, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          detailImage = document.createElement(\"div\");\n          taiga.addClass(detailImage, \"icon\");\n          taiga.addClass(detailImage, icon.name);\n          taiga.addClass(detailImage, \"lb-icon\");\n          svgContainer = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage.appendChild(svgContainer).appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message, spin) {\n      var el;\n      if (spin == null) {\n        spin = false;\n      }\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      if (spin) {\n        el.find(\".spin\").removeClass(\"hidden\");\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, RICHTEXT_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  RICHTEXT_TYPE = \"url\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }, {\n      key: RICHTEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_RICHTEXT\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope1, rootscope, repo, rs, confirm, q) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model, hash;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      hash = collapsedHash($attrs.type);\n      $scope.collapsed = $storage.get(hash) || false;\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $scope.toggleCollapse = function() {\n        $scope.collapsed = !$scope.collapsed;\n        return $storage.set(hash, $scope.collapsed);\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService, wysiwygService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, scope, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        scope = $scope.$new();\n        scope.attributeHtml = wysiwygService.getHTML(value);\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)(scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)(scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      $scope.saveCustomRichText = (function(_this) {\n        return function(markdown, callback) {\n          attributeValue.value = markdown;\n          return $ctrl.updateAttributeValue(attributeValue).then(function() {\n            callback();\n            return render(attributeValue, false);\n          });\n        };\n      })(this);\n      $scope.cancelCustomRichText = (function(_this) {\n        return function() {\n          render(attributeValue, false);\n          return null;\n        };\n      })(this);\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      if (attributeValue.value === null || attributeValue.value === void 0) {\n        attributeValue.value = \"\";\n      }\n      $scope.customAttributeValue = attributeValue;\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", \"tgWysiwygService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              loading: false\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile, $modelTransform, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = function(points) {\n        var onError, transform;\n        transform = $modelTransform.save((function(_this) {\n          return function(us) {\n            us.points = points;\n            return us;\n          };\n        })(this));\n        onError = (function(_this) {\n          return function() {\n            return $confirm.notify(\"error\");\n          };\n        })(this);\n        return transform.then(null, onError);\n      };\n      $scope.$watchCollection(function() {\n        return $model.$modelValue && $model.$modelValue.points;\n      }, function() {\n        var estimationProcess, us;\n        us = $model.$modelValue;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            estimationProcess.loading = roleId;\n            estimationProcess.render();\n            return save(points).then(function() {\n              estimationProcess.loading = false;\n              $rootScope.$broadcast(\"object:updated\");\n              return estimationProcess.render();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              loading: estimationProcess.loading\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", \"$tgQueueModelTransformation\", \"$tgConfirm\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $repo, $confirm, $q, $qqueue) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.loading = false;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              deferred.resolve();\n              return _this.render();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            return _this.onSelectedPointForRole(roleId, pointId, points);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgRepo\", \"$tgConfirm\", \"$q\", \"$tgQqueue\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var byRefFilter, darkerFilter, defaultFilter, inArray, markdownToHTML, module, momentFormat, momentFromNow, sizeFormat, taiga, toMutableFilter, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n  toMutableFilter = function() {\n    var memoizedMutable, toMutable;\n    toMutable = function(js) {\n      return js.toJS();\n    };\n    memoizedMutable = _.memoize(toMutable);\n    return function(input) {\n      if (input instanceof Immutable.List) {\n        return memoizedMutable(input);\n      }\n      return input;\n    };\n  };\n\n  module.filter(\"toMutable\", toMutableFilter);\n\n  byRefFilter = function($filterFilter) {\n    return function(userstories, filter) {\n      var cleanRef;\n      if (filter != null ? filter.startsWith(\"#\") : void 0) {\n        cleanRef = filter.substr(1);\n        return _.filter(userstories, (function(_this) {\n          return function(us) {\n            return String(us.ref).startsWith(cleanRef);\n          };\n        })(this));\n      }\n      return $filterFilter(userstories, filter);\n    };\n  };\n\n  module.filter(\"byRef\", [\"filterFilter\", byRefFilter]);\n\n  darkerFilter = function() {\n    return function(color, luminosity) {\n      var black, c, i, j, len, newColor, ref, white;\n      color = new String(color).replace(/[^0-9a-f]/gi, '');\n      if (color.length < 6) {\n        color = color[0] + color[0] + color[1] + color[1] + color[2] + color[2];\n      }\n      luminosity = luminosity || 0;\n      newColor = \"#\";\n      c = 0;\n      i = 0;\n      black = 0;\n      white = 255;\n      ref = [0, 1, 2];\n      for (j = 0, len = ref.length; j < len; j++) {\n        i = ref[j];\n        c = parseInt(color.substr(i * 2, 2), 16);\n        c = Math.round(Math.min(Math.max(black, c + (luminosity * white)), white)).toString(16);\n        newColor += (\"00\" + c).substr(c.length);\n      }\n      return newColor;\n    };\n  };\n\n  module.filter(\"darker\", darkerFilter);\n\n  markdownToHTML = function(wysiwigService) {\n    return function(input) {\n      if (input) {\n        return wysiwigService.getHTML(input);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"markdownToHTML\", [\"tgWysiwygService\", markdownToHTML]);\n\n  inArray = function($filter) {\n    return function(list, arrayFilter, element) {\n      var filter;\n      if (arrayFilter) {\n        filter = $filter(\"filter\");\n        return filter(list, function(listItem) {\n          return arrayFilter.indexOf(listItem[element]) !== -1;\n        });\n      }\n    };\n  };\n\n  module.filter(\"inArray\", [\"$filter\", inArray]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  trim = this.taiga.trim;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q, rootScope) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n      this.rootScope = rootScope;\n    }\n\n    LightboxService.prototype.open = function($el, onClose, onEsc) {\n      var defered, docEl, lightboxContent;\n      this.onClose = onClose;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            var firstField;\n            firstField = $el.find('input,textarea').first();\n            if (firstField.length) {\n              return $el.find('input,textarea').first().focus();\n            } else if (document.activeElement) {\n              return $(document.activeElement).blur();\n            }\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            if (onEsc) {\n              return _this.rootScope.$applyAsync(onEsc);\n            } else {\n              return _this.close($el);\n            }\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          var docEl, scope;\n          if (_.isString($el)) {\n            $el = $($el);\n          }\n          docEl = angular.element(document);\n          docEl.off(\".lightbox\");\n          docEl.off(\".keyboard-navigation\");\n          $el.addClass('close-started');\n          _this.animationFrame.add(function() {\n            $el.addClass('close');\n            return $el.one(\"transitionend\", function() {\n              $el.removeAttr('style');\n              $el.removeClass(\"open\").removeClass('close').removeClass('close-started');\n              if (_this.onClose) {\n                _this.rootScope.$apply(_this.onClose);\n              }\n              return resolve();\n            });\n          });\n          if ($el.hasClass(\"remove-on-close\")) {\n            scope = $el.data(\"scope\");\n            if (scope) {\n              scope.$destroy();\n            }\n            return $el.remove();\n          }\n        };\n      })(this));\n    };\n\n    LightboxService.prototype.getLightboxOpen = function() {\n      return $(\".lightbox.open:not(.close-started)\");\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", \"$rootScope\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      if (!$attrs.$attr.visible) {\n        return $el.on(\"click\", \".close\", function(event) {\n          event.preventDefault();\n          return lightboxService.close($el);\n        });\n      }\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $modelTransform, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = (function(_this) {\n        return function(finishCallback) {\n          var transform;\n          transform = $modelTransform.save(function(item) {\n            item.is_blocked = false;\n            item.blocked_note = \"\";\n            return item;\n          });\n          transform.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            return finishCallback();\n          });\n          transform.then(null, function() {\n            $confirm.notify(\"error\");\n            return item.revert();\n          });\n          transform[\"finally\"](function() {\n            return finishCallback();\n          });\n          return transform;\n        };\n      })(this);\n      block = function() {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\".button-green\")).start();\n        transform = $modelTransform.save(function(item) {\n          item.is_blocked = true;\n          item.blocked_note = $el.find(\".reason\").val();\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          currentLoading.finish();\n          return lightboxService.close($el);\n        });\n      };\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          return unblock(finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return block();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      $scope.$watch(\"us.estimated_start\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.us.estimated_start = moment($scope.us.estimated_start).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.us.estimated_start = moment($scope.us.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      $scope.$watch(\"us.estimated_end\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.us.estimated_end = moment($scope.us.estimated_end).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.us.estimated_end = moment($scope.us.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        attachmentsToAdd = attachmentsToAdd.filter(function(it) {\n          return it.get('name') !== attachment.get('name');\n        });\n        if (attachment.get(\"id\")) {\n          return attachmentsToDelete = attachmentsToDelete.push(attachment);\n        }\n      };\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.us.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([value, color]);\n          return $scope.us.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.us.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.us.tags = itemtags;\n        return _.pull($scope.us.tags, value);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        $scope.createEditUsOpen = true;\n        return lightboxService.open($el, function() {\n          return $scope.createEditUsOpen = false;\n        });\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        $scope.createEditUsOpen = true;\n        return lightboxService.open($el, function() {\n          return $scope.createEditUsOpen = false;\n        });\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, params, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          params = {\n            include_attachments: true,\n            include_tasks: true\n          };\n          $scope.us.estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n          $scope.us.estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us, true);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            return deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this)).then((function(_this) {\n              return function() {\n                currentLoading.finish();\n                lightboxService.close($el);\n                return $rs.userstories.getByRef(data.project, data.ref, params).then(function(us) {\n                  return $rootScope.$broadcast(broadcastEvent, us);\n                });\n              };\n            })(this));\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading, $model) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            result = _.map(result.data, (function(_this) {\n              return function(x) {\n                return $model.make_model('userstories', x);\n              };\n            })(this));\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$tgModel\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users, visibleUsers;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        users = _.sortBy(users, function(o) {\n          if (o.id === $scope.user.id) {\n            return 0;\n          } else {\n            return o.id;\n          }\n        });\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        visibleUsers = _.slice(users, 0, 5);\n        visibleUsers = _.map(visibleUsers, function(user) {\n          return user.avatar = avatarService.getAvatar(user);\n        });\n        if (selected) {\n          if (selected) {\n            selected.avatar = avatarService.getAvatar(selected);\n          }\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", \"tgAvatarService\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile, avatarService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html, visibleUsers;\n        visibleUsers = _.slice(users, 0, 5);\n        visibleUsers = _.map(visibleUsers, function(user) {\n          user.avatar = avatarService.getAvatar(user);\n          return user;\n        });\n        ctx = {\n          selected: false,\n          users: visibleUsers,\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(200, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", \"tgAvatarService\", WatchersLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      open: function() {\n        return open;\n      },\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      priority: 99999,\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      $scope.$watch($attrs.tgRelatedTaskStatus, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskStatus);\n        return updateTaskStatus($el, task, $scope.taskStatusById);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsBacklogDirective, LbTagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsBacklogDirective = function() {\n    var link, template;\n    template = _.template(\"<% _.each(tags, function(tag) { %>\\n    <% if (tag[1] !== null) { %>\\n    <span class=\\\"tag\\\"\\n          style=\\\"border-left: 5px solid <%- tag[1] %>\\\"\\n          title=\\\"<%- tag[0] %>\\\">\\n          <%- tag[0] %>\\n    </span>\\n    <% } %>\\n<% }) %>\\n<% _.each(tags, function(tag) { %>\\n    <% if (tag[1] === null) { %>\\n    <span class=\\\"tag\\\"\\n          title=\\\"<%- tag[0] %>\\\">\\n          <%- tag[0] %>\\n    </span>\\n    <% } %>\\n<% }) %>\");\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(tags) {\n        var html;\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeBacklogTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeBacklogTags\", ColorizeTagsBacklogDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, autocomplete, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    autocomplete = null;\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton, withoutColors;\n      withoutColors = _.has($attrs, \"withoutColors\");\n      renderTags = function(tags, tagsColors) {\n        var color, ctx, html;\n        if (tagsColors == null) {\n          tagsColors = [];\n        }\n        color = !withoutColors ? tagsColors[t] : null;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              style: color ? \"border-left: 5px solid \" + color : \"\"\n            };\n          })\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var input;\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(project.tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit, ussToAdd;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      $scope.newSprint = {};\n      ussToAdd = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.newSprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, estimated_end, estimated_start, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          broadcastEvent = null;\n          estimated_start = $('.date-start').val();\n          estimated_end = $('.date-end').val();\n          if (createSprint) {\n            newSprint = angular.copy($scope.newSprint);\n            newSprint.estimated_start = moment(estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(estimated_end, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint = $scope.newSprint.realClone();\n            newSprint.estimated_start = moment(estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(estimated_end, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $scope.sprints = _.map($scope.sprints, function(it) {\n              if (it.id === data.id) {\n                return data;\n              } else {\n                return it;\n              }\n            });\n            if (broadcastEvent === \"sprintform:create:success\" && ussToAdd) {\n              $rootscope.$broadcast(broadcastEvent, data, ussToAdd);\n            } else {\n              $rootscope.$broadcast(broadcastEvent, data);\n            }\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.newSprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.newSprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.newSprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId, uss) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        ussToAdd = uss;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.newSprint.project = projectId;\n        $scope.newSprint.name = null;\n        $scope.newSprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.newSprint.estimated_start) {\n          estimatedStart = moment($scope.newSprint.estimated_start);\n        }\n        $scope.newSprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.newSprint.estimated_finish) {\n          estimatedFinish = moment($scope.newSprint.estimated_finish);\n        }\n        $scope.newSprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.newSprint = sprint.realClone();\n          $scope.newSprint.estimated_start = moment($scope.newSprint.estimated_start).format(prettyDate);\n          return $scope.newSprint.estimated_finish = moment($scope.newSprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"$tgStorage\", \"tgFilterRemoteStorageService\", \"tgProjectService\"];\n\n    BacklogController.prototype.storeCustomFiltersName = 'backlog-custom-filters';\n\n    BacklogController.prototype.storeFiltersName = 'backlog-filters';\n\n    BacklogController.prototype.backlogOrder = {};\n\n    BacklogController.prototype.milestonesOrder = {};\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2, modelTransform, errorHandlingService, storage, filterRemoteStorageService, projectService) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.backlogOrder = {};\n      this.milestonesOrder = {};\n      this.page = 1;\n      this.disablePagination = false;\n      this.firstLoadComplete = false;\n      this.scope.userstories = [];\n      if (this.applyStoredFilters(this.params.pslug, \"backlog-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.displayVelocity = false;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          _this.firstLoadComplete = true;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.filtersReloadContent = function() {\n      return this.loadUserstories(true);\n    };\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function(e, data, ussToMove) {\n          _this.loadSprints().then(function() {\n            return _this.scope.$broadcast(\"sprintform:create:success:callback\", ussToMove);\n          });\n          _this.loadProjectStats();\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          _this.confirm.notify(\"success\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories(true);\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, data) {\n          var index;\n          index = _.findIndex(_this.scope.userstories, function(us) {\n            return us.id === data.id;\n          });\n          _this.scope.userstories[index] = data;\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadAllPaginatedUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.toggleVelocityForecasting = function() {\n      this.displayVelocity = !this.displayVelocity;\n      if (!this.displayVelocity) {\n        this.scope.visibleUserStories = _.map(this.scope.userstories, function(it) {\n          return it.ref;\n        });\n      } else {\n        this.scope.visibleUserStories = _.map(this.forecastedStories, function(it) {\n          return it.ref;\n        });\n      }\n      return scopeDefer(this.scope, (function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"userstories:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          _this.calculateForecasting();\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.setMilestonesOrder = function(sprints) {\n      var it, j, len, results, sprint;\n      results = [];\n      for (j = 0, len = sprints.length; j < len; j++) {\n        sprint = sprints[j];\n        this.milestonesOrder[sprint.id] = {};\n        results.push((function() {\n          var l, len1, ref1, results1;\n          ref1 = sprint.user_stories;\n          results1 = [];\n          for (l = 0, len1 = ref1.length; l < len1; l++) {\n            it = ref1[l];\n            results1.push(this.milestonesOrder[sprint.id][it.id] = it.sprint_order);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.setMilestonesOrder(sprints);\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.setMilestonesOrder(sprints);\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.openSprints = function() {\n      return _.filter(this.scope.sprints, (function(_this) {\n        return function(sprint) {\n          return !sprint.closed;\n        };\n      })(this)).reverse();\n    };\n\n    BacklogController.prototype.loadAllPaginatedUserstories = function() {\n      var page;\n      page = this.page;\n      return this.loadUserstories(true, this.scope.userstories.length).then((function(_this) {\n        return function() {\n          return _this.page = page;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadUserstories = function(resetPagination, pageSize) {\n      var params, promise;\n      if (resetPagination == null) {\n        resetPagination = false;\n      }\n      if (!this.scope.projectId) {\n        return null;\n      }\n      this.loadingUserstories = true;\n      this.disablePagination = true;\n      params = _.clone(this.location.search());\n      this.rs.userstories.storeQueryParams(this.scope.projectId, params);\n      if (resetPagination) {\n        this.page = 1;\n      }\n      params.page = this.page;\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, params, pageSize);\n      return promise.then((function(_this) {\n        return function(result) {\n          var header, it, j, len, ref1, userstories;\n          userstories = result[0];\n          header = result[1];\n          if (resetPagination) {\n            _this.scope.userstories = [];\n          }\n          _this.scope.userstories = _this.scope.userstories.concat(_.sortBy(userstories, \"backlog_order\"));\n          _this.scope.visibleUserStories = _.map(_this.scope.userstories, function(it) {\n            return it.ref;\n          });\n          ref1 = _this.scope.userstories;\n          for (j = 0, len = ref1.length; j < len; j++) {\n            it = ref1[j];\n            _this.backlogOrder[it.id] = it.backlog_order;\n          }\n          _this.loadingUserstories = false;\n          if (header('x-pagination-next')) {\n            _this.disablePagination = false;\n            _this.page++;\n          }\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]).then(this.calculateForecasting);\n    };\n\n    BacklogController.prototype.calculateForecasting = function() {\n      var backlog_points_sum, current_sum, j, len, ref1, results, stats, total_points, us;\n      stats = this.scope.stats;\n      total_points = stats.total_points;\n      current_sum = stats.assigned_points;\n      backlog_points_sum = 0;\n      this.forecastedStories = [];\n      ref1 = this.scope.userstories;\n      results = [];\n      for (j = 0, len = ref1.length; j < len; j++) {\n        us = ref1[j];\n        current_sum += us.total_points;\n        backlog_points_sum += us.total_points;\n        this.forecastedStories.push(us);\n        if (stats.speed > 0 && backlog_points_sum > stats.speed) {\n          break;\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.is_backlog_activated) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.closedMilestones = !!project.total_closed_milestones;\n      this.scope.$emit('project:loaded', project);\n      this.scope.points = _.sortBy(project.points, \"order\");\n      this.scope.pointsById = groupBy(project.points, function(x) {\n        return x.id;\n      });\n      this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n      return project;\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      this.initializeSubscription();\n      return this.loadBacklog().then((function(_this) {\n        return function() {\n          var milestone;\n          return _this.generateFilters(milestone = \"null\");\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var afterDestination, beforeDestination, currentSprintId, data, it, j, key, l, len, len1, len2, len3, len4, len5, len6, list, m, modifiedUs, n, newSprint, o, oldSprintId, options, orderField, orderList, p, previous, previousWithTheSameOrder, project, promise, q, ref1, ref2, setOrders, setPreviousOrders, sprint, startIndex, us;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      if (oldSprintId) {\n        sprint = this.scope.sprintsById[oldSprintId] || this.scope.closedSprintsById[oldSprintId];\n      }\n      if (newSprintId) {\n        newSprint = this.scope.sprintsById[newSprintId] || this.scope.closedSprintsById[newSprintId];\n      }\n      currentSprintId = newSprintId !== oldSprintId ? newSprintId : oldSprintId;\n      orderList = null;\n      orderField = \"\";\n      if (newSprintId !== oldSprintId) {\n        if (newSprintId === null) {\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            _.remove(sprint.user_stories, function(it) {\n              return it.id === us.id;\n            });\n          }\n          orderField = \"backlog_order\";\n          orderList = this.backlogOrder;\n          beforeDestination = _.slice(this.scope.userstories, 0, newUsIndex);\n          afterDestination = _.slice(this.scope.userstories, newUsIndex);\n          this.scope.userstories = this.scope.userstories.concat(usList);\n        } else {\n          for (l = 0, len1 = usList.length; l < len1; l++) {\n            us = usList[l];\n            _.remove(this.scope.userstories, function(it) {\n              return it.id === us.id;\n            });\n          }\n          orderField = \"sprint_order\";\n          orderList = this.milestonesOrder[newSprint.id];\n          beforeDestination = _.slice(newSprint.user_stories, 0, newUsIndex);\n          afterDestination = _.slice(newSprint.user_stories, newUsIndex);\n          newSprint.user_stories = newSprint.user_stories.concat(usList);\n        }\n      } else {\n        if (oldSprintId === null) {\n          orderField = \"backlog_order\";\n          orderList = this.backlogOrder;\n          list = _.filter(this.scope.userstories, function(listIt) {\n            return !_.find(usList, function(moveIt) {\n              return listIt.id === moveIt.id;\n            });\n          });\n          beforeDestination = _.slice(list, 0, newUsIndex);\n          afterDestination = _.slice(list, newUsIndex);\n        } else {\n          orderField = \"sprint_order\";\n          orderList = this.milestonesOrder[sprint.id];\n          list = _.filter(newSprint.user_stories, function(listIt) {\n            return !_.find(usList, function(moveIt) {\n              return listIt.id === moveIt.id;\n            });\n          });\n          beforeDestination = _.slice(list, 0, newUsIndex);\n          afterDestination = _.slice(list, newUsIndex);\n        }\n      }\n      previous = beforeDestination[beforeDestination.length - 1];\n      setPreviousOrders = [];\n      if (!previous) {\n        startIndex = 0;\n      } else if (previous) {\n        startIndex = orderList[previous.id] + 1;\n        previousWithTheSameOrder = _.filter(beforeDestination, function(it) {\n          return it[orderField] === orderList[previous.id];\n        });\n        if (previousWithTheSameOrder.length > 1) {\n          setPreviousOrders = _.map(previousWithTheSameOrder, function(it) {\n            return {\n              us_id: it.id,\n              order: orderList[it.id]\n            };\n          });\n        }\n      }\n      modifiedUs = [];\n      for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n        us = usList[key];\n        us.milestone = currentSprintId;\n        us[orderField] = startIndex + key;\n        orderList[us.id] = us[orderField];\n        modifiedUs.push({\n          us_id: us.id,\n          order: us[orderField]\n        });\n      }\n      startIndex = orderList[usList[usList.length - 1].id];\n      for (key = n = 0, len3 = afterDestination.length; n < len3; key = ++n) {\n        it = afterDestination[key];\n        orderList[it.id] = startIndex + key + 1;\n      }\n      this.scope.userstories = _.sortBy(this.scope.userstories, (function(_this) {\n        return function(it) {\n          return _this.backlogOrder[it.id];\n        };\n      })(this));\n      this.scope.visibleUserStories = _.map(this.scope.userstories, function(it) {\n        return it.ref;\n      });\n      ref1 = this.scope.sprints;\n      for (o = 0, len4 = ref1.length; o < len4; o++) {\n        sprint = ref1[o];\n        sprint.user_stories = _.sortBy(sprint.user_stories, (function(_this) {\n          return function(it) {\n            return _this.milestonesOrder[sprint.id][it.id];\n          };\n        })(this));\n      }\n      ref2 = this.scope.closedSprints;\n      for (p = 0, len5 = ref2.length; p < len5; p++) {\n        sprint = ref2[p];\n        sprint.user_stories = _.sortBy(sprint.user_stories, (function(_this) {\n          return function(it) {\n            return _this.milestonesOrder[sprint.id][it.id];\n          };\n        })(this));\n      }\n      if (usList.length > 1 && (newSprintId !== oldSprintId)) {\n        data = modifiedUs.concat(setPreviousOrders);\n        promise = this.rs.userstories.bulkUpdateMilestone(project, newSprintId, data);\n      } else if (usList.length > 1) {\n        data = modifiedUs.concat(setPreviousOrders);\n        promise = this.rs.userstories.bulkUpdateBacklogOrder(project, data);\n      } else {\n        setOrders = {};\n        for (q = 0, len6 = setPreviousOrders.length; q < len6; q++) {\n          it = setPreviousOrders[q];\n          setOrders[it.us_id] = it.order;\n        }\n        options = {\n          headers: {\n            \"set-orders\": JSON.stringify(setOrders)\n          }\n        };\n        promise = this.repo.save(usList[0], true, {}, options, true);\n      }\n      promise.then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"sprint:us:moved\");\n          if (_this.scope.closedSprintsById && _this.scope.closedSprintsById[oldSprintId]) {\n            return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      return promise;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.q.all([_this.loadProjectStats(), _this.loadSprints()]);\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin, taiga.UsFiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate, $rs) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, openFilterInit, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if ($scope.displayVelocity) {\n          removeDoomlineDom();\n        }\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0 && ($scope.displayVelocity == null)) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      $scope.$on(\"userstories:forecast\", removeDoomlineDom);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var data, extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        data = _.map(selectedUss, function(us) {\n          return {\n            us_id: us.id,\n            order: us.sprint_order\n          };\n        });\n        $rs.userstories.bulkUpdateMilestone($scope.project.id, $scope.sprints[0].id, data).then((function(_this) {\n          return function() {\n            $ctrl.loadSprints();\n            $ctrl.loadProjectStats();\n            $ctrl.toggleVelocityForecasting();\n            return $ctrl.calculateForecasting();\n          };\n        })(this));\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      $scope.$on(\"sprintform:create:success:callback\", function(e, ussToMove) {\n        return _.partial(moveToCurrentSprint, ussToMove)();\n      });\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n      return $el.on(\"click\", \".forecasting-add-sprint\", function(event) {\n        var ussToMove, ussToMoveList;\n        ussToMoveList = $ctrl.forecastedStories;\n        if ($scope.currentSprint) {\n          ussToMove = _.map(ussToMoveList, function(us, index) {\n            us.milestone = $scope.currentSprint.id;\n            us.order = index;\n            return us;\n          });\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        } else {\n          ussToMove = _.map(ussToMoveList, function(us, index) {\n            us.order = index;\n            return us;\n          });\n          return $rootscope.$broadcast(\"sprintform:create\", $scope.projectId, ussToMove);\n        }\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    openFilterInit = function($scope, $el, $ctrl) {\n      var sidebar;\n      sidebar = $el.find(\"sidebar.backlog-filter\");\n      sidebar.addClass(\"active\");\n      return $ctrl.activeFilters = true;\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.backlog-filter\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      filters = $ctrl.location.search();\n      if (filters.status || filters.tags || filters.q || filters.assigned_to || filters.owner) {\n        openFilterInit($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", \"$tgResources\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-down\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogSortableDirective, bindOnce, deleteElement, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    $(el).scope().$destroy();\n    $(el).off();\n    return $(el).remove();\n  };\n\n  BacklogSortableDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var drake, initIsBacklog, scroll;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        initIsBacklog = false;\n        drake = dragula([$el[0], $('.js-empty-backlog')[0]], {\n          copySortSource: false,\n          copy: false,\n          isContainer: function(el) {\n            return el.classList.contains('sprint-table');\n          },\n          moves: function(item) {\n            if (!$(item).hasClass('row')) {\n              return false;\n            }\n            return true;\n          }\n        });\n        drake.on('drag', function(item, container) {\n          var isChecked, parent;\n          parent = $(item).parent();\n          initIsBacklog = parent.hasClass('backlog-table-body');\n          $(document.body).addClass(\"drag-active\");\n          isChecked = $(item).find(\"input[type='checkbox']\").is(\":checked\");\n          return window.dragMultiple.start(item, container);\n        });\n        drake.on('cloned', function(item) {\n          return $(item).addClass('backlog-us-mirror');\n        });\n        drake.on('dragend', function(item) {\n          var dragMultipleItems, firstElement, index, isBacklog, parent, sameContainer, sprint, usList;\n          parent = $(item).parent();\n          $('.doom-line').remove();\n          parent = $(item).parent();\n          isBacklog = parent.hasClass('backlog-table-body') || parent.hasClass('js-empty-backlog');\n          if (initIsBacklog || isBacklog) {\n            sameContainer = initIsBacklog === isBacklog;\n          } else {\n            sameContainer = $(item).scope().sprint.id === parent.scope().sprint.id;\n          }\n          dragMultipleItems = window.dragMultiple.stop();\n          $(document.body).removeClass(\"drag-active\");\n          sprint = null;\n          firstElement = dragMultipleItems.length ? dragMultipleItems[0] : item;\n          if (isBacklog) {\n            index = $(firstElement).index(\".backlog-table-body .row\");\n          } else {\n            index = $(firstElement).index();\n            sprint = parent.scope().sprint.id;\n          }\n          if (!sameContainer) {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n            if (dragMultipleItems.length) {\n              _.each(dragMultipleItems, function(item) {\n                return deleteElement(item);\n              });\n            } else {\n              deleteElement(item);\n            }\n          } else {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n          }\n          return $scope.$emit(\"sprint:us:move\", usList, index, sprint);\n        });\n        scroll = autoScroll([window], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", BacklogSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".edit-sprint\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch(\"sprint\", function(sprint) {\n        return render(sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(new Date(x.day).getTime());\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton, tagsToAdd;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      $scope.$watch(\"task.estimated_start\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.task.estimated_start = moment($scope.task.estimated_start).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.task.estimated_start = moment($scope.task.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      $scope.$watch(\"task.estimated_end\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return $scope.task.estimated_end = moment($scope.task.estimated_end).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return $scope.task.estimated_end = moment($scope.task.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        attachmentsToAdd = attachmentsToAdd.filter(function(it) {\n          return it.get('name') !== attachment.get('name');\n        });\n        if (attachment.get(\"id\")) {\n          return attachmentsToDelete = attachmentsToDelete.push(attachment);\n        }\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      tagsToAdd = [];\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.task.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([tag, color]);\n          return $scope.task.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.task.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.task.tags = itemtags;\n        return _.pull($scope.task.tags, value);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createEditTaskOpen = false;\n        });\n        return $scope.createEditTaskOpen = true;\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createEditTaskOpen = false;\n        });\n        return $scope.createEditTaskOpen = true;\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, params, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          params = {\n            include_attachments: true,\n            include_tasks: true\n          };\n          $scope.task.estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n          $scope.task.estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD HH:mm:ss\");\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            return deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this)).then((function(_this) {\n              return function() {\n                return $rs.tasks.getByRef(data.project, data.ref, params).then(function(task) {\n                  return $rootscope.$broadcast(broadcastEvent, task);\n                });\n              };\n            })(this));\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService, $model) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            result = _.map(result, (function(_this) {\n              return function(x) {\n                return $model.make_model('tasks', x);\n              };\n            })(this));\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$tgModel\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"tgTaskboardTasks\", \"$tgStorage\", \"tgFilterRemoteStorageService\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, rs2, params1, q1, appMetaService, location, navUrls, events, analytics, translate, errorHandlingService, taskboardTasksService, storage, filterRemoteStorageService) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rs2 = rs2;\n      this.params = params1;\n      this.q = q1;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.taskboardTasksService = taskboardTasksService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      bindMethods(this);\n      this.taskboardTasksService.reset();\n      this.scope.userstories = [];\n      this.openFilter = false;\n      if (this.applyStoredFilters(this.params.pslug, \"tasks-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      taiga.defineImmutableProperty(this.scope, \"usTasks\", (function(_this) {\n        return function() {\n          return _this.taskboardTasksService.usTasks;\n        };\n      })(this));\n    }\n\n    TaskboardController.prototype.firstLoad = function() {\n      var promise;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      return promise.then(null, this.onInitialDataError.bind(this));\n    };\n\n    TaskboardController.prototype.setZoom = function(zoomLevel, zoom) {\n      var previousZoomLevel;\n      if (this.zoomLevel === zoomLevel) {\n        return null;\n      }\n      this.isFirstLoad = !this.zoomLevel;\n      previousZoomLevel = this.zoomLevel;\n      this.zoomLevel = zoomLevel;\n      this.zoom = zoom;\n      if (this.isFirstLoad) {\n        this.firstLoad().then((function(_this) {\n          return function() {\n            _this.isFirstLoad = false;\n            return _this.taskboardTasksService.resetFolds();\n          };\n        })(this));\n      } else if (this.zoomLevel > 1 && previousZoomLevel <= 1) {\n        this.zoomLoading = true;\n        this.loadTasks().then((function(_this) {\n          return function() {\n            _this.zoomLoading = false;\n            return _this.taskboardTasksService.resetFolds();\n          };\n        })(this));\n      }\n      if (this.zoomLevel === '0') {\n        return this.rootscope.$broadcast(\"sprint:zoom0\");\n      }\n    };\n\n    TaskboardController.prototype.changeQ = function(q) {\n      this.replaceFilter(\"q\", q);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.removeFilter = function(filter) {\n      this.unselectFilter(filter.dataType, filter.id);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.addFilter = function(newFilter) {\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.selectCustomFilter = function(customFilter) {\n      this.replaceAllFilters(customFilter.filter);\n      this.loadTasks();\n      return this.generateFilters();\n    };\n\n    TaskboardController.prototype.removeCustomFilter = function(customFilter) {\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters').then((function(_this) {\n        return function(userFilters) {\n          delete userFilters[customFilter.id];\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, 'tasks-custom-filters').then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters').then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, 'tasks-custom-filters').then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), \"tasks-filters\");\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.milestone = this.scope.sprintId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.q = urlfilters.q;\n      return this.q.all([this.rs.tasks.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, 'tasks-custom-filters')]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, owner, selected, statuses, tags, tagsWithAtLeastOneElement;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function(event, tasks) {\n          _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.add(tasks);\n          });\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function(event, task) {\n          _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.add(task);\n          });\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function(event, task) {\n          return _this.refreshTagsColors().then(function() {\n            return _this.taskboardTasksService.replaceModel(task);\n          });\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n    };\n\n    TaskboardController.prototype.onAssignedToChanged = function(ctx, userid, taskModel) {\n      var promise;\n      taskModel.assigned_to = userid;\n      this.taskboardTasksService.replaceModel(taskModel);\n      promise = this.repo.save(taskModel);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.errorHandlingService.permissionDenied();\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors._attrs;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          _this.taskboardTasksService.setUserstories(_this.scope.userstories);\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      var params;\n      params = {};\n      if (this.zoomLevel > 1) {\n        params.include_attachments = 1;\n      }\n      params = _.merge(params, this.location.search());\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId, null, params).then((function(_this) {\n        return function(tasks) {\n          _this.taskboardTasksService.init(_this.scope.project, _this.scope.usersById);\n          return _this.taskboardTasksService.set(tasks);\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          _this.generateFilters();\n          return _this.loadTaskboard().then(function() {\n            return _this.setRolePoints();\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.showPlaceHolder = function(statusId, usId) {\n      if (!this.taskboardTasksService.tasksRaw.length) {\n        if (this.scope.taskStatusList[0].id === statusId && (!this.scope.userstories.length || this.scope.userstories[0].id === usId)) {\n          return true;\n        }\n      }\n      return false;\n    };\n\n    TaskboardController.prototype.editTask = function(id) {\n      var task;\n      task = this.taskboardTasksService.getTask(id);\n      task = task.set('loading', true);\n      this.taskboardTasksService.replace(task);\n      return this.rs.tasks.getByRef(task.getIn(['model', 'project']), task.getIn(['model', 'ref'])).then((function(_this) {\n        return function(editingTask) {\n          return _this.rs2.attachments.list(\"task\", task.get('id'), task.getIn(['model', 'project'])).then(function(attachments) {\n            _this.rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n            task = task.set('loading', false);\n            return _this.taskboardTasksService.replace(task);\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, oldStatusId, usId, statusId, order) {\n      var moveUpdateData, options, params, promise;\n      task = this.taskboardTasksService.getTaskModel(task.get('id'));\n      moveUpdateData = this.taskboardTasksService.move(task.id, usId, statusId, order);\n      params = {\n        status__is_archived: false,\n        include_attachments: true\n      };\n      options = {\n        headers: {\n          \"set-orders\": JSON.stringify(moveUpdateData.set_orders)\n        }\n      };\n      return promise = this.repo.save(task, true, params, options, true).then((function(_this) {\n        return function(result) {\n          var headers;\n          headers = result[1];\n          if (headers && headers['taiga-info-order-updated']) {\n            order = JSON.parse(headers['taiga-info-order-updated']);\n            _this.taskboardTasksService.assignOrders(order);\n          }\n          return _this.loadSprintStats();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.toggleFold = function(id) {\n      return this.taskboardTasksService.toggleFold(id);\n    };\n\n    TaskboardController.prototype.changeTaskAssignedTo = function(id) {\n      var task;\n      task = this.taskboardTasksService.getTaskModel(id);\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    TaskboardController.prototype.setRolePoints = function() {\n      var computableRoles, getPoint, getRole, pointsByRole;\n      computableRoles = _.filter(this.scope.project.roles, \"computable\");\n      getRole = (function(_this) {\n        return function(roleId) {\n          roleId = parseInt(roleId, 10);\n          return _.find(computableRoles, function(role) {\n            return role.id === roleId;\n          });\n        };\n      })(this);\n      getPoint = (function(_this) {\n        return function(pointId) {\n          var poitnId;\n          poitnId = parseInt(pointId, 10);\n          return _.find(_this.scope.project.points, function(point) {\n            return point.id === pointId;\n          });\n        };\n      })(this);\n      pointsByRole = _.reduce(this.scope.userstories, (function(_this) {\n        return function(result, us, key) {\n          _.forOwn(us.points, function(pointId, roleId) {\n            var point, role;\n            role = getRole(roleId);\n            point = getPoint(pointId);\n            if (!result[role.id]) {\n              result[role.id] = role;\n              result[role.id].points = 0;\n            }\n            return result[role.id].points += point.value;\n          });\n          return result;\n        };\n      })(this), {});\n      return this.scope.pointsByRole = Object.keys(pointsByRole).map(function(key) {\n        return pointsByRole[key];\n      });\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:zoom0\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      $scope.$watch(\"usTasks\", function() {\n        if ($scope.project) {\n          $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n          $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n          return recalculateTaskboardWidth();\n        }\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          if (usId) {\n            tasks = $scope.usTasks.getIn([usId.toString(), statusId.toString()]).size;\n          } else {\n            tasks = $scope.usTasks.getIn(['null', statusId.toString()]).size;\n          }\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            if ($scope.ctrl.zoomLevel === '0') {\n              return column.css(\"max-width\", 148);\n            } else {\n              return column.css(\"max-width\", maxColumnWidth);\n            }\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var unwatch;\n      return unwatch = $scope.$watch(\"usTasks\", function(usTasks) {\n        var containers, deleteElement, drake, filterError, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!usTasks || !usTasks.size) {\n          return;\n        }\n        unwatch();\n        if (!($scope.project.my_permissions.indexOf(\"modify_task\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          accepts: function(el, target) {\n            return !$(target).hasClass('taskboard-userstory-box');\n          },\n          moves: function(item) {\n            return $(item).is('tg-card');\n          }\n        });\n        drake.on('drag', function(item) {\n          oldParentScope = $(item).parent().scope();\n          if ($el.hasClass(\"active-filters\")) {\n            filterError();\n            setTimeout((function() {\n              return drake.cancel(true);\n            }), 0);\n            return false;\n          }\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, itemTask.getIn(['model', 'status']), newUsId, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll([$('.taskboard-table-body')[0]], {\n          margin: 100,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$translate\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var TaskboardTasksService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  TaskboardTasksService = (function(superClass) {\n    extend(TaskboardTasksService, superClass);\n\n    TaskboardTasksService.$inject = [];\n\n    function TaskboardTasksService() {\n      this.reset();\n    }\n\n    TaskboardTasksService.prototype.reset = function() {\n      this.tasksRaw = [];\n      this.foldStatusChanged = {};\n      return this.usTasks = Immutable.Map();\n    };\n\n    TaskboardTasksService.prototype.init = function(project, usersById) {\n      this.project = project;\n      return this.usersById = usersById;\n    };\n\n    TaskboardTasksService.prototype.resetFolds = function() {\n      this.foldStatusChanged = {};\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.toggleFold = function(taskId) {\n      this.foldStatusChanged[taskId] = !this.foldStatusChanged[taskId];\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.add = function(task) {\n      this.tasksRaw = this.tasksRaw.concat(task);\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.set = function(tasks) {\n      this.tasksRaw = tasks;\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.setUserstories = function(userstories) {\n      return this.userstories = userstories;\n    };\n\n    TaskboardTasksService.prototype.refreshRawOrder = function() {\n      var i, len, ref, results, task;\n      this.order = {};\n      ref = this.tasksRaw;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        task = ref[i];\n        results.push(this.order[task.id] = task.taskboard_order);\n      }\n      return results;\n    };\n\n    TaskboardTasksService.prototype.assignOrders = function(order) {\n      order = _.invert(order);\n      this.order = _.assign(this.order, order);\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.getTask = function(id) {\n      var findedTask;\n      findedTask = null;\n      this.usTasks.forEach(function(us) {\n        us.forEach(function(status) {\n          findedTask = status.find(function(task) {\n            return task.get('id') === id;\n          });\n          if (findedTask) {\n            return false;\n          }\n        });\n        if (findedTask) {\n          return false;\n        }\n      });\n      return findedTask;\n    };\n\n    TaskboardTasksService.prototype.replace = function(task) {\n      return this.usTasks = this.usTasks.map(function(us) {\n        return us.map(function(status) {\n          var findedIndex;\n          findedIndex = status.findIndex(function(usItem) {\n            return usItem.get('id') === us.get('id');\n          });\n          if (findedIndex !== -1) {\n            status = status.set(findedIndex, task);\n          }\n          return status;\n        });\n      });\n    };\n\n    TaskboardTasksService.prototype.getTaskModel = function(id) {\n      return _.find(this.tasksRaw, function(task) {\n        return task.id === id;\n      });\n    };\n\n    TaskboardTasksService.prototype.replaceModel = function(task) {\n      this.tasksRaw = _.map(this.tasksRaw, function(it) {\n        if (task.id === it.id) {\n          return task;\n        } else {\n          return it;\n        }\n      });\n      return this.refresh();\n    };\n\n    TaskboardTasksService.prototype.move = function(id, usId, statusId, index) {\n      var afterDestination, beforeDestination, i, it, j, key, len, len1, previous, previousWithTheSameOrder, setOrders, taksWithoutMoved, task, taskByUsStatus;\n      task = this.getTaskModel(id);\n      taskByUsStatus = _.filter(this.tasksRaw, (function(_this) {\n        return function(task) {\n          return task.status === statusId && task.user_story === usId;\n        };\n      })(this));\n      taskByUsStatus = _.sortBy(taskByUsStatus, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      taksWithoutMoved = _.filter(taskByUsStatus, (function(_this) {\n        return function(it) {\n          return it.id !== id;\n        };\n      })(this));\n      beforeDestination = _.slice(taksWithoutMoved, 0, index);\n      afterDestination = _.slice(taksWithoutMoved, index);\n      setOrders = {};\n      previous = beforeDestination[beforeDestination.length - 1];\n      previousWithTheSameOrder = _.filter(beforeDestination, (function(_this) {\n        return function(it) {\n          return _this.order[it.id] === _this.order[previous.id];\n        };\n      })(this));\n      if (previousWithTheSameOrder.length > 1) {\n        for (i = 0, len = previousWithTheSameOrder.length; i < len; i++) {\n          it = previousWithTheSameOrder[i];\n          setOrders[it.id] = this.order[it.id];\n        }\n      }\n      if (!previous) {\n        this.order[task.id] = 0;\n      } else if (previous) {\n        this.order[task.id] = this.order[previous.id] + 1;\n      }\n      for (key = j = 0, len1 = afterDestination.length; j < len1; key = ++j) {\n        it = afterDestination[key];\n        this.order[it.id] = this.order[task.id] + key + 1;\n      }\n      task.status = statusId;\n      task.user_story = usId;\n      task.taskboard_order = this.order[task.id];\n      this.refresh();\n      return {\n        \"task_id\": task.id,\n        \"order\": this.order[task.id],\n        \"set_orders\": setOrders\n      };\n    };\n\n    TaskboardTasksService.prototype.refresh = function() {\n      var i, j, k, len, len1, len2, model, ref, status, task, taskModel, taskStatusList, tasks, us, usTasks;\n      this.tasksRaw = _.sortBy(this.tasksRaw, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      tasks = this.tasksRaw;\n      taskStatusList = _.sortBy(this.project.task_statuses, \"order\");\n      usTasks = {};\n      ref = _.union(this.userstories, [\n        {\n          id: null\n        }\n      ]);\n      for (i = 0, len = ref.length; i < len; i++) {\n        us = ref[i];\n        usTasks[us.id] = {};\n        for (j = 0, len1 = taskStatusList.length; j < len1; j++) {\n          status = taskStatusList[j];\n          usTasks[us.id][status.id] = [];\n        }\n      }\n      for (k = 0, len2 = tasks.length; k < len2; k++) {\n        taskModel = tasks[k];\n        if ((usTasks[taskModel.user_story] != null) && (usTasks[taskModel.user_story][taskModel.status] != null)) {\n          task = {};\n          model = taskModel.getAttrs();\n          task.foldStatusChanged = this.foldStatusChanged[taskModel.id];\n          task.model = model;\n          task.images = _.filter(model.attachments, function(it) {\n            return !!it.thumbnail_card_url;\n          });\n          task.id = taskModel.id;\n          task.assigned_to = this.usersById[taskModel.assigned_to];\n          task.colorized_tags = _.map(task.model.tags, (function(_this) {\n            return function(tag) {\n              return {\n                name: tag[0],\n                color: tag[1]\n              };\n            };\n          })(this));\n          usTasks[taskModel.user_story][taskModel.status].push(task);\n        }\n      }\n      return this.usTasks = Immutable.fromJS(usTasks);\n    };\n\n    return TaskboardTasksService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaKanban\").service(\"tgTaskboardTasks\", TaskboardTasksService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: kanban-userstories.service.coffee\n */\n\n(function() {\n  var KanbanUserstoriesService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  KanbanUserstoriesService = (function(superClass) {\n    extend(KanbanUserstoriesService, superClass);\n\n    KanbanUserstoriesService.$inject = [];\n\n    function KanbanUserstoriesService() {\n      this.reset();\n    }\n\n    KanbanUserstoriesService.prototype.reset = function() {\n      this.userstoriesRaw = [];\n      this.archivedStatus = [];\n      this.statusHide = [];\n      this.foldStatusChanged = {};\n      return this.usByStatus = Immutable.Map();\n    };\n\n    KanbanUserstoriesService.prototype.init = function(project, usersById) {\n      this.project = project;\n      return this.usersById = usersById;\n    };\n\n    KanbanUserstoriesService.prototype.resetFolds = function() {\n      this.foldStatusChanged = {};\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.toggleFold = function(usId) {\n      this.foldStatusChanged[usId] = !this.foldStatusChanged[usId];\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.set = function(userstories) {\n      this.userstoriesRaw = userstories;\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.add = function(us) {\n      this.userstoriesRaw = this.userstoriesRaw.concat(us);\n      this.refreshRawOrder();\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.addArchivedStatus = function(statusId) {\n      return this.archivedStatus.push(statusId);\n    };\n\n    KanbanUserstoriesService.prototype.isUsInArchivedHiddenStatus = function(usId) {\n      var us;\n      us = this.getUsModel(usId);\n      return this.archivedStatus.indexOf(us.status) !== -1 && this.statusHide.indexOf(us.status) !== -1;\n    };\n\n    KanbanUserstoriesService.prototype.hideStatus = function(statusId) {\n      this.deleteStatus(statusId);\n      return this.statusHide.push(statusId);\n    };\n\n    KanbanUserstoriesService.prototype.showStatus = function(statusId) {\n      return _.remove(this.statusHide, function(it) {\n        return it === statusId;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.getStatus = function(statusId) {\n      return _.filter(this.userstoriesRaw, function(us) {\n        return us.status === statusId;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.deleteStatus = function(statusId) {\n      var toDelete;\n      toDelete = _.filter(this.userstoriesRaw, function(us) {\n        return us.status === statusId;\n      });\n      toDelete = _.map(function(it) {\n        return it.id;\n      });\n      this.archived = _.difference(this.archived, toDelete);\n      this.userstoriesRaw = _.filter(this.userstoriesRaw, function(us) {\n        return us.status !== statusId;\n      });\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.refreshRawOrder = function() {\n      var i, it, len, ref, results;\n      this.order = {};\n      ref = this.userstoriesRaw;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        it = ref[i];\n        results.push(this.order[it.id] = it.kanban_order);\n      }\n      return results;\n    };\n\n    KanbanUserstoriesService.prototype.assignOrders = function(order) {\n      this.order = _.assign(this.order, order);\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.move = function(id, statusId, index) {\n      var afterDestination, beforeDestination, i, it, j, key, len, len1, previous, previousWithTheSameOrder, setOrders, us, usByStatus, usByStatusWithoutMoved;\n      us = this.getUsModel(id);\n      usByStatus = _.filter(this.userstoriesRaw, (function(_this) {\n        return function(it) {\n          return it.status === statusId;\n        };\n      })(this));\n      usByStatus = _.sortBy(usByStatus, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      usByStatusWithoutMoved = _.filter(usByStatus, (function(_this) {\n        return function(it) {\n          return it.id !== id;\n        };\n      })(this));\n      beforeDestination = _.slice(usByStatusWithoutMoved, 0, index);\n      afterDestination = _.slice(usByStatusWithoutMoved, index);\n      setOrders = {};\n      previous = beforeDestination[beforeDestination.length - 1];\n      previousWithTheSameOrder = _.filter(beforeDestination, (function(_this) {\n        return function(it) {\n          return _this.order[it.id] === _this.order[previous.id];\n        };\n      })(this));\n      if (previousWithTheSameOrder.length > 1) {\n        for (i = 0, len = previousWithTheSameOrder.length; i < len; i++) {\n          it = previousWithTheSameOrder[i];\n          setOrders[it.id] = this.order[it.id];\n        }\n      }\n      if (!previous && (!afterDestination || afterDestination.length === 0)) {\n        this.order[us.id] = 0;\n      } else if (!previous && afterDestination && afterDestination.length > 0) {\n        this.order[us.id] = this.order[afterDestination[0].id] - 1;\n      } else if (previous) {\n        this.order[us.id] = this.order[previous.id] + 1;\n      }\n      for (key = j = 0, len1 = afterDestination.length; j < len1; key = ++j) {\n        it = afterDestination[key];\n        this.order[it.id] = this.order[us.id] + key + 1;\n      }\n      us.status = statusId;\n      us.kanban_order = this.order[us.id];\n      this.refresh();\n      return {\n        \"us_id\": us.id,\n        \"order\": this.order[us.id],\n        \"set_orders\": setOrders\n      };\n    };\n\n    KanbanUserstoriesService.prototype.moveToEnd = function(id, statusId) {\n      var us;\n      us = this.getUsModel(id);\n      this.order[us.id] = -1;\n      us.status = statusId;\n      us.kanban_order = this.order[us.id];\n      this.refresh();\n      return {\n        \"us_id\": us.id,\n        \"order\": -1\n      };\n    };\n\n    KanbanUserstoriesService.prototype.replace = function(us) {\n      return this.usByStatus = this.usByStatus.map(function(status) {\n        var findedIndex;\n        findedIndex = status.findIndex(function(usItem) {\n          return usItem.get('id') === us.get('id');\n        });\n        if (findedIndex !== -1) {\n          status = status.set(findedIndex, us);\n        }\n        return status;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.replaceModel = function(us) {\n      this.userstoriesRaw = _.map(this.userstoriesRaw, function(usItem) {\n        if (us.id === usItem.id) {\n          return us;\n        } else {\n          return usItem;\n        }\n      });\n      return this.refresh();\n    };\n\n    KanbanUserstoriesService.prototype.getUs = function(id) {\n      var findedUs;\n      findedUs = null;\n      this.usByStatus.forEach(function(status) {\n        findedUs = status.find(function(us) {\n          return us.get('id') === id;\n        });\n        if (findedUs) {\n          return false;\n        }\n      });\n      return findedUs;\n    };\n\n    KanbanUserstoriesService.prototype.getUsModel = function(id) {\n      return _.find(this.userstoriesRaw, function(us) {\n        return us.id === id;\n      });\n    };\n\n    KanbanUserstoriesService.prototype.refresh = function() {\n      var usByStatus, userstories;\n      this.userstoriesRaw = _.sortBy(this.userstoriesRaw, (function(_this) {\n        return function(it) {\n          return _this.order[it.id];\n        };\n      })(this));\n      userstories = this.userstoriesRaw;\n      userstories = _.map(userstories, (function(_this) {\n        return function(usModel) {\n          var model, us;\n          us = {};\n          model = usModel.getAttrs();\n          us.foldStatusChanged = _this.foldStatusChanged[usModel.id];\n          us.model = model;\n          us.images = _.filter(model.attachments, function(it) {\n            return !!it.thumbnail_card_url;\n          });\n          us.id = usModel.id;\n          us.assigned_to = _this.usersById[usModel.assigned_to];\n          us.colorized_tags = _.map(us.model.tags, function(tag) {\n            return {\n              name: tag[0],\n              color: tag[1]\n            };\n          });\n          return us;\n        };\n      })(this));\n      usByStatus = _.groupBy(userstories, function(us) {\n        return us.model.status;\n      });\n      return this.usByStatus = Immutable.fromJS(usByStatus);\n    };\n\n    return KanbanUserstoriesService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaKanban\").service(\"tgKanbanUserstories\", KanbanUserstoriesService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanWipLimitDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"$tgModel\", \"tgKanbanUserstories\", \"$tgStorage\", \"tgFilterRemoteStorageService\", \"tgProjectService\"];\n\n    KanbanController.prototype.storeCustomFiltersName = 'kanban-custom-filters';\n\n    KanbanController.prototype.storeFiltersName = 'kanban-filters';\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, rs2, params1, q, location, appMetaService, navUrls, events, analytics, translate, errorHandlingService, model, kanbanUserstoriesService1, storage, filterRemoteStorageService, projectService1) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rs2 = rs2;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.model = model;\n      this.kanbanUserstoriesService = kanbanUserstoriesService1;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      this.projectService = projectService1;\n      bindMethods(this);\n      this.kanbanUserstoriesService.reset();\n      this.openFilter = false;\n      if (this.applyStoredFilters(this.params.pslug, \"kanban-filters\")) {\n        return;\n      }\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.initializeEventHandlers();\n      taiga.defineImmutableProperty(this.scope, \"usByStatus\", (function(_this) {\n        return function() {\n          return _this.kanbanUserstoriesService.usByStatus;\n        };\n      })(this));\n    }\n\n    KanbanController.prototype.firstLoad = function() {\n      var promise;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      return promise.then(null, this.onInitialDataError.bind(this));\n    };\n\n    KanbanController.prototype.setZoom = function(zoomLevel, zoom) {\n      var previousZoomLevel;\n      if (this.zoomLevel === zoomLevel) {\n        return null;\n      }\n      this.isFirstLoad = !this.zoomLevel;\n      previousZoomLevel = this.zoomLevel;\n      this.zoomLevel = zoomLevel;\n      this.zoom = zoom;\n      if (this.isFirstLoad) {\n        return this.firstLoad().then((function(_this) {\n          return function() {\n            _this.isFirstLoad = false;\n            return _this.kanbanUserstoriesService.resetFolds();\n          };\n        })(this));\n      } else if (this.zoomLevel > 1 && previousZoomLevel <= 1) {\n        this.zoomLoading = true;\n        return this.loadUserstories().then((function(_this) {\n          return function() {\n            _this.zoomLoading = false;\n            return _this.kanbanUserstoriesService.resetFolds();\n          };\n        })(this));\n      }\n    };\n\n    KanbanController.prototype.filtersReloadContent = function() {\n      return this.loadUserstories().then((function(_this) {\n        return function() {\n          var i, len, openArchived, results, statusId;\n          openArchived = _.difference(_this.kanbanUserstoriesService.archivedStatus, _this.kanbanUserstoriesService.statusHide);\n          if (openArchived.length) {\n            results = [];\n            for (i = 0, len = openArchived.length; i < len; i++) {\n              statusId = openArchived[i];\n              results.push(_this.loadUserStoriesForStatus({}, statusId));\n            }\n            return results;\n          }\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function(event, us) {\n          _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.add(us);\n          });\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function(event, uss) {\n          _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.add(uss);\n          });\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, us) {\n          return _this.refreshTagsColors().then(function() {\n            return _this.kanbanUserstoriesService.replaceModel(us);\n          });\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.editUs = function(id) {\n      var us;\n      us = this.kanbanUserstoriesService.getUs(id);\n      us = us.set('loading', true);\n      this.kanbanUserstoriesService.replace(us);\n      return this.rs.userstories.getByRef(us.getIn(['model', 'project']), us.getIn(['model', 'ref'])).then((function(_this) {\n        return function(editingUserStory) {\n          return _this.rs2.attachments.list(\"us\", us.get('id'), us.getIn(['model', 'project'])).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n            us = us.set('loading', false);\n            return _this.kanbanUserstoriesService.replace(us);\n          });\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.showPlaceHolder = function(statusId) {\n      if (this.scope.usStatusList[0].id === statusId && !this.kanbanUserstoriesService.userstoriesRaw.length) {\n        return true;\n      }\n      return false;\n    };\n\n    KanbanController.prototype.toggleFold = function(id) {\n      return this.kanbanUserstoriesService.toggleFold(id);\n    };\n\n    KanbanController.prototype.isUsInArchivedHiddenStatus = function(usId) {\n      return this.kanbanUserstoriesService.isUsInArchivedHiddenStatus(usId);\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(id) {\n      var us;\n      us = this.kanbanUserstoriesService.getUsModel(id);\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, usModel) {\n      var promise;\n      usModel.assigned_to = userid;\n      this.kanbanUserstoriesService.replaceModel(usModel);\n      promise = this.repo.save(usModel);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors._attrs;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      if (this.zoomLevel > 1) {\n        params.include_attachments = 1;\n        params.include_tasks = 1;\n      }\n      params = _.merge(params, this.location.search());\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.kanbanUserstoriesService.init(_this.scope.project, _this.scope.usersById);\n          _this.kanbanUserstoriesService.set(userstories);\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var filteredStatus, params;\n      filteredStatus = this.location.search().status;\n      if (filteredStatus) {\n        filteredStatus = filteredStatus.split(\",\").map(function(it) {\n          return parseInt(it, 10);\n        });\n        if (filteredStatus.indexOf(statusId) === -1) {\n          return;\n        }\n      }\n      params = {\n        status: statusId,\n        include_attachments: true,\n        include_tasks: true\n      };\n      params = _.merge(params, this.location.search());\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.is_kanban_activated) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.projectId = project.id;\n      this.scope.points = _.sortBy(project.points, \"order\");\n      this.scope.pointsById = groupBy(project.points, function(x) {\n        return x.id;\n      });\n      this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n      this.scope.$emit(\"project:loaded\", project);\n      return project;\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      this.initializeSubscription();\n      this.loadKanban();\n      return this.generateFilters();\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var moveUpdateData, newStatus, options, params, promise;\n      us = this.kanbanUserstoriesService.getUsModel(us.get('id'));\n      newStatus = this.scope.usStatusById[newStatusId];\n      if (newStatus.is_archived && !this.scope.usByStatus.get(newStatusId.toString())) {\n        moveUpdateData = this.kanbanUserstoriesService.moveToEnd(us.id, newStatusId);\n      } else {\n        moveUpdateData = this.kanbanUserstoriesService.move(us.id, newStatusId, index);\n      }\n      params = {\n        include_attachments: true,\n        include_tasks: true\n      };\n      options = {\n        headers: {\n          \"set-orders\": JSON.stringify(moveUpdateData.set_orders)\n        }\n      };\n      promise = this.repo.save(us, true, params, options, true);\n      promise = promise.then((function(_this) {\n        return function(result) {\n          var headers, order;\n          headers = result[1];\n          if (headers && headers['taiga-info-order-updated']) {\n            order = JSON.parse(headers['taiga-info-order-updated']);\n            _this.kanbanUserstoriesService.assignOrders(order);\n          }\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin, taiga.UsFiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate, kanbanUserstoriesService) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      kanbanUserstoriesService.addArchivedStatus(status.id);\n      kanbanUserstoriesService.hideStatus(status.id);\n      $scope[\"class\"] = \"icon-watch\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-watch\";\n            $scope.title = showArchivedText;\n            $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n            return kanbanUserstoriesService.hideStatus(status.id);\n          } else {\n            $scope[\"class\"] = \"icon-unwatch\";\n            $scope.title = hideArchivedText;\n            $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n            return kanbanUserstoriesService.showStatus(status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", \"tgKanbanUserstories\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate, kanbanUserstoriesService) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function(hasArchived) {\n        if (hasArchived) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var hasArchived;\n        hasArchived = !!kanbanUserstoriesService.getStatus(newStatusId).length;\n        return updateIntroText(hasArchived);\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        var hasArchived;\n        if (statusId === status.id) {\n          kanbanUserstoriesService.deleteStatus(statusId);\n          kanbanUserstoriesService.add(userStoriesLoaded);\n          hasArchived = !!kanbanUserstoriesService.getStatus(statusId).length;\n          return updateIntroText(hasArchived);\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          return updateIntroText(false);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", \"tgKanbanUserstories\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanSquishColumnDirective = function(rs, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var unwatch, updateTableWidth;\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n      return unwatch = $scope.$watch('usByStatus', function(usByStatus) {\n        if (usByStatus.size) {\n          $scope.folds = rs.kanban.getStatusColumnModes(projectService.project.get('id'));\n          updateTableWidth();\n          return unwatch();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", \"tgProjectService\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function($timeout) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return $timeout(function() {\n            var element;\n            element = $el.find(\"tg-card\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", [\"$timeout\", KanbanWipLimitDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var unwatch;\n      return unwatch = $scope.$watch(\"usByStatus\", function(usByStatus) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!usByStatus || !usByStatus.size) {\n          return;\n        }\n        unwatch();\n        if (!($scope.project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          moves: function(item) {\n            return $(item).is('tg-card');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.getIn(['model', 'status']), newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 100,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/epics/detail.coffee\n */\n\n(function() {\n  var EpicDetailController, EpicStatusButtonDirective, EpicStatusDisplayDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEpics\");\n\n  EpicDetailController = (function(superClass) {\n    extend(EpicDetailController, superClass);\n\n    EpicDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function EpicDetailController(scope, rootscope, repo, confirm, rs, rs2, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.rs2 = rs2;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.epicRef = this.params.epicref;\n      this.scope.sectionName = this.translate.instant(\"EPIC.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    EpicDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"EPIC.PAGE_TITLE\", {\n        epicRef: \"#\" + this.scope.epic.ref,\n        epicSubject: this.scope.epic.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"EPIC.PAGE_DESCRIPTION\", {\n        epicStatus: ((ref = this.scope.statusById[this.scope.epic.status]) != null ? ref.name : void 0) || \"--\",\n        epicDescription: angular.element(this.scope.epic.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    EpicDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on epic\", 1);\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadEpic();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-epics\", ctx);\n    };\n\n    EpicDetailController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.immutableProject = this.projectService.project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.statusList = project.epic_statuses;\n      this.scope.statusById = groupBy(project.epic_statuses, function(x) {\n        return x.id;\n      });\n      return project;\n    };\n\n    EpicDetailController.prototype.loadEpic = function() {\n      return this.rs.epics.getByRef(this.scope.projectId, this.params.epicref).then((function(_this) {\n        return function(epic) {\n          var ctx, ref, ref1;\n          _this.scope.epic = epic;\n          _this.scope.immutableEpic = Immutable.fromJS(epic._attrs);\n          _this.scope.epicId = epic.id;\n          _this.scope.commentModel = epic;\n          _this.modelTransform.setObject(_this.scope, 'epic');\n          if (((ref = _this.scope.epic.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.epic.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-epics-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.epic.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.epic.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-epics-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.loadUserstories = function() {\n      return this.rs2.userstories.listInEpic(this.scope.epicId).then((function(_this) {\n        return function(data) {\n          return _this.scope.userstories = data;\n        };\n      })(this));\n    };\n\n    EpicDetailController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.loadEpic().then((function(_this) {\n        return function() {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    EpicDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.upvote(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.downvote(this.scope.epicId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    EpicDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.watch(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadEpic();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.epics.unwatch(this.scope.epicId).then(onSuccess, onError);\n    };\n\n    EpicDetailController.prototype.onSelectColor = function(color) {\n      var onSelectColorError, onSelectColorSuccess, transform;\n      onSelectColorSuccess = (function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.confirm.notify('success');\n        };\n      })(this);\n      onSelectColorError = (function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this);\n      transform = this.modelTransform.save(function(epic) {\n        epic.color = color;\n        return epic;\n      });\n      return transform.then(onSelectColorSuccess, onSelectColorError);\n    };\n\n    return EpicDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"EpicDetailController\", EpicDetailController);\n\n  EpicStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(epic) {\n        var html, status;\n        status = $scope.statusById[epic.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(epic) {\n        if (epic != null) {\n          return render(epic);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEpicStatusDisplay\", [\"$tgTemplate\", \"$compile\", EpicStatusDisplayDirective]);\n\n  EpicStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_epic\") !== -1;\n      };\n      render = (function(_this) {\n        return function(epic) {\n          var html, status;\n          status = $scope.statusById[epic.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(epic) {\n          epic.status = status;\n          return epic;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var epic;\n        epic = $model.$modelValue;\n        if (epic) {\n          return render(epic);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEpicStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", EpicStatusButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issuePriority: ((ref3 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref3.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.statusList = project.issue_statuses;\n      this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.typeById = groupBy(project.issue_types, function(x) {\n        return x.id;\n      });\n      this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n      this.scope.severityList = project.severities;\n      this.scope.severityById = groupBy(project.severities, function(x) {\n        return x.id;\n      });\n      this.scope.priorityList = project.priorities;\n      this.scope.priorityById = groupBy(project.priorities, function(x) {\n        return x.id;\n      });\n      return project;\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          _this.modelTransform.setObject(_this.scope, 'issue');\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.loadIssue();\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(statusId) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.status = statusId;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(type) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.type = type;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.type : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(severity) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.severity = severity;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.severity : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(priority) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.priority = priority;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.priority : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = (function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el, function() {\n          return $scope.createIssueOpen = false;\n        });\n        $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          tags: []\n        };\n        return $scope.createIssueOpen = true;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.filter(function(it) {\n          return it.get('name') !== attachment.get('name');\n        });\n      };\n      $scope.addTag = function(tag, color) {\n        var inserted, itemtags, projectTags, tags, value;\n        value = trim(tag.toLowerCase());\n        tags = $scope.project.tags;\n        projectTags = $scope.project.tags_colors;\n        if (tags == null) {\n          tags = [];\n        }\n        if (projectTags == null) {\n          projectTags = {};\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        projectTags[tag] = color || null;\n        $scope.project.tags = tags;\n        itemtags = _.clone($scope.issue.tags);\n        inserted = _.find(itemtags, function(it) {\n          return it[0] === value;\n        });\n        if (!inserted) {\n          itemtags.push([tag, color]);\n          return $scope.issue.tags = itemtags;\n        }\n      };\n      $scope.deleteTag = function(tag) {\n        var itemtags, tags, value;\n        value = trim(tag[0].toLowerCase());\n        tags = $scope.project.tags;\n        itemtags = _.clone($scope.issue.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === value;\n        });\n        $scope.issue.tags = itemtags;\n        return _.pull($scope.issue.tags, value);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssuesController, IssuesDirective, bindMethods, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"$tgStorage\", \"tgFilterRemoteStorageService\", \"tgProjectService\", \"tgUserActivityService\"];\n\n    IssuesController.prototype.filtersHashSuffix = \"issues-filters\";\n\n    IssuesController.prototype.myFiltersHashSuffix = \"issues-my-filters\";\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params1, q1, location, appMetaService, navUrls, events, analytics, translate, errorHandlingService, storage, filterRemoteStorageService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params1;\n      this.q = q1;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.storage = storage;\n      this.filterRemoteStorageService = filterRemoteStorageService;\n      this.projectService = projectService;\n      this.loadIssues = bind(this.loadIssues, this);\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"PROJECT.SECTION.ISSUES\");\n      this.voting = false;\n      if (this.applyStoredFilters(this.params.pslug, this.filtersHashSuffix)) {\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.changeQ = function(q) {\n      this.unselectFilter(\"page\");\n      this.replaceFilter(\"q\", q);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.removeFilter = function(filter) {\n      this.unselectFilter(\"page\");\n      this.unselectFilter(filter.dataType, filter.id);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.addFilter = function(newFilter) {\n      this.unselectFilter(\"page\");\n      this.selectFilter(newFilter.category.dataType, newFilter.filter.id);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.selectCustomFilter = function(customFilter) {\n      var orderBy;\n      orderBy = this.location.search().order_by;\n      if (orderBy) {\n        customFilter.filter.order_by = orderBy;\n      }\n      this.unselectFilter(\"page\");\n      this.replaceAllFilters(customFilter.filter);\n      this.loadIssues();\n      return this.generateFilters();\n    };\n\n    IssuesController.prototype.removeCustomFilter = function(customFilter) {\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix).then((function(_this) {\n        return function(userFilters) {\n          delete userFilters[customFilter.id];\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.myFiltersHashSuffix).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCustomFilter = function(name) {\n      var filters, urlfilters;\n      filters = {};\n      urlfilters = this.location.search();\n      filters.tags = urlfilters.tags;\n      filters.status = urlfilters.status;\n      filters.type = urlfilters.type;\n      filters.severity = urlfilters.severity;\n      filters.priority = urlfilters.priority;\n      filters.assigned_to = urlfilters.assigned_to;\n      filters.owner = urlfilters.owner;\n      return this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix).then((function(_this) {\n        return function(userFilters) {\n          userFilters[name] = filters;\n          return _this.filterRemoteStorageService.storeFilters(_this.scope.projectId, userFilters, _this.myFiltersHashSuffix).then(_this.generateFilters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      this.storeFilters(this.params.pslug, this.location.search(), this.filtersHashSuffix);\n      urlfilters = this.location.search();\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.type = urlfilters.type;\n      loadFilters.severity = urlfilters.severity;\n      loadFilters.priority = urlfilters.priority;\n      loadFilters.assigned_to = urlfilters.assigned_to;\n      loadFilters.owner = urlfilters.owner;\n      loadFilters.q = urlfilters.q;\n      return this.q.all([this.rs.issues.filtersData(loadFilters), this.filterRemoteStorageService.getFilters(this.scope.projectId, this.myFiltersHashSuffix)]).then((function(_this) {\n        return function(result) {\n          var assignedTo, customFiltersRaw, data, owner, priority, selected, severity, statuses, tags, tagsWithAtLeastOneElement, type;\n          data = result[0];\n          customFiltersRaw = result[1];\n          statuses = _.map(data.statuses, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          type = _.map(data.types, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          severity = _.map(data.severities, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          priority = _.map(data.priorities, function(it) {\n            it.id = it.id.toString();\n            return it;\n          });\n          tags = _.map(data.tags, function(it) {\n            it.id = it.name;\n            return it;\n          });\n          tagsWithAtLeastOneElement = _.filter(tags, function(tag) {\n            return tag.count > 0;\n          });\n          assignedTo = _.map(data.assigned_to, function(it) {\n            if (it.id) {\n              it.id = it.id.toString();\n            } else {\n              it.id = \"null\";\n            }\n            it.name = it.full_name || \"Unassigned\";\n            return it;\n          });\n          owner = _.map(data.owners, function(it) {\n            it.id = it.id.toString();\n            it.name = it.full_name;\n            return it;\n          });\n          _this.selectedFilters = [];\n          if (loadFilters.status) {\n            selected = _this.formatSelectedFilters(\"status\", statuses, loadFilters.status);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.tags) {\n            selected = _this.formatSelectedFilters(\"tags\", tags, loadFilters.tags);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.assigned_to) {\n            selected = _this.formatSelectedFilters(\"assigned_to\", assignedTo, loadFilters.assigned_to);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.owner) {\n            selected = _this.formatSelectedFilters(\"owner\", owner, loadFilters.owner);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.type) {\n            selected = _this.formatSelectedFilters(\"type\", type, loadFilters.type);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.severity) {\n            selected = _this.formatSelectedFilters(\"severity\", severity, loadFilters.severity);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          if (loadFilters.priority) {\n            selected = _this.formatSelectedFilters(\"priority\", priority, loadFilters.priority);\n            _this.selectedFilters = _this.selectedFilters.concat(selected);\n          }\n          _this.filterQ = loadFilters.q;\n          _this.filters = [\n            {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TYPE\"),\n              dataType: \"type\",\n              content: type\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.SEVERITY\"),\n              dataType: \"severity\",\n              content: severity\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.PRIORITIES\"),\n              dataType: \"priority\",\n              content: priority\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.STATUS\"),\n              dataType: \"status\",\n              content: statuses\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.TAGS\"),\n              dataType: \"tags\",\n              content: tags,\n              hideEmpty: true,\n              totalTaggedElements: tagsWithAtLeastOneElement.length\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.ASSIGNED_TO\"),\n              dataType: \"assigned_to\",\n              content: assignedTo\n            }, {\n              title: _this.translate.instant(\"COMMON.FILTERS.CATEGORIES.CREATED_BY\"),\n              dataType: \"owner\",\n              content: owner\n            }\n          ];\n          _this.customFilters = [];\n          return _.forOwn(customFiltersRaw, function(value, key) {\n            return _this.customFilters.push({\n              id: key,\n              name: key,\n              filter: value\n            });\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.is_issues_activated) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n      this.scope.severityById = groupBy(project.severities, function(x) {\n        return x.id;\n      });\n      this.scope.severityList = _.sortBy(project.severities, \"order\");\n      this.scope.priorityById = groupBy(project.priorities, function(x) {\n        return x.id;\n      });\n      this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n      this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n      this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n        return x.id;\n      });\n      return project;\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var params, promise;\n      params = this.location.search();\n      promise = this.rs.issues.list(this.scope.projectId, params);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      this.initializeSubscription();\n      this.generateFilters();\n      return this.loadIssues();\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    IssuesController.prototype.upVoteIssue = function(issueId) {\n      var onError, onSuccess;\n      this.voting = issueId;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssues();\n          return _this.voting = null;\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.voting = null;\n        };\n      })(this);\n      return this.rs.issues.upvote(issueId).then(onSuccess, onError);\n    };\n\n    IssuesController.prototype.downVoteIssue = function(issueId) {\n      var onError, onSuccess;\n      this.voting = issueId;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssues();\n          return _this.voting = null;\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.voting = null;\n        };\n      })(this);\n      return this.rs.issues.downvote(issueId).then(onSuccess, onError);\n    };\n\n    IssuesController.prototype.getOrderBy = function() {\n      if (_.isString(this.location.search().order_by)) {\n        return this.location.search().order_by;\n      } else {\n        return \"created_date\";\n      }\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon, svg;\n      currentOrder = $ctrl.getOrderBy();\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-down\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        svg = $(\"<tg-svg>\").attr(\"svg-icon\", icon);\n        colHeadElement.append(svg);\n        $compile(colHeadElement.contents())($scope);\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getOrderBy();\n        newOrder = target.data(\"fieldname\");\n        if (newOrder === 'total_voters') {\n          finalOrder = currentOrder === newOrder ? newOrder : \"-\" + newOrder;\n        } else {\n          finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        }\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"order_by\", finalOrder);\n          $ctrl.storeFilters($ctrl.params.pslug, $location.search(), $ctrl.filtersHashSuffix);\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > tg-svg\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-down\";\n            svg = $(\"<tg-svg>\").attr(\"svg-icon\", icon);\n            target.append(svg);\n            return $compile(target.contents())($scope);\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          return $repo.save(issue).then(function() {\n            $ctrl.loadIssues();\n            return $ctrl.generateFilters();\n          });\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate, avatarService) {\n    var link, template;\n    template = _.template(\"<img style=\\\"background-color: <%- bg %>\\\" src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var avatar, ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        avatar = avatarService.getAvatar(member);\n        ctx.imgurl = avatar.url;\n        ctx.bg = null;\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.bg = avatar.bg;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", \"tgAvatarService\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"$tgConfig\", \"tgProjectService\", \"tgWysiwygService\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform, errorHandlingService, configService, projectService, wysiwigService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.configService = configService;\n      this.projectService = projectService;\n      this.wysiwigService = wysiwigService;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.scope.tribeEnabled = this.configService.config.tribeHost;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      this.scope.onTimeSet = function(vm) {\n        return vm.rootscope.$broadcast(\"flytrap:a\", 1);\n      };\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$watch(\"us.estimated_start\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return _this.scope.us.estimated_start = moment(_this.scope.us.estimated_start).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return _this.scope.us.estimated_start = moment(_this.scope.us.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      this.scope.$watch(\"us.estimated_end\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return _this.scope.us.estimated_end = moment(_this.scope.us.estimated_end).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return _this.scope.us.estimated_end = moment(_this.scope.us.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.wysiwigService.getHTML(this.scope.us.description) || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.statusList = project.us_statuses;\n      this.scope.statusById = groupBy(project.us_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n        return x.id;\n      });\n      this.scope.pointsList = _.sortBy(project.points, \"order\");\n      this.scope.pointsById = groupBy(this.scope.pointsList, function(e) {\n        return e.id;\n      });\n      return project;\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          _this.modelTransform.setObject(_this.scope, 'us');\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.loadUs().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onTribeInfo = function() {\n      var image, publishDesc, publishTitle, text;\n      publishTitle = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\");\n      image = $('<img />').attr({\n        'src': \"/\" + window._version + \"/images/monster-fight.png\",\n        'alt': this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\")\n      });\n      text = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TEXT\");\n      publishDesc = $('<div></div>').append(image).append(text);\n      return this.confirm.success(publishTitle, publishDesc);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          $el.html(html);\n          return $compile($el.contents())($scope);\n        };\n      })(this);\n      save = (function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, transform;\n          $el.find(\".pop-status\").popover().close();\n          currentLoading = $loading().target($el.find('.js-edit-status')).start();\n          transform = $modelTransform.save(function(us) {\n            us.status = status;\n            return us;\n          });\n          onSuccess = function() {\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return transform.then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = function(team_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.team_requirement = team_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.team_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(client_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.client_requirement = client_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.client_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      this.scope.onTimeSet = function(vm) {\n        return vm.rootscope.$broadcast(\"flytrap:task\", 1);\n      };\n      this.scope.$watch(\"task.estimated_start\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return _this.scope.task.estimated_start = moment(_this.scope.task.estimated_start).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return _this.scope.task.estimated_start = moment(_this.scope.task.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      this.scope.$watch(\"task.estimated_end\", (function(_this) {\n        return function(n, o) {\n          if (n && n.toString().indexOf('T') !== -1) {\n            if (n.toString().indexOf('GMT') === -1) {\n              return _this.scope.task.estimated_end = moment(_this.scope.task.estimated_end).subtract(8, 'hours').format('YYYY-MM-DD HH:mm:ss');\n            } else {\n              return _this.scope.task.estimated_end = moment(_this.scope.task.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n            }\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.statusList = project.task_statuses;\n      this.scope.statusById = groupBy(project.task_statuses, function(x) {\n        return x.id;\n      });\n      return project;\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          _this.modelTransform.setObject(_this.scope, 'task');\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.loadTask().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(task) {\n          task.status = status;\n          return task;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(is_iocaine) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('label')).start();\n        transform = $modelTransform.save(function(task) {\n          task.is_iocaine = is_iocaine;\n          return task;\n        });\n        transform.then(function() {\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.is_iocaine : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\", \"tgErrorHandlingService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.issuesEnabled = project.is_issues_activated;\n      this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n      this.scope.wikiEnabled = project.is_wiki_activated;\n      this.scope.owner = project.owner.id;\n      return project;\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var project, userRoles;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      this.loadMembers();\n      userRoles = _.map(this.scope.users, function(user) {\n        return user.role;\n      });\n      this.scope.roles = _.filter(this.scope.roles, function(role) {\n        return userRoles.indexOf(role.id) !== -1;\n      });\n      return this.loadMemberStats();\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiDetailController, WikiSummaryDirective, WikiWysiwyg, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      this.moveLink = bind(this.moveLink, this);\n      this.loadWiki = bind(this.loadWiki, this);\n      this.scope.$on(\"wiki:links:move\", this.moveLink);\n      this.scope.$on(\"wikipage:add\", this.loadWiki);\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiSlug,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.is_wiki_activated) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          return selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.q.all([this.loadWikiLinks(), this.loadWiki()]).then(this.checkLinksPerms.bind(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"add_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiSlug;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            _this.confirm.notify(\"success\");\n            return _this.loadWiki();\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.moveLink = function(ctx, item, itemIndex) {\n      var r, values;\n      values = this.scope.wikiLinks;\n      r = values.indexOf(item);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, item);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate, avatarService) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var avatar, ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        avatar = avatarService.getAvatar(user);\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            avatar: avatar\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            avatar: avatar\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", \"tgAvatarService\", WikiSummaryDirective]);\n\n  WikiWysiwyg = function($modelTransform, $rootscope, $confirm, attachmentsFullService, $qqueue, $repo, $analytics, wikiHistoryService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var uploadFile;\n      $scope.editableDescription = false;\n      $scope.saveDescription = $qqueue.bindAdd(function(description, cb) {\n        var onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if ($scope.item.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n            $scope.$emit(\"wikipage:add\");\n          }\n          wikiHistoryService.loadHistoryEntries();\n          return $confirm.notify(\"success\");\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        $scope.item.content = description;\n        if ($scope.item.id != null) {\n          promise = $repo.save($scope.item).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", $scope.item).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](cb);\n      });\n      uploadFile = function(file, cb) {\n        return attachmentsFullService.addAttachment($scope.project.id, $scope.item.id, 'wiki_page', file).then(function(result) {\n          return cb(result.getIn(['file', 'name']), result.getIn(['file', 'url']));\n        });\n      };\n      $scope.uploadFiles = function(files, cb) {\n        var file, i, len, results;\n        results = [];\n        for (i = 0, len = files.length; i < len; i++) {\n          file = files[i];\n          results.push(uploadFile(file, cb));\n        }\n        return results;\n      };\n      $scope.$watch($attrs.model, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        $scope.version = value.version;\n        return $scope.storageKey = $scope.project.id + \"-\" + value.id + \"-wiki\";\n      });\n      return $scope.$watch('project', function(project) {\n        if (!project) {\n          return;\n        }\n        return $scope.editableDescription = project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      template: \"<div>\\n    <tg-wysiwyg\\n        ng-if=\\\"editableDescription\\\"\\n        version='version'\\n        storage-key='storageKey'\\n        content='item.content'\\n        on-save='saveDescription(text, cb)'\\n        on-upload-file='uploadFiles(files, cb)'>\\n    </tg-wysiwyg>\\n\\n    <div\\n        class=\\\"wysiwyg\\\"\\n        ng-if=\\\"!editableDescription && item.content.length\\\"\\n        ng-bind-html=\\\"item.content | markdownToHTML\\\"></div>\\n\\n    <div\\n        class=\\\"wysiwyg\\\"\\n        ng-if=\\\"!editableDescription && !item.content.length\\\">\\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\\n    </div>\\n</div>\"\n    };\n  };\n\n  module.directive(\"tgWikiWysiwyg\", [\"$tgQueueModelTransformation\", \"$rootScope\", \"$tgConfirm\", \"tgAttachmentsFullService\", \"$tgQqueue\", \"$tgRepo\", \"$tgAnalytics\", \"tgWikiHistoryService\", WikiWysiwyg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $analytics, $loading, $template, $compile, $translate) {\n    var link, linkWikiLinks, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    linkWikiLinks = function($scope, $el, $attrs) {\n      var $ctrl, addWikiLinkPermission, drake, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n      drake = null;\n      render = function(wikiLinks) {\n        var deleteWikiLinkPermission, html, itemEl, scroll, tdom;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        if (addWikiLinkPermission && drake) {\n          drake.destroy();\n        }\n        $el.html(html);\n        if (addWikiLinkPermission) {\n          itemEl = null;\n          tdom = $el.find(\".sortable\");\n          drake = dragula([tdom[0]], {\n            direction: 'vertical',\n            copySortSource: false,\n            copy: false,\n            mirrorContainer: tdom[0],\n            moves: function(item) {\n              return $(item).is('li');\n            }\n          });\n          drake.on('dragend', function(item) {\n            var itemIndex;\n            itemEl = $(item);\n            item = itemEl.scope().link;\n            itemIndex = itemEl.index();\n            return $scope.$emit(\"wiki:links:move\", item, itemIndex);\n          });\n          scroll = autoScroll(window, {\n            margin: 20,\n            pixels: 30,\n            scrollWhenOutside: true,\n            autoScroll: function() {\n              return this.down && drake.dragging;\n            }\n          });\n        }\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".js-delete-link\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LINK_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    link = function($scope, $el, $attrs) {\n      linkWikiLinks($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/pages-list.coffee\n */\n\n(function() {\n  var WikiPagesListController, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiPagesListController = (function(superClass) {\n    extend(WikiPagesListController, superClass);\n\n    WikiPagesListController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgNavUrls\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function WikiPagesListController(scope, rootscope, repo, model, confirm, rs, params, q, navUrls, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.navUrls = navUrls;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiPagesListController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.is_wiki_activated) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    WikiPagesListController.prototype.loadWikiPages = function() {\n      var promise;\n      return promise = this.rs.wiki.list(this.scope.projectId).then((function(_this) {\n        return function(wikipages) {\n          return _this.scope.wikipages = wikipages;\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          return selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n        };\n      })(this));\n    };\n\n    WikiPagesListController.prototype.loadInitialData = function() {\n      var project;\n      project = this.loadProject();\n      this.fillUsersAndRoles(project.members, project.roles);\n      return this.q.all([this.loadWikiLinks(), this.loadWikiPages()]).then(this.checkLinksPerms.bind(this));\n    };\n\n    WikiPagesListController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"add_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    return WikiPagesListController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiPagesListController\", WikiPagesListController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n      normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n      normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n      normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n      normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1, errorHandlingService, projectService1) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService1;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.i_am_admin) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.q.all([this.loadMembers(), this.auth.refresh()]);\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate, $compile, avatarService) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var avatar, ctx, html;\n        avatar = avatarService.getAvatar(member);\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: avatar.url,\n          bg: avatar.bg,\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', \"$compile\", \"tgAvatarService\", MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory, projectService) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                projectService.fetchProject().then(function() {\n                  return $ctrl.loadInitialData();\n                });\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", \"tgProjectService\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvEpicDirective, CsvExporterController, CsvExporterEpicsController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, scopeDefer, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\", \"tgErrorHandlingService\", \"tgProjectService\", \"$tgModel\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1, errorHandlingService, projectService1, model1) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService1;\n      this.model = model1;\n      this.scope.project = {};\n      this.scope.projectTags = [];\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      project = this.model.make_model(\"projects\", project);\n      if (!project.i_am_admin) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.epicStatusList = _.sortBy(project.epic_statuses, \"order\");\n      this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n      this.scope.pointsList = _.sortBy(project.points, \"order\");\n      this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n      this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n      this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n      this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n      this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n      scopeDefer(this.scope, (function(_this) {\n        return function() {\n          return _this.scope.$emit('project:loaded', project);\n        };\n      })(this));\n      this.scope.projectTags = _.map(this.scope.project.tags, (function(_this) {\n        return function(it) {\n          return [it, _this.scope.project.tags_colors[it]];\n        };\n      })(this));\n      return project;\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.tgAuth.refresh();\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    ProjectProfileController.prototype.addTag = function(name, color) {\n      var tags;\n      tags = _.clone(this.scope.project.tags);\n      tags.push(name);\n      this.scope.projectTags.push([name, null]);\n      return this.scope.project.tags = tags;\n    };\n\n    ProjectProfileController.prototype.deleteTag = function(tag) {\n      var tags;\n      tags = _.clone(this.scope.project.tags);\n      _.pull(tags, tag[0]);\n      _.remove(this.scope.projectTags, (function(_this) {\n        return function(it) {\n          return it[0] === tag[0];\n        };\n      })(this));\n      return this.scope.project.tags = tags;\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, privacyChanged, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          privacyChanged = $scope.project.isAttributeModified(\"is_private\");\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            if (privacyChanged && $scope.project.is_private) {\n              $analytics.trackEvent(\"project-privacy-changed\", \"from-public-to-private\", \"Change project privacy from public to private\", 1);\n            } else if (privacyChanged && !$scope.project.is_private) {\n              $analytics.trackEvent(\"project-privacy-changed\", \"from-private-to-public\", \"Change project privacy from private to public\", 1);\n            }\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            projectService.fetchProject().then((function(_this) {\n              return function() {\n                return $ctrl.loadInitialData();\n              };\n            })(this));\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", \"$tgAnalytics\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return $scope.$applyAsync(submit);\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            $analytics.trackEvent(\"exporter\", \"export-project\", \"Exported project\", 1);\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", \"$tgAnalytics\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterEpicsController = (function(superClass) {\n    extend(CsvExporterEpicsController, superClass);\n\n    function CsvExporterEpicsController() {\n      return CsvExporterEpicsController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterEpicsController.prototype.type = \"epics\";\n\n    return CsvExporterEpicsController;\n\n  })(CsvExporterController);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterEpicsController\", CsvExporterEpicsController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvEpicDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_EPIC\";\n    };\n    return {\n      controller: \"CsvExporterEpicsController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvEpic\", [\"$translate\", CsvEpicDirective]);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectTagsController, ProjectTagsDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, RICHTEXT_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, getDefaulColorList, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  getDefaulColorList = this.taiga.getDefaulColorList;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, errorHandlingService, projectService1) {\n      var description, sectionName, title;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService1;\n      this.scope.project = {};\n      this.loadInitialData();\n      sectionName = this.translate.instant(this.scope.sectionName);\n      title = this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n        \"sectionName\": sectionName,\n        \"projectName\": this.scope.project.name\n      });\n      description = this.scope.project.description;\n      this.appMetaService.setAll(title, description);\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.i_am_admin) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      var unwatch;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      unwatch = this.scope.$watch(\"resource\", (function(_this) {\n        return function(resource) {\n          if (resource) {\n            _this.loadValues();\n            return unwatch();\n          }\n        };\n      })(this));\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope, projectService) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      drake = dragula([tdom[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: tdom[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemIndex, itemValue;\n        itemEl = $(item);\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return drake.destroy();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            row.siblings(\".visualization\").removeClass('hidden');\n            return projectService.fetchProject();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", \"tgProjectService\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $scope.colorList = getDefaulColorList();\n      $scope.allowEmpty = false;\n      if ($attrs.tgAllowEmpty) {\n        $scope.allowEmpty = true;\n      }\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        event.stopPropagation();\n        if (event.keyCode === 13) {\n          $scope.$apply(function() {\n            return $model.$modelValue.color = $scope.color;\n          });\n          return $el.find(\".select-color\").hide();\n        } else if (event.keyCode === 27) {\n          return $el.find(\".select-color\").hide();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  RICHTEXT_TYPE = \"richtext\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: RICHTEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_RICHTEXT\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate, projectService1) {\n      var description, sectionName, title;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService1;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = this.projectService.project.toJS();\n      this.scope.projectId = this.scope.project.id;\n      sectionName = this.translate.instant(this.scope.sectionName);\n      title = this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n        \"sectionName\": sectionName,\n        \"projectName\": this.scope.project.name\n      });\n      description = this.scope.project.description;\n      this.appMetaService.setAll(title, description);\n      this.scope.init = (function(_this) {\n        return function(type) {\n          _this.scope.type = type;\n          return _this.loadCustomAttributes();\n        };\n      })(this);\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          var ref;\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = (ref = _.maxBy(customAttributes, \"order\")) != null ? ref.order : void 0;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, drake, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      drake = dragula([sortableEl[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: sortableEl[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = $(item);\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n  ProjectTagsController = (function(superClass) {\n    extend(ProjectTagsController, superClass);\n\n    ProjectTagsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgModel\", \"tgProjectService\"];\n\n    function ProjectTagsController(scope, rootscope, repo, confirm, rs, model, projectService1) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.model = model;\n      this.projectService = projectService1;\n      this.mixingClass = bind(this.mixingClass, this);\n      this.cancelMixingTags = bind(this.cancelMixingTags, this);\n      this.confirmMixingTags = bind(this.confirmMixingTags, this);\n      this.toggleMixingFromTags = bind(this.toggleMixingFromTags, this);\n      this.startMixingTags = bind(this.startMixingTags, this);\n      this.deleteTag = bind(this.deleteTag, this);\n      this.editTag = bind(this.editTag, this);\n      this.createTag = bind(this.createTag, this);\n      this.filterAndSortTags = bind(this.filterAndSortTags, this);\n      this.loadTags = bind(this.loadTags, this);\n      this.loading = true;\n      this.loadTags();\n    }\n\n    ProjectTagsController.prototype.loadTags = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      return this.rs.projects.tagsColors(project.id).then((function(_this) {\n        return function(tags) {\n          _this.scope.projectTagsAll = _.map(tags.getAttrs(), function(color, name) {\n            return _this.model.make_model('tag', {\n              name: name,\n              color: color\n            });\n          });\n          _this.filterAndSortTags();\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.filterAndSortTags = function() {\n      this.scope.projectTags = _.sortBy(this.scope.projectTagsAll, function(it) {\n        return it.name.toLowerCase();\n      });\n      return this.scope.projectTags = _.filter(this.scope.projectTags, (function(_this) {\n        return function(tag) {\n          return tag.name.indexOf(_this.scope.tagsFilter.name) !== -1;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.createTag = function(tag, color) {\n      return this.rs.projects.createTag(this.scope.projectId, tag, color);\n    };\n\n    ProjectTagsController.prototype.editTag = function(from_tag, to_tag, color) {\n      if (from_tag === to_tag) {\n        to_tag = null;\n      }\n      return this.rs.projects.editTag(this.scope.projectId, from_tag, to_tag, color);\n    };\n\n    ProjectTagsController.prototype.deleteTag = function(tag) {\n      this.scope.loadingDelete = true;\n      return this.rs.projects.deleteTag(this.scope.projectId, tag)[\"finally\"]((function(_this) {\n        return function() {\n          return _this.scope.loadingDelete = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.startMixingTags = function(tag) {\n      return this.scope.mixingTags.toTag = tag.name;\n    };\n\n    ProjectTagsController.prototype.toggleMixingFromTags = function(tag) {\n      var index;\n      if (tag.name !== this.scope.mixingTags.toTag) {\n        index = this.scope.mixingTags.fromTags.indexOf(tag.name);\n        if (index === -1) {\n          return this.scope.mixingTags.fromTags.push(tag.name);\n        } else {\n          return this.scope.mixingTags.fromTags.splice(index, 1);\n        }\n      }\n    };\n\n    ProjectTagsController.prototype.confirmMixingTags = function() {\n      var fromTags, toTag;\n      toTag = this.scope.mixingTags.toTag;\n      fromTags = this.scope.mixingTags.fromTags;\n      this.scope.loadingMixing = true;\n      return this.rs.projects.mixTags(this.scope.projectId, toTag, fromTags).then((function(_this) {\n        return function() {\n          _this.cancelMixingTags();\n          return _this.loadTags();\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.scope.loadingMixing = false;\n        };\n      })(this));\n    };\n\n    ProjectTagsController.prototype.cancelMixingTags = function() {\n      this.scope.mixingTags.toTag = null;\n      return this.scope.mixingTags.fromTags = [];\n    };\n\n    ProjectTagsController.prototype.mixingClass = function(tag) {\n      if (this.scope.mixingTags.toTag !== null) {\n        if (tag.name === this.scope.mixingTags.toTag) {\n          return \"mixing-tags-to\";\n        } else if (this.scope.mixingTags.fromTags.indexOf(tag.name) !== -1) {\n          return \"mixing-tags-from\";\n        }\n      }\n    };\n\n    return ProjectTagsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectTagsController\", ProjectTagsController);\n\n  ProjectTagsDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, $window, cancel, goToBottomList, initializeMixingTags, initializeNewValue, initializeTagsFilter, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $window = $(window);\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"tag\": \"\",\n          \"color\": \"\"\n        };\n      };\n      initializeTagsFilter = function() {\n        return $scope.tagsFilter = {\n          \"name\": \"\"\n        };\n      };\n      initializeMixingTags = function() {\n        return $scope.mixingTags = {\n          \"toTag\": null,\n          \"fromTags\": []\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_TAGS.ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTagsFilter();\n      initializeMixingTags();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = (function(_this) {\n        return function(target) {\n          var form, formEl, originalTag, promise, tag;\n          formEl = target.parents(\"form\");\n          form = formEl.checksley();\n          if (!form.validate()) {\n            return;\n          }\n          tag = formEl.scope().tag;\n          originalTag = tag.clone();\n          originalTag.revert();\n          $scope.loadingEdit = true;\n          promise = $ctrl.editTag(originalTag.name, tag.name, tag.color);\n          promise.then(function() {\n            return $ctrl.loadTags().then(function() {\n              var row;\n              row = target.parents(\".row.table-main\");\n              row.addClass(\"hidden\");\n              $scope.loadingEdit = false;\n              return row.siblings(\".visualization\").removeClass('hidden');\n            });\n          });\n          return promise.then(null, function(response) {\n            $scope.loadingEdit = false;\n            return form.setErrors(response.data);\n          });\n        };\n      })(this);\n      saveNewValue = (function(_this) {\n        return function(target) {\n          var form, formEl, promise;\n          formEl = target.parents(\"form\");\n          formEl = target;\n          form = formEl.checksley();\n          if (!form.validate()) {\n            return;\n          }\n          $scope.loadingCreate = true;\n          promise = $ctrl.createTag($scope.newValue.tag, $scope.newValue.color);\n          promise.then(function(data) {\n            return $ctrl.loadTags().then(function() {\n              $scope.loadingCreate = false;\n              target.addClass(\"hidden\");\n              return initializeNewValue();\n            });\n          });\n          return promise.then(null, function(response) {\n            $scope.loadingCreate = false;\n            return form.setErrors(response.data);\n          });\n        };\n      })(this);\n      cancel = function(target) {\n        var formEl, row, tag;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        tag = formEl.scope().tag;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          tag.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $scope.$watch(\"tagsFilter.name\", function(tagsFilter) {\n        return $ctrl.filterAndSortTags();\n      });\n      $window.on(\"keyup\", function(event) {\n        if (event.keyCode === 27) {\n          return $scope.$apply(function() {\n            return initializeMixingTags();\n          });\n        }\n      });\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        return $el.find(\".new-value\").removeClass('hidden');\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".mix-tags\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          return $ctrl.startMixingTags(target.parents('form').scope().tag);\n        });\n      });\n      $el.on(\"click\", \".mixing-row\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          return $ctrl.toggleMixingFromTags(target.parents('form').scope().tag);\n        });\n      });\n      $el.on(\"click\", \".mixing-confirm\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $scope.$apply(function() {\n          return $ctrl.confirmMixingTags();\n        });\n      });\n      $el.on(\"click\", \".mixing-cancel\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $scope.$apply(function() {\n          return $ctrl.cancelMixingTags();\n        });\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"keyup\", \".status-name input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === 13) {\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      $el.on(\"click\", \".delete-tag\", function(event) {\n        var formEl, tag, target, title;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        tag = formEl.scope().tag;\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_TAG\");\n        return $confirm.askOnDelete(title, tag.name).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadTags()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $ctrl.deleteTag(tag.name).then(onSucces, onError);\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $window.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectTags\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectTagsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgModel\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, model, appMetaService, translate, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.model = model;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      project = this.model.make_model(\"projects\", project);\n      if (!project.i_am_admin) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n        return point.computable;\n      }));\n      return project;\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.loadRoles();\n    };\n\n    RolesController.prototype.forceLoadProject = function() {\n      return this.projectService.fetchProject((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this));\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.forceLoadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.forceLoadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.forceLoadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      return this.confirm.ask(title, subtitle, \"\").then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.forceLoadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<tg-svg svg-icon=\\\"icon-arrow-right\\\"></tg-svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, epicPermissions, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        epicPermissions = [\n          {\n            key: \"view_epics\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.VIEW_EPICS\"\n          }, {\n            key: \"add_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.ADD_EPICS\"\n          }, {\n            key: \"modify_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.MODIFY_EPICS\"\n          }, {\n            key: \"comment_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.COMMENT_EPICS\"\n          }, {\n            key: \"delete_epic\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.DELETE_EPICS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.EPICS.NAME\",\n          permissions: setActivePermissions(epicPermissions)\n        });\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"comment_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"comment_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.COMMENT_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"comment_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.COMMENT_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.forceLoadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, GogsController, GogsWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"tgErrorHandlingService\", \"tgProjectService\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate, errorHandlingService, projectService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      if (!project.i_am_admin) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.loadWebhooks();\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\").slideToggle();\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\").slideToggle();\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $analytics.trackEvent(\"webhooks\", \"create\", \"Create new webhook\", 1);\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\", \"tgProjectService\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return this.loadModules();\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\", \"tgProjectService\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.loadModules();\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\", \"tgProjectService\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.loadModules();\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            $analytics.trackEvent(\"github-webhook\", \"created-or-changed\", \"Create or changed github webhook\", 1);\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            $analytics.trackEvent(\"gitlab-webhook\", \"created-or-changed\", \"Create or changed gitlab webhook\", 1);\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            $analytics.trackEvent(\"bitbucket-webhook\", \"created-or-changed\", \"Create or changed bitbucket webhook\", 1);\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n  GogsController = (function(superClass) {\n    extend(GogsController, superClass);\n\n    GogsController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\", \"tgProjectService\"];\n\n    function GogsController(scope, repo, rs, params, appMetaService, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GOGS.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GOGS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GogsController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gogs\").then((function(_this) {\n        return function(gogs) {\n          return _this.scope.gogs = gogs;\n        };\n      })(this));\n    };\n\n    GogsController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      return project;\n    };\n\n    GogsController.prototype.loadInitialData = function() {\n      this.loadProject();\n      return this.loadModules();\n    };\n\n    return GogsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  GogsWebhooksDirective = function($repo, $confirm, $loading, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gogs, \"gogs\");\n          promise.then(function() {\n            $analytics.trackEvent(\"gogs-webhook\", \"create-or-change\", \"Create or change gogs webhook\", 1);\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $el.on(\"click\", \".submit-button\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.controller(\"GogsController\", GogsController);\n\n  module.directive(\"tgGogsWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", GogsWebhooksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService, $analytics) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          $analytics.trackEvent(\"projects\", \"delete\", \"Delete project\", 1);\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", \"$tgAnalytics\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"tgProjectService\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm, projectService) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      this.loadInitialData();\n    }\n\n    ContribController.prototype.loadProject = function() {\n      var project;\n      project = this.projectService.project.toJS();\n      this.scope.projectId = project.id;\n      this.scope.project = project;\n      this.scope.$emit('project:loaded', project);\n      this.scope.$broadcast('project:loaded', project);\n      return project;\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.realClone = function() {\n      var attrs, instance;\n      attrs = _.cloneDeep(this._attrs);\n      instance = new Model(this._name, attrs, this._dataTypes);\n      instance._modifiedAttrs = _.cloneDeep(this._modifiedAttrs);\n      instance._isModified = _.cloneDeep(this._isModified);\n      return instance;\n    };\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data), extraParams);\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch, params, options, returnHeaders) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      if (params == null) {\n        params = {};\n      }\n      if (returnHeaders == null) {\n        returnHeaders = false;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data, params, options);\n      } else {\n        promise = this.http.put(url, data, params, options);\n      }\n      promise.success((function(_this) {\n        return function(data, status, headers, response) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          if (returnHeaders) {\n            return defered.resolve([model, headers()]);\n          } else {\n            return defered.resolve(model);\n          }\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      if (options.ref != null) {\n        params.ref = options.ref;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      epic: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/epic\");\n        }\n      },\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      epic: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/epic\");\n        }\n      },\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/epics.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"epics-queryparams\";\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"epics\", \"by_ref\", params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.upvote = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-upvote\", epicId);\n      return $http.post(url);\n    };\n    service.downvote = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-downvote\", epicId);\n      return $http.post(url);\n    };\n    service.watch = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-watch\", epicId);\n      return $http.post(url);\n    };\n    service.unwatch = function(epicId) {\n      var url;\n      url = $urls.resolve(\"epic-unwatch\", epicId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.epics = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgEpicsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.editComment = function(type, objectId, activityId, comment) {\n      var commentData, params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/edit_comment\";\n      params = {\n        id: activityId\n      };\n      commentData = {\n        comment: comment\n      };\n      return $http.post(url, commentData, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.getCommentHistory = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/comment_versions\";\n      params = {\n        id: activityId\n      };\n      return $http.get(url, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_epics_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_epics_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service.deleteTag = function(projectId, tag) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/delete_tag\";\n      return $http.post(url, {\n        tag: tag\n      });\n    };\n    service.createTag = function(projectId, tag, color) {\n      var data, url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/create_tag\";\n      data = {};\n      data.tag = tag;\n      data.color = null;\n      if (color) {\n        data.color = color;\n      }\n      return $http.post(url, data);\n    };\n    service.editTag = function(projectId, from_tag, to_tag, color) {\n      var data, url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/edit_tag\";\n      data = {};\n      data.from_tag = from_tag;\n      if (to_tag) {\n        data.to_tag = to_tag;\n      }\n      data.color = null;\n      if (color) {\n        data.color = color;\n      }\n      return $http.post(url, data);\n    };\n    service.mixTags = function(projectId, to_tag, from_tags) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/mix_tags\";\n      return $http.post(url, {\n        to_tag: to_tag,\n        from_tags: from_tags\n      });\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId, extraParams) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref, extraParams) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"task-filters\", null, params);\n    };\n    service.list = function(projectId, sprintId, userStoryId, params) {\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = _.merge(params, {\n        project: projectId\n      });\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        milestone_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId, extraParams) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref, extraParams) {\n      var params;\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      params = _.extend({}, params, extraParams);\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters, pageSize) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", _.extend(params, {\n        page_size: pageSize\n      }), {\n        enablePagination: true\n      }, true);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateMilestone = function(projectId, milestoneId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-milestone\");\n      params = {\n        project_id: projectId,\n        milestone_id: milestoneId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"wiki\", {\n        project: projectId\n      });\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\", \"tgErrorHandlingService\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate, errorHandlingService) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.errorHandlingService.permissionDenied();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"tgErrorHandlingService\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, errorHandlingService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.errorHandlingService = errorHandlingService;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaHistory\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUtils\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaWikiHistory\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.directive.coffee\n */\n\n(function() {\n  var AssignedItemDirective;\n\n  AssignedItemDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      templateUrl: \"components/assigned-to/assigned-item/assigned-item.html\",\n      scope: {\n        member: \"=\"\n      },\n      link: link\n    };\n  };\n\n  AssignedItemDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedItem\", AssignedItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.controller.coffee\n */\n\n(function() {\n  var AssignedToSelectorController;\n\n  AssignedToSelectorController = (function() {\n    AssignedToSelectorController.$inject = [];\n\n    function AssignedToSelectorController() {\n      if (this.assigned) {\n        this._getAssignedMember();\n      }\n      this._filterAssignedMember();\n    }\n\n    AssignedToSelectorController.prototype._getAssignedMember = function() {\n      return this.assignedMember = _.filter(this.project.members, (function(_this) {\n        return function(member) {\n          return member.id === _this.assigned.get('id');\n        };\n      })(this));\n    };\n\n    AssignedToSelectorController.prototype._filterAssignedMember = function() {\n      if (this.assigned) {\n        return this.nonAssignedMembers = _.filter(this.project.members, (function(_this) {\n          return function(member) {\n            return member.id !== _this.assigned.get('id');\n          };\n        })(this));\n      } else {\n        return this.nonAssignedMembers = this.project.members;\n      }\n    };\n\n    return AssignedToSelectorController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AssignedToSelectorCtrl', AssignedToSelectorController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to-selector.directive.coffee\n */\n\n(function() {\n  var AssignedToSelectorDirective;\n\n  AssignedToSelectorDirective = function() {\n    return {\n      controller: \"AssignedToSelectorCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/assigned-to/assigned-to-selector/assigned-to-selector.html\",\n      scope: {\n        assigned: \"=\",\n        project: \"=\",\n        onRemoveAssigned: \"&\",\n        onAssignTo: \"&\"\n      }\n    };\n  };\n\n  AssignedToSelectorDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedToSelector\", AssignedToSelectorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to.controller.coffee\n */\n\n(function() {\n  var AssignedToController;\n\n  AssignedToController = (function() {\n    AssignedToController.$inject = [\"tgLightboxFactory\", \"lightboxService\"];\n\n    function AssignedToController(lightboxFactory, lightboxService) {\n      this.lightboxFactory = lightboxFactory;\n      this.lightboxService = lightboxService;\n      this.has_permissions = _.includes(this.project.my_permissions, 'modify_epic');\n    }\n\n    AssignedToController.prototype._closeAndRemoveAssigned = function() {\n      this.lightboxService.closeAll();\n      return this.onRemoveAssigned();\n    };\n\n    AssignedToController.prototype._closeAndAssign = function(member) {\n      this.lightboxService.closeAll();\n      return this.onAssignTo({\n        'member': member\n      });\n    };\n\n    AssignedToController.prototype.onSelectAssignedTo = function(assigned, project) {\n      return this.lightboxFactory.create('tg-assigned-to-selector', {\n        \"class\": \"lightbox lightbox-assigned-to-selector open\",\n        \"assigned\": \"assigned\",\n        \"project\": \"project\",\n        \"on-remove-assigned\": \"onRemoveAssigned()\",\n        \"on-assign-to\": \"assignTo(member)\"\n      }, {\n        \"assigned\": this.assignedTo,\n        \"project\": this.project,\n        \"onRemoveAssigned\": this._closeAndRemoveAssigned.bind(this),\n        \"assignTo\": this._closeAndAssign.bind(this)\n      });\n    };\n\n    return AssignedToController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AssignedToCtrl', AssignedToController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: assigned-to.directive.coffee\n */\n\n(function() {\n  var AssignedToDirective;\n\n  AssignedToDirective = function() {\n    return {\n      controller: \"AssignedToCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/assigned-to/assigned-to.html\",\n      scope: {\n        assignedTo: \"=\",\n        project: \"=\",\n        onRemoveAssigned: \"&\",\n        onAssignTo: \"&\"\n      }\n    };\n  };\n\n  AssignedToDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAssignedToComponent\", AssignedToDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, attachmentsPreviewService, lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            lightboxService.open($('tg-attachments-preview'));\n            return attachmentsPreviewService.fileId = attachment.getIn(['file', 'id']);\n          });\n        } else if (taiga.isPdf(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return window.open(attachment.getIn(['file', 'url']));\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgAttachmentsPreviewService\", \"lightboxService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\", \"tgAttachmentsPreviewService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService, attachmentsPreviewService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.attachmentsPreviewService = attachmentsPreviewService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      this.attachmentsPreviewService.fileId = null;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable, comment) {\n      if (editable == null) {\n        editable = true;\n      }\n      if (comment == null) {\n        comment = false;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type, comment);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false,\n                from_comment: comment\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(new Error(file));\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-preview.controller.coffee\n */\n\n(function() {\n  var AttachmentsPreviewController;\n\n  AttachmentsPreviewController = (function() {\n    AttachmentsPreviewController.$inject = [\"tgAttachmentsPreviewService\"];\n\n    function AttachmentsPreviewController(attachmentsPreviewService) {\n      this.attachmentsPreviewService = attachmentsPreviewService;\n      taiga.defineImmutableProperty(this, \"current\", (function(_this) {\n        return function() {\n          if (!_this.attachmentsPreviewService.fileId) {\n            return null;\n          }\n          return _this.getCurrent();\n        };\n      })(this));\n    }\n\n    AttachmentsPreviewController.prototype.hasPagination = function() {\n      var images;\n      images = this.attachments.filter((function(_this) {\n        return function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        };\n      })(this));\n      return images.size > 1;\n    };\n\n    AttachmentsPreviewController.prototype.getCurrent = function() {\n      var attachment, file;\n      attachment = this.attachments.find((function(_this) {\n        return function(attachment) {\n          return _this.attachmentsPreviewService.fileId === attachment.getIn(['file', 'id']);\n        };\n      })(this));\n      file = attachment.get('file');\n      return file;\n    };\n\n    AttachmentsPreviewController.prototype.getIndex = function() {\n      return this.attachments.findIndex((function(_this) {\n        return function(attachment) {\n          return _this.attachmentsPreviewService.fileId === attachment.getIn(['file', 'id']);\n        };\n      })(this));\n    };\n\n    AttachmentsPreviewController.prototype.next = function() {\n      var attachmentIndex, image;\n      attachmentIndex = this.getIndex();\n      image = this.attachments.slice(attachmentIndex + 1).find(function(attachment) {\n        return taiga.isImage(attachment.getIn(['file', 'name']));\n      });\n      if (!image) {\n        image = this.attachments.find(function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        });\n      }\n      return this.attachmentsPreviewService.fileId = image.getIn(['file', 'id']);\n    };\n\n    AttachmentsPreviewController.prototype.previous = function() {\n      var attachmentIndex, image;\n      attachmentIndex = this.getIndex();\n      image = this.attachments.slice(0, attachmentIndex).findLast(function(attachment) {\n        return taiga.isImage(attachment.getIn(['file', 'name']));\n      });\n      if (!image) {\n        image = this.attachments.findLast(function(attachment) {\n          return taiga.isImage(attachment.getIn(['file', 'name']));\n        });\n      }\n      return this.attachmentsPreviewService.fileId = image.getIn(['file', 'id']);\n    };\n\n    return AttachmentsPreviewController;\n\n  })();\n\n  angular.module('taigaComponents').controller('AttachmentsPreview', AttachmentsPreviewController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-preview.directive.coffee\n */\n\n(function() {\n  var AttachmentPreviewLightboxDirective;\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, attachmentsPreviewService) {\n    var link;\n    link = function($scope, el, attrs, ctrl) {\n      $(document.body).on(\"keydown.image-preview\", function(e) {\n        if (attachmentsPreviewService.fileId) {\n          if (e.keyCode === 39) {\n            ctrl.next();\n          } else if (e.keyCode === 37) {\n            ctrl.previous();\n          }\n        }\n        return $scope.$digest();\n      });\n      return $scope.$on('$destroy', function() {\n        return $(document.body).off('.image-preview');\n      });\n    };\n    return {\n      scope: {},\n      controller: 'AttachmentsPreview',\n      templateUrl: 'components/attachments-preview/attachments-preview.html',\n      link: link,\n      controllerAs: \"vm\",\n      bindToController: {\n        attachments: \"=\"\n      }\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgAttachmentsPreview\", [\"lightboxService\", \"tgAttachmentsPreviewService\", AttachmentPreviewLightboxDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-preview.service.coffee\n */\n\n(function() {\n  var AttachmentsPreviewService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsPreviewService = (function(superClass) {\n    extend(AttachmentsPreviewService, superClass);\n\n    AttachmentsPreviewService.$inject = [];\n\n    function AttachmentsPreviewService() {}\n\n    return AttachmentsPreviewService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsPreviewService\", AttachmentsPreviewService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var attachment, newIndex;\n        item = $(item);\n        attachment = item.scope().attachment;\n        newIndex = item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: avatar.directive.coffee\n */\n\n(function() {\n  var AvatarDirective;\n\n  AvatarDirective = function(avatarService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attributeName;\n      if (attrs.tgAvatarBig) {\n        attributeName = 'avatarBig';\n      } else {\n        attributeName = 'avatar';\n      }\n      return scope.$watch(attributeName, function(user) {\n        var avatar;\n        avatar = avatarService.getAvatar(user, attributeName);\n        el.attr('src', avatar.url);\n        return el.css('background', avatar.bg || \"\");\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        avatar: \"=tgAvatar\",\n        avatarBig: \"=tgAvatarBig\"\n      }\n    };\n  };\n\n  AvatarDirective.$inject = ['tgAvatarService'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAvatar\", AvatarDirective);\n\n  angular.module(\"taigaComponents\").directive(\"tgAvatarBig\", AvatarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: belong-to-epics.directive.coffee\n */\n\n(function() {\n  var BelongToEpicsDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  BelongToEpicsDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs) {\n      return scope.$watch('epics', function(epics) {\n        if (epics && !epics.isIterable) {\n          return scope.immutable_epics = Immutable.fromJS(epics);\n        }\n      });\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.format) {\n        return \"components/belong-to-epics/belong-to-epics-\" + attrs.format + \".html\";\n      }\n      return \"components/belong-to-epics/belong-to-epics-pill.html\";\n    };\n    return {\n      link: link,\n      scope: {\n        epics: '='\n      },\n      templateUrl: templateUrl\n    };\n  };\n\n  module.directive(\"tgBelongToEpics\", BelongToEpicsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/bind-code.directive.coffee\n */\n\n(function() {\n  var BindCode;\n\n  BindCode = function($sce, $parse, $compile, wysiwygService, wysiwygCodeHightlighterService) {\n    return {\n      restrict: 'A',\n      compile: function(tElement, tAttrs) {\n        var tgBindCodeGetter, tgBindCodeWatch;\n        tgBindCodeGetter = $parse(tAttrs.tgBindCode);\n        tgBindCodeWatch = $parse(tAttrs.tgBindCode, function(value) {\n          return (value || '').toString();\n        });\n        $compile.$$addBindingClass(tElement);\n        return function(scope, element, attr) {\n          $compile.$$addBindingInfo(element, attr.tgBindCode);\n          return scope.$watch(tgBindCodeWatch, function() {\n            var html;\n            html = wysiwygService.getHTML(tgBindCodeGetter(scope));\n            element.html($sce.getTrustedHtml(html) || '');\n            return wysiwygCodeHightlighterService.addHightlighter(element);\n          });\n        };\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgBindCode\", [\"$sce\", \"$parse\", \"$compile\", \"tgWysiwygService\", \"tgWysiwygCodeHightlighterService\", BindCode]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: board-zoom.directive.coffee\n */\n\n(function() {\n  var BoardZoomDirective;\n\n  BoardZoomDirective = function() {\n    return {\n      scope: {\n        levels: \"=\",\n        value: \"=\"\n      },\n      templateUrl: 'components/board-zoom/board-zoom.html'\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgBoardZoom\", [BoardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card-slideshow.controller.coffee\n */\n\n(function() {\n  var CardSlideshowController;\n\n  CardSlideshowController = (function() {\n    CardSlideshowController.$inject = [];\n\n    function CardSlideshowController() {\n      this.index = 0;\n    }\n\n    CardSlideshowController.prototype.next = function() {\n      this.index++;\n      if (this.index >= this.images.size) {\n        return this.index = 0;\n      }\n    };\n\n    CardSlideshowController.prototype.previous = function() {\n      this.index--;\n      if (this.index < 0) {\n        return this.index = this.images.size - 1;\n      }\n    };\n\n    return CardSlideshowController;\n\n  })();\n\n  angular.module('taigaComponents').controller('CardSlideshow', CardSlideshowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.directive.coffee\n */\n\n(function() {\n  var cardSlideshowDirective, module;\n\n  module = angular.module(\"taigaComponents\");\n\n  cardSlideshowDirective = function() {\n    return {\n      controller: \"CardSlideshow\",\n      templateUrl: \"components/card-slideshow/card-slideshow.html\",\n      bindToController: true,\n      controllerAs: \"vm\",\n      scope: {\n        images: \"=\"\n      }\n    };\n  };\n\n  module.directive('tgCardSlideshow', cardSlideshowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.controller.coffee\n */\n\n(function() {\n  var CardController;\n\n  CardController = (function() {\n    function CardController() {}\n\n    CardController.$inject = [];\n\n    CardController.prototype.visible = function(name) {\n      return this.zoom.indexOf(name) !== -1;\n    };\n\n    CardController.prototype.hasTasks = function() {\n      var tasks;\n      tasks = this.item.getIn(['model', 'tasks']);\n      return tasks && tasks.size > 0;\n    };\n\n    CardController.prototype.hasVisibleAttachments = function() {\n      return this.item.get('images').size > 0;\n    };\n\n    CardController.prototype.toggleFold = function() {\n      return this.onToggleFold({\n        id: this.item.get('id')\n      });\n    };\n\n    CardController.prototype.getClosedTasks = function() {\n      return this.item.getIn(['model', 'tasks']).filter(function(task) {\n        return task.get('is_closed');\n      });\n    };\n\n    CardController.prototype.closedTasksPercent = function() {\n      return this.getClosedTasks().size * 100 / this.item.getIn(['model', 'tasks']).size;\n    };\n\n    CardController.prototype.getPermissionsKey = function() {\n      if (this.type === 'task') {\n        return 'modify_task';\n      } else {\n        return 'modify_us';\n      }\n    };\n\n    CardController.prototype._setVisibility = function() {\n      var visibility;\n      visibility = {\n        related: this.visible('related_tasks'),\n        slides: this.visible('attachments')\n      };\n      if (!_.isUndefined(this.item.get('foldStatusChanged'))) {\n        if (this.visible('related_tasks') && this.visible('attachments')) {\n          visibility.related = !this.item.get('foldStatusChanged');\n          visibility.slides = !this.item.get('foldStatusChanged');\n        } else if (this.visible('attachments')) {\n          visibility.related = this.item.get('foldStatusChanged');\n          visibility.slides = this.item.get('foldStatusChanged');\n        } else if (!this.visible('related_tasks') && !this.visible('attachments')) {\n          visibility.related = this.item.get('foldStatusChanged');\n          visibility.slides = this.item.get('foldStatusChanged');\n        }\n      }\n      if (!this.item.getIn(['model', 'tasks']) || !this.item.getIn(['model', 'tasks']).size) {\n        visibility.related = false;\n      }\n      if (!this.item.get('images') || !this.item.get('images').size) {\n        visibility.slides = false;\n      }\n      return visibility;\n    };\n\n    CardController.prototype.isRelatedTasksVisible = function() {\n      var visibility;\n      visibility = this._setVisibility();\n      return visibility.related;\n    };\n\n    CardController.prototype.isSlideshowVisible = function() {\n      var visibility;\n      visibility = this._setVisibility();\n      return visibility.slides;\n    };\n\n    CardController.prototype.getNavKey = function() {\n      if (this.type === 'task') {\n        return 'project-tasks-detail';\n      } else {\n        return 'project-userstories-detail';\n      }\n    };\n\n    return CardController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Card', CardController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: card.directive.coffee\n */\n\n(function() {\n  var cardDirective, module;\n\n  module = angular.module(\"taigaComponents\");\n\n  cardDirective = function() {\n    return {\n      link: function(scope) {},\n      controller: \"Card\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"components/card/card.html\",\n      scope: {\n        onToggleFold: \"&\",\n        onClickAssignedTo: \"&\",\n        onClickEdit: \"&\",\n        project: \"=\",\n        item: \"=\",\n        zoom: \"=\",\n        zoomLevel: \"=\",\n        archived: \"=\",\n        type: \"@\"\n      }\n    };\n  };\n\n  module.directive('tgCard', cardDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/click-input-file.directive.coffee\n */\n\n(function() {\n  var ClickInputFile;\n\n  ClickInputFile = function() {\n    return {\n      link: function(scope, el) {\n        el.on('click', function(e) {\n          var inputFile;\n          if (!$(e.target).is('input')) {\n            e.preventDefault();\n            inputFile = el.find('input[type=\"file\"]');\n            inputFile.val('');\n            return inputFile.trigger('click');\n          }\n        });\n        return scope.$on(\"$destroy\", function() {\n          return el.off();\n        });\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgClickInputFile\", [ClickInputFile]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: color-selector.controller.coffee\n */\n\n(function() {\n  var ColorSelectorController, getDefaulColorList, taiga;\n\n  taiga = this.taiga;\n\n  getDefaulColorList = taiga.getDefaulColorList;\n\n  ColorSelectorController = (function() {\n    ColorSelectorController.$inject = [\"tgProjectService\"];\n\n    function ColorSelectorController(projectService) {\n      this.projectService = projectService;\n      this.colorList = getDefaulColorList();\n      this.checkIsColorRequired();\n      this.displayColorList = false;\n    }\n\n    ColorSelectorController.prototype.userCanChangeColor = function() {\n      if (!this.requiredPerm) {\n        return true;\n      }\n      return this.projectService.hasPermission(this.requiredPerm);\n    };\n\n    ColorSelectorController.prototype.checkIsColorRequired = function() {\n      if (!this.isColorRequired) {\n        return this.colorList = _.dropRight(this.colorList);\n      }\n    };\n\n    ColorSelectorController.prototype.setColor = function(color) {\n      this.color = color;\n      return this.customColor = color;\n    };\n\n    ColorSelectorController.prototype.resetColor = function() {\n      if (this.isColorRequired && !this.color) {\n        return this.color = this.initColor;\n      }\n    };\n\n    ColorSelectorController.prototype.toggleColorList = function() {\n      this.displayColorList = !this.displayColorList;\n      this.customColor = this.color;\n      return this.resetColor();\n    };\n\n    ColorSelectorController.prototype.onSelectDropdownColor = function(color) {\n      this.color = color;\n      this.onSelectColor({\n        color: color\n      });\n      return this.toggleColorList();\n    };\n\n    ColorSelectorController.prototype.onKeyDown = function(event) {\n      if (event.which === 13) {\n        if (this.customColor || !this.isColorRequired) {\n          this.onSelectDropdownColor(this.customColor);\n        }\n        return event.preventDefault();\n      }\n    };\n\n    return ColorSelectorController;\n\n  })();\n\n  angular.module('taigaComponents').controller(\"ColorSelectorCtrl\", ColorSelectorController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: color-selector.directive.coffee\n */\n\n(function() {\n  var ColorSelectorDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  ColorSelectorDirective = function($timeout) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var _timeout, cancel, close;\n      _timeout = null;\n      cancel = function() {\n        $timeout.cancel(_timeout);\n        return _timeout = null;\n      };\n      close = function() {\n        if (_timeout) {\n          return;\n        }\n        return _timeout = $timeout((function() {\n          ctrl.displayColorList = false;\n          return ctrl.resetColor();\n        }), 400);\n      };\n      el.find('.color-selector').mouseenter(cancel).mouseleave(close);\n      el.find('.color-selector-dropdown').mouseenter(cancel).mouseleave(close);\n      return scope.$watch('vm.initColor', function(color) {\n        return ctrl.setColor(color);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"components/color-selector/color-selector.html\",\n      controller: \"ColorSelectorCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        isColorRequired: \"=\",\n        onSelectColor: \"&\",\n        initColor: \"=\",\n        requiredPerm: \"@\"\n      },\n      scope: {}\n    };\n  };\n\n  ColorSelectorDirective.$inject = [\"$timeout\"];\n\n  angular.module('taigaComponents').directive(\"tgColorSelector\", ColorSelectorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: story-header.controller.coffee\n */\n\n(function() {\n  var StoryHeaderController, module;\n\n  module = angular.module(\"taigaUserStories\");\n\n  StoryHeaderController = (function() {\n    StoryHeaderController.$inject = [\"$rootScope\", \"$tgConfirm\", \"$tgQueueModelTransformation\", \"$tgNavUrls\", \"$window\"];\n\n    function StoryHeaderController(rootScope, confirm, modelTransform, navUrls, window) {\n      this.rootScope = rootScope;\n      this.confirm = confirm;\n      this.modelTransform = modelTransform;\n      this.navUrls = navUrls;\n      this.window = window;\n      this.editMode = false;\n      this.loadingSubject = false;\n      this.originalSubject = this.item.subject;\n      this.rootScope.$on(\"flytrap:a\", (function(_this) {\n        return function(e, d) {\n          return _this.saveSubject();\n        };\n      })(this));\n      this.rootScope.$on(\"flytrap:task\", (function(_this) {\n        return function(e, d) {\n          return _this.saveSubject();\n        };\n      })(this));\n    }\n\n    StoryHeaderController.prototype._checkNav = function() {\n      var ctx, ref, ref1;\n      if (((ref = this.item.neighbors.previous) != null ? ref.ref : void 0) != null) {\n        ctx = {\n          project: this.project.slug,\n          ref: this.item.neighbors.previous.ref\n        };\n        this.previousUrl = this.navUrls.resolve(\"project-\" + this.item._name + \"-detail\", ctx);\n      }\n      if (((ref1 = this.item.neighbors.next) != null ? ref1.ref : void 0) != null) {\n        ctx = {\n          project: this.project.slug,\n          ref: this.item.neighbors.next.ref\n        };\n        return this.nextUrl = this.navUrls.resolve(\"project-\" + this.item._name + \"-detail\", ctx);\n      }\n    };\n\n    StoryHeaderController.prototype._checkPermissions = function() {\n      return this.permissions = {\n        canEdit: _.includes(this.project.my_permissions, this.requiredPerm)\n      };\n    };\n\n    StoryHeaderController.prototype.editSubject = function(value) {\n      var selection;\n      selection = this.window.getSelection();\n      if (selection.type !== \"Range\") {\n        if (value) {\n          this.editMode = true;\n        }\n        if (!value) {\n          return this.editMode = false;\n        }\n      }\n    };\n\n    StoryHeaderController.prototype.onKeyDown = function(event) {\n      if (event.which === 13) {\n        this.saveSubject();\n      }\n      if (event.which === 27) {\n        this.item.subject = this.originalSubject;\n        return this.editSubject(false);\n      }\n    };\n\n    StoryHeaderController.prototype.saveSubject = function() {\n      var item, onEditSubjectError, onEditSubjectSuccess, transform;\n      onEditSubjectSuccess = (function(_this) {\n        return function() {\n          _this.loadingSubject = false;\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.confirm.notify('success');\n          return _this.originalSubject = _this.item.subject;\n        };\n      })(this);\n      onEditSubjectError = (function(_this) {\n        return function() {\n          _this.loadingSubject = false;\n          return _this.confirm.notify('error');\n        };\n      })(this);\n      this.editMode = false;\n      this.loadingSubject = true;\n      item = this.item;\n      if (item.estimated_start) {\n        item.estimated_start = moment(item.estimated_start).format('YYYY-MM-DD HH:mm:ss');\n      }\n      if (item.estimated_end) {\n        item.estimated_end = moment(item.estimated_end).format('YYYY-MM-DD HH:mm:ss');\n      }\n      transform = this.modelTransform.save(function(item) {\n        return item;\n      });\n      return transform.then(onEditSubjectSuccess, onEditSubjectError);\n    };\n\n    return StoryHeaderController;\n\n  })();\n\n  module.controller(\"StoryHeaderCtrl\", StoryHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: story-header.directive.coffee\n */\n\n(function() {\n  var DetailHeaderDirective, module;\n\n  module = angular.module('taigaUserStories');\n\n  DetailHeaderDirective = function() {\n    var link;\n    this.$inject = [];\n    link = function(scope, el, attrs, ctrl) {\n      ctrl._checkPermissions();\n      return ctrl._checkNav();\n    };\n    return {\n      link: link,\n      controller: \"StoryHeaderCtrl\",\n      bindToController: true,\n      scope: {\n        item: \"=\",\n        project: \"=\",\n        requiredPerm: \"@\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/detail/header/detail-header.html\"\n    };\n  };\n\n  module.directive(\"tgDetailHeader\", DetailHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter-utils.service.coffee\n */\n\n(function() {\n  var FilterRemoteStorageService, generateHash,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  generateHash = taiga.generateHash;\n\n  FilterRemoteStorageService = (function(superClass) {\n    extend(FilterRemoteStorageService, superClass);\n\n    FilterRemoteStorageService.$inject = [\"$q\", \"$tgUrls\", \"$tgHttp\"];\n\n    function FilterRemoteStorageService(q, urls, http) {\n      this.q = q;\n      this.urls = urls;\n      this.http = http;\n    }\n\n    FilterRemoteStorageService.prototype.storeFilters = function(projectId, myFilters, filtersHashSuffix) {\n      var deferred, hash, ns, promise, url;\n      deferred = this.q.defer();\n      url = this.urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + filtersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = this.http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = this.http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, (function(_this) {\n          return function(data) {\n            var innerPromise;\n            innerPromise = _this.http.post(\"\" + url, {\n              key: hash,\n              value: myFilters\n            });\n            innerPromise.then(function() {\n              return deferred.resolve();\n            });\n            return innerPromise.then(null, function() {\n              return deferred.reject();\n            });\n          };\n        })(this));\n      }\n      return deferred.promise;\n    };\n\n    FilterRemoteStorageService.prototype.getFilters = function(projectId, filtersHashSuffix) {\n      var deferred, hash, ns, promise, url;\n      deferred = this.q.defer();\n      url = this.urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + filtersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = this.http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n\n    return FilterRemoteStorageService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgFilterRemoteStorageService\", FilterRemoteStorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.-slide-down.controller.coffee\n */\n\n(function() {\n  var FilterSlideDownDirective;\n\n  FilterSlideDownDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var filter;\n      filter = $('tg-filter');\n      return scope.$watch(attrs.ngIf, function(value) {\n        var contentHeight, wrapperHeight;\n        if (value) {\n          filter.find('.filter-list').hide();\n          wrapperHeight = filter.height();\n          contentHeight = 0;\n          filter.children().each(function() {\n            return contentHeight += $(this).outerHeight(true);\n          });\n          return $(el.context.nextSibling).css({\n            \"max-height\": wrapperHeight - contentHeight,\n            \"display\": \"block\"\n          });\n        }\n      });\n    };\n    return {\n      priority: 900,\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgFilterSlideDown\", [FilterSlideDownDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.controller.coffee\n */\n\n(function() {\n  var FilterController;\n\n  FilterController = (function() {\n    FilterController.$inject = [];\n\n    function FilterController() {\n      this.opened = null;\n      this.customFilterForm = false;\n      this.customFilterName = '';\n    }\n\n    FilterController.prototype.toggleFilterCategory = function(filterName) {\n      if (this.opened === filterName) {\n        return this.opened = null;\n      } else {\n        return this.opened = filterName;\n      }\n    };\n\n    FilterController.prototype.isOpen = function(filterName) {\n      return this.opened === filterName;\n    };\n\n    FilterController.prototype.saveCustomFilter = function() {\n      this.onSaveCustomFilter({\n        name: this.customFilterName\n      });\n      this.customFilterForm = false;\n      this.opened = 'custom-filter';\n      return this.customFilterName = '';\n    };\n\n    FilterController.prototype.changeQ = function() {\n      return this.onChangeQ({\n        q: this.q\n      });\n    };\n\n    FilterController.prototype.unselectFilter = function(filter) {\n      return this.onRemoveFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.unselectFilter = function(filter) {\n      return this.onRemoveFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.selectFilter = function(filterCategory, filter) {\n      filter = {\n        category: filterCategory,\n        filter: filter\n      };\n      return this.onAddFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.removeCustomFilter = function(filter) {\n      return this.onRemoveCustomFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.selectCustomFilter = function(filter) {\n      return this.onSelectCustomFilter({\n        filter: filter\n      });\n    };\n\n    FilterController.prototype.isFilterSelected = function(filterCategory, filter) {\n      return !!_.find(this.selectedFilters, function(it) {\n        return filter.id === it.id && filterCategory.dataType === it.dataType;\n      });\n    };\n\n    return FilterController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Filter', FilterController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: filter.directive.coffee\n */\n\n(function() {\n  var FilterDirective;\n\n  FilterDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var unwatch;\n      unwatch = scope.$watch(\"vm.defaultQ\", function(q) {\n        if (q && !scope.vm.filtersForm.$dirty) {\n          scope.vm.q = q;\n          return unwatch();\n        } else if (scope.vm.filtersForm.$dirty) {\n          return unwatch();\n        }\n      });\n      return attrs.$observe(\"open\", function(open) {\n        open = scope.$eval(open);\n        if (open) {\n          return el.addClass('open');\n        } else {\n          return el.removeClass('open');\n        }\n      });\n    };\n    return {\n      scope: {\n        onChangeQ: \"&\",\n        onAddFilter: \"&\",\n        onSelectCustomFilter: \"&\",\n        onRemoveFilter: \"&\",\n        onRemoveCustomFilter: \"&\",\n        onSaveCustomFilter: \"&\",\n        customFilters: \"<\",\n        defaultQ: \"=q\",\n        filters: \"<\",\n        customFilters: \"<\",\n        selectedFilters: \"<\"\n      },\n      bindToController: true,\n      controller: \"Filter\",\n      controllerAs: \"vm\",\n      templateUrl: 'components/filter/filter.html',\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgFilter\", [FilterDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.add-action',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: kanban-board-zoom.directive.coffee\n */\n\n(function() {\n  var KanbanBoardZoomDirective;\n\n  KanbanBoardZoomDirective = function(storage, projectService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var getZoomView, unwatch, zooms;\n      scope.zoomIndex = storage.get(\"kanban_zoom\") || 2;\n      scope.levels = 5;\n      zooms = [[\"ref\"], [\"subject\"], [\"owner\", \"tags\", \"extra_info\", \"unfold\"], [\"attachments\"], [\"related_tasks\", \"empty_extra_info\"]];\n      getZoomView = function(zoomIndex) {\n        if (zoomIndex == null) {\n          zoomIndex = 0;\n        }\n        if (storage.get(\"kanban_zoom\") !== zoomIndex) {\n          storage.set(\"kanban_zoom\", zoomIndex);\n        }\n        return _.reduce(zooms, function(result, value, key) {\n          if (key <= zoomIndex) {\n            result = result.concat(value);\n          }\n          return result;\n        });\n      };\n      scope.$watch('zoomIndex', function(zoomLevel) {\n        var zoom;\n        zoom = getZoomView(zoomLevel);\n        return scope.onZoomChange({\n          zoomLevel: zoomLevel,\n          zoom: zoom\n        });\n      });\n      return unwatch = scope.$watch(function() {\n        return projectService.project;\n      }, function(project) {\n        if (project) {\n          if (project.get('my_permissions').indexOf(\"view_tasks\") === -1) {\n            scope.levels = 4;\n          }\n          return unwatch();\n        }\n      });\n    };\n    return {\n      scope: {\n        onZoomChange: \"&\"\n      },\n      template: \"<tg-board-zoom\\n    class=\\\"board-zoom\\\"\\n    value=\\\"zoomIndex\\\"\\n    levels=\\\"levels\\\"\\n></tg-board-zoom>\",\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgKanbanBoardZoom\", [\"$tgStorage\", \"tgProjectService\", KanbanBoardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        epics: false,\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_epics_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_epics\") !== -1) {\n        this.menu = this.menu.set(\"epics\", true);\n      }\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagOptionDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagOptionDirective = function() {\n    var dispatch, link, select, stop;\n    select = function(selected) {\n      var containerHeight, diff, selectedPosition;\n      selected.addClass('selected');\n      selectedPosition = selected.position().top + selected.outerHeight();\n      containerHeight = selected.parent().outerHeight();\n      if (selectedPosition > containerHeight) {\n        diff = selectedPosition - containerHeight;\n        return selected.parent().scrollTop(selected.parent().scrollTop() + diff);\n      } else if (selected.position().top < 0) {\n        return selected.parent().scrollTop(selected.parent().scrollTop() + selected.position().top);\n      }\n    };\n    dispatch = function(el, code, scope) {\n      var activeElement, next, prev;\n      activeElement = el.find(\".selected\");\n      if (code === 40) {\n        if (!activeElement.length) {\n          return select(el.find('li:first'));\n        } else {\n          next = activeElement.next('li');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return select(next);\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return select(el.find('li:last'));\n        } else {\n          prev = activeElement.prev('li');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return select(prev);\n          }\n        }\n      }\n    };\n    stop = function() {\n      return $(document).off(\".tags-keyboard-navigation\");\n    };\n    link = function(scope, el) {\n      stop();\n      $(el).parent().on(\"keydown.tags-keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38) {\n            event.preventDefault();\n            return dispatch(el, code, scope);\n          }\n        };\n      })(this));\n      return scope.$on(\"$destroy\", stop);\n    };\n    return {\n      link: link,\n      templateUrl: \"components/tags/tag-dropdown/tag-dropdown.html\",\n      scope: {\n        onSelectTag: \"&\",\n        colorArray: \"=\",\n        tag: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTagsDropdown\", TagOptionDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.controller.coffee\n */\n\n(function() {\n  var TagLineCommonController, module, trim;\n\n  trim = this.taiga.trim;\n\n  module = angular.module('taigaCommon');\n\n  TagLineCommonController = (function() {\n    TagLineCommonController.$inject = [\"tgTagLineService\"];\n\n    function TagLineCommonController(tagLineService) {\n      this.tagLineService = tagLineService;\n      this.disableColorSelection = false;\n      this.newTag = {\n        name: \"\",\n        color: null\n      };\n      this.colorArray = [];\n      this.addTag = false;\n    }\n\n    TagLineCommonController.prototype.checkPermissions = function() {\n      return this.tagLineService.checkPermissions(this.project.my_permissions, this.permissions);\n    };\n\n    TagLineCommonController.prototype._createColorsArray = function(projectTagColors) {\n      return this.colorArray = this.tagLineService.createColorsArray(projectTagColors);\n    };\n\n    TagLineCommonController.prototype.displayTagInput = function() {\n      return this.addTag = true;\n    };\n\n    TagLineCommonController.prototype.addNewTag = function(name, color) {\n      this.newTag.name = \"\";\n      this.newTag.color = null;\n      if (!name.length) {\n        return;\n      }\n      if (this.disableColorSelection) {\n        if (name.length) {\n          return this.onAddTag({\n            name: name,\n            color: color\n          });\n        }\n      } else {\n        if (this.project.tags_colors[name]) {\n          color = this.project.tags_colors[name];\n        }\n        return this.onAddTag({\n          name: name,\n          color: color\n        });\n      }\n    };\n\n    TagLineCommonController.prototype.selectColor = function(color) {\n      return this.newTag.color = color;\n    };\n\n    return TagLineCommonController;\n\n  })();\n\n  module.controller(\"TagLineCommonCtrl\", TagLineCommonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagLineCommonDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagLineCommonDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {\n      var unwatch;\n      if (!_.isUndefined(attr.disableColorSelection)) {\n        ctrl.disableColorSelection = true;\n      }\n      unwatch = scope.$watch(\"vm.project\", function(project) {\n        if (!project || !Object.keys(project).length) {\n          return;\n        }\n        unwatch();\n        if (!ctrl.disableColorSelection) {\n          return ctrl.colorArray = ctrl._createColorsArray(ctrl.project.tags_colors);\n        }\n      });\n      return el.on(\"keydown\", \".tag-input\", function(event) {\n        var tagName;\n        if (event.keyCode === 27) {\n          ctrl.addTag = false;\n          ctrl.newTag.name = \"\";\n          ctrl.newTag.color = \"\";\n          event.stopPropagation();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          if (el.find('.tags-dropdown .selected').length) {\n            tagName = $('.tags-dropdown .selected .tags-dropdown-name').text();\n            ctrl.addNewTag(tagName, null);\n          } else {\n            ctrl.addNewTag(ctrl.newTag.name, ctrl.newTag.color);\n          }\n        }\n        return scope.$apply();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        permissions: \"@\",\n        loadingAddTag: \"=\",\n        loadingRemoveTag: \"=\",\n        tags: \"=\",\n        project: \"=\",\n        onAddTag: \"&\",\n        onDeleteTag: \"&\"\n      },\n      templateUrl: \"components/tags/tag-line-common/tag-line-common.html\",\n      controller: \"TagLineCommonCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true\n    };\n  };\n\n  module.directive(\"tgTagLineCommon\", TagLineCommonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.controller.coffee\n */\n\n(function() {\n  var TagLineController, module, trim;\n\n  trim = this.taiga.trim;\n\n  module = angular.module('taigaCommon');\n\n  TagLineController = (function() {\n    TagLineController.$inject = [\"$rootScope\", \"$tgConfirm\", \"$tgQueueModelTransformation\"];\n\n    function TagLineController(rootScope, confirm, modelTransform) {\n      this.rootScope = rootScope;\n      this.confirm = confirm;\n      this.modelTransform = modelTransform;\n      this.loadingAddTag = false;\n    }\n\n    TagLineController.prototype.onDeleteTag = function(tag) {\n      var onDeleteTagError, onDeleteTagSuccess, tagName, transform;\n      this.loadingRemoveTag = tag[0];\n      onDeleteTagSuccess = (function(_this) {\n        return function(item) {\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.loadingRemoveTag = false;\n          return item;\n        };\n      })(this);\n      onDeleteTagError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.loadingRemoveTag = false;\n        };\n      })(this);\n      tagName = trim(tag[0].toLowerCase());\n      transform = this.modelTransform.save(function(item) {\n        var itemtags;\n        itemtags = _.clone(item.tags);\n        _.remove(itemtags, function(tag) {\n          return tag[0] === tagName;\n        });\n        item.tags = itemtags;\n        return item;\n      });\n      return transform.then(onDeleteTagSuccess, onDeleteTagError);\n    };\n\n    TagLineController.prototype.onAddTag = function(tag, color) {\n      var onAddTagError, onAddTagSuccess, transform;\n      this.loadingAddTag = true;\n      onAddTagSuccess = (function(_this) {\n        return function(item) {\n          _this.rootScope.$broadcast(\"object:updated\");\n          _this.addTag = false;\n          _this.loadingAddTag = false;\n          return item;\n        };\n      })(this);\n      onAddTagError = (function(_this) {\n        return function() {\n          _this.loadingAddTag = false;\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      transform = this.modelTransform.save((function(_this) {\n        return function(item) {\n          var itemtags, value;\n          value = trim(tag.toLowerCase());\n          itemtags = _.clone(item.tags);\n          itemtags.push([tag, color]);\n          item.tags = itemtags;\n          return item;\n        };\n      })(this));\n      return transform.then(onAddTagSuccess, onAddTagError);\n    };\n\n    return TagLineController;\n\n  })();\n\n  module.controller(\"TagLineCtrl\", TagLineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagLineDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagLineDirective = function() {\n    return {\n      scope: {\n        item: \"=\",\n        permissions: \"@\",\n        project: \"=\"\n      },\n      templateUrl: \"components/tags/tag-line-detail/tag-line-detail.html\",\n      controller: \"TagLineCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true\n    };\n  };\n\n  module.directive(\"tgTagLine\", TagLineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.service.coffee\n */\n\n(function() {\n  var TagLineService, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module('taigaCommon');\n\n  TagLineService = (function(superClass) {\n    extend(TagLineService, superClass);\n\n    TagLineService.$inject = [];\n\n    function TagLineService() {}\n\n    TagLineService.prototype.checkPermissions = function(myPermissions, projectPermissions) {\n      return _.includes(myPermissions, projectPermissions);\n    };\n\n    TagLineService.prototype.createColorsArray = function(projectTagColors) {\n      return _.map(projectTagColors, function(index, value) {\n        return [value, index];\n      });\n    };\n\n    return TagLineService;\n\n  })(taiga.Service);\n\n  module.service(\"tgTagLineService\", TagLineService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tag-line.directive.coffee\n */\n\n(function() {\n  var TagDirective, module;\n\n  module = angular.module('taigaCommon');\n\n  TagDirective = function() {\n    return {\n      templateUrl: \"components/tags/tag/tag.html\",\n      scope: {\n        tag: \"<\",\n        loadingRemoveTag: \"<\",\n        onDeleteTag: \"&\",\n        hasPermissions: \"@\"\n      }\n    };\n  };\n\n  module.directive(\"tgTag\", TagDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: taskboard-zoom.directive.coffee\n */\n\n(function() {\n  var TaskboardZoomDirective;\n\n  TaskboardZoomDirective = function(storage) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var getZoomView, zooms;\n      scope.zoomIndex = storage.get(\"taskboard_zoom\") || 2;\n      scope.levels = 4;\n      zooms = [[\"ref\"], [\"subject\"], [\"owner\", \"tags\", \"extra_info\", \"unfold\"], [\"attachments\", \"empty_extra_info\"], [\"related_tasks\"]];\n      getZoomView = function(zoomIndex) {\n        if (zoomIndex == null) {\n          zoomIndex = 0;\n        }\n        if (storage.get(\"taskboard_zoom\") !== zoomIndex) {\n          storage.set(\"taskboard_zoom\", zoomIndex);\n        }\n        return _.reduce(zooms, function(result, value, key) {\n          if (key <= zoomIndex) {\n            result = result.concat(value);\n          }\n          return result;\n        });\n      };\n      return scope.$watch('zoomIndex', function(zoomLevel) {\n        var zoom;\n        zoom = getZoomView(zoomLevel);\n        return scope.onZoomChange({\n          zoomLevel: zoomLevel,\n          zoom: zoom\n        });\n      });\n    };\n    return {\n      scope: {\n        onZoomChange: \"&\"\n      },\n      template: \"<tg-board-zoom\\n    levels=\\\"levels\\\"\\n    class=\\\"board-zoom\\\"\\n    value=\\\"zoomIndex\\\"\\n></tg-board-zoom>\",\n      link: link\n    };\n  };\n\n  angular.module('taigaComponents').directive(\"tgTaskboardZoom\", [\"$tgStorage\", TaskboardZoomDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-button.directive.coffee\n */\n\n(function() {\n  var TribeButtonDirective;\n\n  TribeButtonDirective = function(configService, locationService) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      scope.vm.tribeHost = configService.config.tribeHost;\n      scope.vm.url = (locationService.protocol()) + \"://\" + (locationService.host());\n      if (locationService.protocol() === \"http\" && locationService.port() !== 80) {\n        return scope.vm.url = scope.vm.url + \":\" + (locationService.port());\n      } else if (locationService.protocol() === \"https\" && locationService.port() !== 443) {\n        return scope.vm.url = scope.vm.url + \":\" + (locationService.port());\n      }\n    };\n    return {\n      scope: {\n        usId: \"=\",\n        projectSlug: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/tribe-button/tribe-button.html\",\n      link: link\n    };\n  };\n\n  TribeButtonDirective.$inject = [\"$tgConfig\", \"$tgLocation\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeButton\", TribeButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-linked.directive.coffee\n */\n\n(function() {\n  var TribeLinkedDirective;\n\n  TribeLinkedDirective = function(configService) {\n    var directive, link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      scope.vm.tribeHost = configService.config.tribeHost;\n      scope.vm.show = function() {\n        return scope.vm.open = true;\n      };\n      return scope.vm.hide = function(event) {\n        return scope.vm.open = false;\n      };\n    };\n    directive = {\n      templateUrl: \"components/tribe-button/tribe-linked.html\",\n      scope: {\n        gigTitle: \"=\",\n        gigId: \"=\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  TribeLinkedDirective.$inject = [\"$tgConfig\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeLinked\", TribeLinkedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task',\n        epics: 'modify_epic'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/comment-edit-wysiwyg.directive.coffee\n */\n\n(function() {\n  var CommentEditWysiwyg;\n\n  CommentEditWysiwyg = function(attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var types, uploadFile;\n      types = {\n        epics: \"epic\",\n        userstories: \"us\",\n        issues: \"issue\",\n        tasks: \"task\"\n      };\n      uploadFile = function(file, cb) {\n        return attachmentsFullService.addAttachment($scope.vm.projectId, $scope.vm.comment.comment.id, types[$scope.vm.comment.comment._name], file, true, true).then(function(result) {\n          return cb(result.getIn(['file', 'name']), result.getIn(['file', 'url']));\n        });\n      };\n      return $scope.uploadFiles = function(files, cb) {\n        var file, i, len, results;\n        results = [];\n        for (i = 0, len = files.length; i < len; i++) {\n          file = files[i];\n          results.push(uploadFile(file, cb));\n        }\n        return results;\n      };\n    };\n    return {\n      scope: true,\n      link: link,\n      template: \"<div>\\n    <tg-wysiwyg\\n        editonly\\n        required\\n        content='vm.comment.comment'\\n        on-save=\\\"vm.saveComment(text, cb)\\\"\\n        on-cancel=\\\"vm.onEditMode({commentId: vm.comment.id})\\\"\\n        on-upload-file='uploadFiles(files, cb)'>\\n    </tg-wysiwyg>\\n</div>\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgCommentEditWysiwyg\", [\"tgAttachmentsFullService\", CommentEditWysiwyg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/comment-wysiwyg.directive.coffee\n */\n\n(function() {\n  var CommentWysiwyg;\n\n  CommentWysiwyg = function(attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var types, uploadFile;\n      $scope.editableDescription = false;\n      $scope.saveComment = function(description, cb) {\n        $scope.content = '';\n        $scope.vm.type.comment = description;\n        return $scope.vm.onAddComment({\n          callback: cb\n        });\n      };\n      types = {\n        epics: \"epic\",\n        userstories: \"us\",\n        issues: \"issue\",\n        tasks: \"task\"\n      };\n      uploadFile = function(file, cb) {\n        return attachmentsFullService.addAttachment($scope.vm.projectId, $scope.vm.type.id, types[$scope.vm.type._name], file, true, true).then(function(result) {\n          return cb(result.getIn(['file', 'name']), result.getIn(['file', 'url']));\n        });\n      };\n      $scope.onChange = function(markdown) {\n        return $scope.vm.type.comment = markdown;\n      };\n      $scope.uploadFiles = function(files, cb) {\n        var file, i, len, results;\n        results = [];\n        for (i = 0, len = files.length; i < len; i++) {\n          file = files[i];\n          results.push(uploadFile(file, cb));\n        }\n        return results;\n      };\n      $scope.content = '';\n      return $scope.$watch(\"vm.type\", function(value) {\n        if (!value) {\n          return;\n        }\n        return $scope.storageKey = \"comment-\" + value.project + \"-\" + value.id + \"-\" + value._name;\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      template: \"<div>\\n    <tg-wysiwyg\\n        required\\n        not-persist\\n        placeholder='{{\\\"COMMENTS.TYPE_NEW_COMMENT\\\" | translate}}'\\n        storage-key='storageKey'\\n        content='content'\\n        on-save='saveComment(text, cb)'\\n        on-upload-file='uploadFiles(files, cb)'>\\n    </tg-wysiwyg>\\n</div>\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgCommentWysiwyg\", [\"tgAttachmentsFullService\", CommentWysiwyg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/comment-edit-wysiwyg.directive.coffee\n */\n\n(function() {\n  var CustomFieldEditWysiwyg;\n\n  CustomFieldEditWysiwyg = function(attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var types, uploadFile;\n      types = {\n        userstories: \"us\",\n        issues: \"issue\",\n        tasks: \"task\"\n      };\n      uploadFile = function(file, cb) {\n        return attachmentsFullService.addAttachment($scope.vm.projectId, $scope.vm.comment.comment.id, types[$scope.vm.comment.comment._name], file).then(function(result) {\n          return cb(result.getIn(['file', 'name']), result.getIn(['file', 'url']));\n        });\n      };\n      return $scope.uploadFiles = function(files, cb) {\n        var file, i, len, results;\n        results = [];\n        for (i = 0, len = files.length; i < len; i++) {\n          file = files[i];\n          results.push(uploadFile(file, cb));\n        }\n        return results;\n      };\n    };\n    return {\n      scope: true,\n      link: link,\n      template: \"<div>\\n    <tg-wysiwyg\\n        editonly\\n        content='customAttributeValue.value'\\n        on-save=\\\"saveCustomRichText(text, cb)\\\"\\n        on-cancel=\\\"cancelCustomRichText()\\\"\\n        on-upload-file='uploadFiles(files, cb)'>\\n    </tg-wysiwyg>\\n</div>\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgCustomFieldEditWysiwyg\", [\"tgAttachmentsFullService\", CustomFieldEditWysiwyg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/item-wysiwyg.directive.coffee\n */\n\n(function() {\n  var ItemWysiwyg;\n\n  ItemWysiwyg = function($modelTransform, $rootscope, $confirm, attachmentsFullService, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var uploadFile;\n      $scope.editableDescription = false;\n      $scope.saveDescription = function(description, cb) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.description = description;\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](cb);\n      };\n      uploadFile = function(file, cb) {\n        return attachmentsFullService.addAttachment($scope.project.id, $scope.item.id, $attrs.type, file).then(function(result) {\n          return cb(result.getIn(['file', 'name']), result.getIn(['file', 'url']));\n        });\n      };\n      $scope.uploadFiles = function(files, cb) {\n        var file, i, len, results;\n        results = [];\n        for (i = 0, len = files.length; i < len; i++) {\n          file = files[i];\n          results.push(uploadFile(file, cb));\n        }\n        return results;\n      };\n      $scope.$watch($attrs.model, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        $scope.version = value.version;\n        return $scope.storageKey = $scope.project.id + \"-\" + value.id + \"-\" + $attrs.type;\n      });\n      return $scope.$watch('project', function(project) {\n        if (!project) {\n          return;\n        }\n        return $scope.editableDescription = project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      template: \"<div>\\n    <tg-wysiwyg\\n        ng-if=\\\"editableDescription\\\"\\n        placeholder='{{\\\"COMMON.DESCRIPTION.EMPTY\\\" | translate}}'\\n        version='version'\\n        storage-key='storageKey'\\n        content='item.description'\\n        on-save='saveDescription(text, cb)'\\n        on-upload-file='uploadFiles(files, cb)'>\\n    </tg-wysiwyg>\\n\\n    <div\\n        class=\\\"wysiwyg\\\"\\n        ng-if=\\\"!editableDescription && item.description.length\\\"\\n        ng-bind-html=\\\"item.description | markdownToHTML\\\"></div>\\n\\n    <div\\n        class=\\\"wysiwyg\\\"\\n        ng-if=\\\"!editableDescription && !item.description.length\\\">\\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\\n    </div>\\n</div>\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgItemWysiwyg\", [\"$tgQueueModelTransformation\", \"$rootScope\", \"$tgConfirm\", \"tgAttachmentsFullService\", \"$translate\", ItemWysiwyg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/wysiwyg-code-hightlighter.service.coffee\n */\n\n(function() {\n  var WysiwygCodeHightlighterService;\n\n  WysiwygCodeHightlighterService = (function() {\n    function WysiwygCodeHightlighterService() {\n      Prism.plugins.customClass.prefix('prism-');\n      Prism.plugins.customClass.map({});\n    }\n\n    WysiwygCodeHightlighterService.prototype.getLanguages = function() {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (_this.languages) {\n            return resolve(_this.languages);\n          } else if (_this.loadPromise) {\n            return _this.loadPromise.then(function() {\n              return resolve(_this.languages);\n            });\n          } else {\n            return _this.loadPromise = $.getJSON(\"/\" + window._version + \"/prism/prism-languages.json\").then(function(_languages_) {\n              _this.loadPromise = null;\n              _this.languages = _.map(_languages_, function(it) {\n                it.url = (\"/\" + window._version + \"/prism/\") + it.file;\n                return it;\n              });\n              return resolve(_this.languages);\n            });\n          }\n        };\n      })(this));\n    };\n\n    WysiwygCodeHightlighterService.prototype.getLanguageInClassList = function(classes) {\n      var lan;\n      lan = _.find(this.languages, function(it) {\n        return !!_.find(classes, function(className) {\n          return 'language-' + it.name === className;\n        });\n      });\n      if (lan) {\n        return lan.name;\n      } else {\n        return null;\n      }\n    };\n\n    WysiwygCodeHightlighterService.prototype.loadLanguage = function(lan) {\n      return new Promise(function(resolve) {\n        if (!Prism.languages[lan]) {\n          return ljs.load(\"/\" + window._version + \"/prism/prism-\" + lan + \".min.js\", resolve);\n        } else {\n          return resolve();\n        }\n      });\n    };\n\n    WysiwygCodeHightlighterService.prototype.replaceCodeBrToNl = function(code) {\n      return $(code).find('br').replaceWith('\\n');\n    };\n\n    WysiwygCodeHightlighterService.prototype.hightlightCode = function(code) {\n      var lan;\n      this.replaceCodeBrToNl(code);\n      lan = this.getLanguageInClassList(code.classList);\n      if (lan) {\n        return this.loadLanguage(lan).then(function() {\n          return Prism.highlightElement(code);\n        });\n      }\n    };\n\n    WysiwygCodeHightlighterService.prototype.addHightlighter = function(element) {\n      var codes;\n      codes = $(element).find('code');\n      return codes.each((function(_this) {\n        return function(index, code) {\n          return _this.hightlightCode(code);\n        };\n      })(this));\n    };\n\n    return WysiwygCodeHightlighterService;\n\n  })();\n\n  angular.module(\"taigaComponents\").service(\"tgWysiwygCodeHightlighterService\", WysiwygCodeHightlighterService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/wysiwyg-code-lightbox/wysiwyg-code-lightbox.directive.coffee\n */\n\n(function() {\n  var WysiwygCodeLightbox;\n\n  WysiwygCodeLightbox = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.$watch('visible', function(visible) {\n        if (visible && !el.hasClass('open')) {\n          scope.open = true;\n          lightboxService.open(el, null, scope.onClose);\n          return scope.$applyAsync(function() {\n            var textarea;\n            textarea = el[0].querySelector('textarea');\n            if (textarea) {\n              return textarea.select();\n            }\n          });\n        } else if (!visible && el.hasClass('open')) {\n          scope.open = false;\n          return lightboxService.close(el);\n        }\n      });\n    };\n    return {\n      scope: {\n        languages: '<',\n        codeLanguage: '<',\n        code: '<',\n        visible: '<',\n        onClose: '&',\n        onSave: '&'\n      },\n      link: link,\n      templateUrl: \"components/wysiwyg/wysiwyg-code-lightbox/wysiwyg-code-lightbox.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWysiwygCodeLightbox\", [\"lightboxService\", WysiwygCodeLightbox]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/wysiwyg-mention.service.coffee\n */\n\n(function() {\n  var WysiwygMentionService;\n\n  WysiwygMentionService = (function() {\n    WysiwygMentionService.$inject = [\"tgProjectService\", \"tgWysiwygService\", \"$tgNavUrls\", \"$tgResources\"];\n\n    function WysiwygMentionService(projectService, wysiwygService, navurls, rs) {\n      this.projectService = projectService;\n      this.wysiwygService = wysiwygService;\n      this.navurls = navurls;\n      this.rs = rs;\n      this.cancelablePromise = null;\n    }\n\n    WysiwygMentionService.prototype.searchEmoji = function(name, cb) {\n      var filteredEmojis;\n      filteredEmojis = this.wysiwygService.searchEmojiByName(name);\n      filteredEmojis = filteredEmojis.slice(0, 10);\n      return cb(filteredEmojis);\n    };\n\n    WysiwygMentionService.prototype.searchUser = function(term, cb) {\n      var searchProps, users;\n      searchProps = ['username', 'full_name', 'full_name_display'];\n      users = this.projectService.project.toJS().members.filter((function(_this) {\n        return function(user) {\n          var i, len, prop;\n          for (i = 0, len = searchProps.length; i < len; i++) {\n            prop = searchProps[i];\n            if (taiga.slugify(user[prop]).indexOf(term) >= 0) {\n              return true;\n            } else if (user[prop].indexOf(term) >= 0) {\n              return true;\n            }\n          }\n          return false;\n        };\n      })(this));\n      users = users.slice(0, 10).map((function(_this) {\n        return function(it) {\n          it.url = _this.navurls.resolve('user-profile', {\n            project: _this.projectService.project.get('slug'),\n            username: it.username\n          });\n          return it;\n        };\n      })(this));\n      return cb(users);\n    };\n\n    WysiwygMentionService.prototype.searchItem = function(term) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var filter, searchProps, searchTypes, urls;\n          term = taiga.slugify(term);\n          searchTypes = ['issues', 'tasks', 'userstories'];\n          urls = {\n            issues: \"project-issues-detail\",\n            tasks: \"project-tasks-detail\",\n            userstories: \"project-userstories-detail\"\n          };\n          searchProps = ['ref', 'subject'];\n          filter = function(item) {\n            var i, len, prop;\n            for (i = 0, len = searchProps.length; i < len; i++) {\n              prop = searchProps[i];\n              if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                return true;\n              }\n            }\n            return false;\n          };\n          if (_this.cancelablePromise) {\n            _this.cancelablePromise.abort();\n          }\n          _this.cancelablePromise = _this.rs.search[\"do\"](_this.projectService.project.get('id'), term);\n          return _this.cancelablePromise.then(function(res) {\n            var i, items, len, result, type;\n            if (res.count < 1 || res.count === res.wikipages.length) {\n              return resolve([]);\n            } else {\n              result = [];\n              for (i = 0, len = searchTypes.length; i < len; i++) {\n                type = searchTypes[i];\n                if (res[type] && res[type].length > 0) {\n                  items = res[type].filter(filter);\n                  items = items.map(function(it) {\n                    it.url = _this.navurls.resolve(urls[type], {\n                      project: _this.projectService.project.get('slug'),\n                      ref: it.ref\n                    });\n                    return it;\n                  });\n                  result = result.concat(items);\n                }\n              }\n              result = _.sortBy(result, [\"ref\"]);\n              return resolve(result.slice(0, 10));\n            }\n          });\n        };\n      })(this));\n    };\n\n    WysiwygMentionService.prototype.search = function(mention) {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if ('#'.indexOf(mention[0]) !== -1) {\n            return _this.searchItem(mention.replace('#', '')).then(resolve);\n          } else if ('@'.indexOf(mention[0]) !== -1) {\n            return _this.searchUser(mention.replace('@', ''), resolve);\n          } else if (':'.indexOf(mention[0]) !== -1) {\n            return _this.searchEmoji(mention.replace(':', ''), resolve);\n          }\n        };\n      })(this));\n    };\n\n    return WysiwygMentionService;\n\n  })();\n\n  angular.module(\"taigaComponents\").service(\"tgWysiwygMentionService\", WysiwygMentionService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/wysiwyg.directive.coffee\n */\n\n(function() {\n  var Medium, bindOnce, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  Medium = function($translate, $confirm, $storage, wysiwygService, animationFrame, tgLoader, wysiwygCodeHightlighterService, wysiwygMentionService, analytics, $location, attachmentsService, $q) {\n    var AlignRightButton, CodeButton, CustomPasteHandler, addCodeBlockAndHightlight, getIcon, getRangeCodeBlock, isCodeBlockSelected, link, oldIsBlockContainer, refreshCodeBlocks, removeCodeBlockAndHightlight, removeSelections;\n    removeSelections = function() {\n      if (window.getSelection) {\n        if (window.getSelection().empty) {\n          return window.getSelection().empty();\n        }\n      } else if (window.getSelection().removeAllRanges) {\n        return window.getSelection().removeAllRanges();\n      } else if (document.selection) {\n        return document.selection.empty();\n      }\n    };\n    getRangeCodeBlock = function(range) {\n      return $(range.endContainer).parentsUntil('.editor', 'code');\n    };\n    isCodeBlockSelected = function(range) {\n      return !!getRangeCodeBlock(range).length;\n    };\n    removeCodeBlockAndHightlight = function(selection, mediumInstance) {\n      var code, p, pre;\n      if ($(selection).is('code')) {\n        code = selection;\n      } else {\n        code = $(selection).closest('code')[0];\n      }\n      pre = code.parentNode;\n      p = document.createElement('p');\n      p.innerText = code.innerText;\n      pre.parentNode.replaceChild(p, pre);\n      return mediumInstance.checkContentChanged(mediumInstance.elements[0]);\n    };\n    addCodeBlockAndHightlight = function(range, mediumInstance) {\n      var code, extract, pre, start;\n      pre = document.createElement('pre');\n      code = document.createElement('code');\n      if (!range.startContainer.parentNode.nextSibling) {\n        $('<br/>').insertAfter(range.startContainer.parentNode);\n      }\n      start = range.endContainer.parentNode.nextSibling;\n      extract = range.extractContents();\n      code.appendChild(extract);\n      pre.appendChild(code);\n      start.parentNode.insertBefore(pre, start);\n      refreshCodeBlocks(mediumInstance);\n      return mediumInstance.checkContentChanged(mediumInstance.elements[0]);\n    };\n    refreshCodeBlocks = function(mediumInstance) {\n      var i, j, len, len1, mainChildren, p, pre, preList, ref, results;\n      if (!mediumInstance) {\n        return;\n      }\n      ref = mediumInstance.elements[0].children;\n      for (i = 0, len = ref.length; i < len; i++) {\n        mainChildren = ref[i];\n        if (mainChildren && mainChildren.tagName.toLowerCase() === 'p' && !mainChildren.innerHTML.trim().length) {\n          mainChildren.parentNode.removeChild(mainChildren);\n        }\n      }\n      preList = mediumInstance.elements[0].querySelectorAll('pre');\n      results = [];\n      for (j = 0, len1 = preList.length; j < len1; j++) {\n        pre = preList[j];\n        pre.setAttribute('contenteditable', false);\n        pre.setAttribute('title', $translate.instant(\"COMMON.WYSIWYG.DB_CLICK\"));\n        pre.addEventListener('mousedown', function(e) {\n          return e.preventDefault();\n        });\n        if (pre.nextElementSibling && pre.nextElementSibling.nodeName.toLowerCase() === 'p' && !pre.nextElementSibling.children.length) {\n          results.push(pre.nextElementSibling.appendChild(document.createElement('br')));\n        } else if (!pre.nextElementSibling || ['p', 'ul', 'h1', 'h2', 'h3'].indexOf(pre.nextElementSibling.nodeName.toLowerCase()) === -1) {\n          p = document.createElement('p');\n          p.appendChild(document.createElement('br'));\n          results.push(pre.parentNode.insertBefore(p, pre.nextSibling));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    AlignRightButton = MediumEditor.extensions.button.extend({\n      name: 'rtl',\n      init: function() {\n        var option;\n        option = _.find(this.base.options.toolbar.buttons, function(it) {\n          return it.name === 'rtl';\n        });\n        this.button = this.document.createElement('button');\n        this.button.classList.add('medium-editor-action');\n        this.button.innerHTML = option.contentDefault || '<b>RTL</b>';\n        this.button.title = 'RTL';\n        return this.on(this.button, 'click', this.handleClick.bind(this));\n      },\n      getButton: function() {\n        return this.button;\n      },\n      handleClick: function(event) {\n        var range;\n        range = MediumEditor.selection.getSelectionRange(document);\n        if (range.commonAncestorContainer.parentNode.style.textAlign === 'right') {\n          return document.execCommand('justifyLeft', false);\n        } else {\n          return document.execCommand('justifyRight', false);\n        }\n      }\n    });\n    getIcon = function(icon) {\n      return \"<svg class=\\\"icon icon-\" + icon + \"\\\">\\n    <use xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xlink:href=\\\"#\" + icon + \"\\\"></use>\\n</svg>\";\n    };\n    CodeButton = MediumEditor.extensions.button.extend({\n      name: 'code',\n      init: function() {\n        var option;\n        option = _.find(this.base.options.toolbar.buttons, function(it) {\n          return it.name === 'code';\n        });\n        this.button = this.document.createElement('button');\n        this.button.classList.add('medium-editor-action');\n        this.button.innerHTML = option.contentDefault || '<b>Code</b>';\n        this.button.title = 'Code';\n        return this.on(this.button, 'click', this.handleClick.bind(this));\n      },\n      getButton: function() {\n        return this.button;\n      },\n      tagNames: ['code'],\n      handleClick: function(event) {\n        var range, toolbar;\n        range = MediumEditor.selection.getSelectionRange(self.document);\n        if (isCodeBlockSelected(range, this.base)) {\n          removeCodeBlockAndHightlight(range.endContainer, this.base);\n        } else {\n          addCodeBlockAndHightlight(range, this.base);\n          removeSelections();\n        }\n        toolbar = this.base.getExtensionByName('toolbar');\n        if (toolbar) {\n          return toolbar.hideToolbar();\n        }\n      }\n    });\n    CustomPasteHandler = MediumEditor.extensions.paste.extend({\n      doPaste: function(pastedHTML, pastedPlain, editable) {\n        var file, fn, html, i, len, ref;\n        attachmentsService.replaceing = false;\n        if (event.clipboardData.files.length > 0) {\n          ref = event.clipboardData.files;\n          fn = function(file) {\n            var promises, reader;\n            if (file.type.includes('image')) {\n              reader = new FileReader();\n              reader.onload = (function(_this) {\n                return function() {\n                  var html;\n                  html = \"<img id='replace-image-data' src='\" + reader.result.toString() + \"' /><br/>\";\n                  MediumEditor.util.insertHTMLCommand(_this.document, html);\n                  return attachmentsService.replaceing = true;\n                };\n              })(this);\n              reader.readAsDataURL(file);\n              console.log(reader.result);\n              promises = attachmentsService.upload(file, attachmentsService.objId, attachmentsService.projectId, attachmentsService.ftype, true);\n              return promises.then((function(_this) {\n                return function(data) {\n                  var img;\n                  img = _this.document.getElementById('replace-image-data');\n                  img.src = data.get('preview_url');\n                  img.id = '';\n                  attachmentsService.replaceing = false;\n                  return console.log('replace ok');\n                };\n              })(this));\n            }\n          };\n          for (i = 0, len = ref.length; i < len; i++) {\n            file = ref[i];\n            fn(file);\n          }\n        }\n        if (pastedPlain !== void 0) {\n          html = MediumEditor.util.htmlEntities(pastedPlain);\n          return MediumEditor.util.insertHTMLCommand(this.document, html);\n        }\n      }\n    });\n    oldIsBlockContainer = MediumEditor.util.isBlockContainer;\n    MediumEditor.util.isBlockContainer = function(element) {\n      var tagName;\n      if (!element) {\n        return oldIsBlockContainer(element);\n      }\n      if (element.tagName) {\n        tagName = element.tagName;\n      } else {\n        tagName = element.parentNode.tagName;\n      }\n      if (tagName.toLowerCase() === 'code') {\n        return true;\n      }\n      return oldIsBlockContainer(element);\n    };\n    link = function($scope, $el, $attrs) {\n      var cancelWithConfirmation, change, clean, codeBlockSelected, create, discardLocalStorage, editorMarkdown, editorMedium, getCurrentContent, isDraft, isEditOnly, isOutdated, localSave, mediumInstance, notPersist, replaceCodeBrToNl, saveEnd, setEditMode, setHtmlMedium, throttleChange, unwatch, updateMarkdownWithCurrentHtml, uploadEnd;\n      mediumInstance = null;\n      editorMedium = $el.find('.medium');\n      editorMarkdown = $el.find('.markdown');\n      codeBlockSelected = null;\n      isEditOnly = !!$attrs.$attr.editonly;\n      notPersist = !!$attrs.$attr.notPersist;\n      $scope.required = !!$attrs.$attr.required;\n      $scope.editMode = isEditOnly || false;\n      $scope.mode = $storage.get('editor-mode', 'html');\n      $scope.markdown = '';\n      $scope.codeEditorVisible = false;\n      $scope.codeLans = [];\n      $scope.$watch(\"content\", (function(_this) {\n        return function(n, o) {\n          $scope.markdown = $scope.content;\n          return setHtmlMedium($scope.markdown);\n        };\n      })(this));\n      wysiwygService.loadEmojis();\n      wysiwygCodeHightlighterService.getLanguages().then(function(codeLans) {\n        return $scope.codeLans = codeLans;\n      });\n      setEditMode = function(editMode) {\n        return $scope.editMode = editMode;\n      };\n      setHtmlMedium = function(markdown) {\n        var html;\n        html = wysiwygService.getHTML(markdown);\n        editorMedium.html(html);\n        if (mediumInstance) {\n          wysiwygCodeHightlighterService.addHightlighter(mediumInstance.elements[0]);\n          if ($scope.editMode) {\n            return refreshCodeBlocks(mediumInstance);\n          }\n        }\n      };\n      $scope.saveSnippet = function(lan, code) {\n        var codePre;\n        $scope.codeEditorVisible = false;\n        codeBlockSelected.innerText = code;\n        codePre = codeBlockSelected.parentNode;\n        if (lan === 'remove-formating') {\n          codeBlockSelected.className = '';\n          codePre.className = '';\n          removeCodeBlockAndHightlight(codeBlockSelected, mediumInstance);\n        } else if (_.trim(code).length) {\n          if (lan) {\n            codeBlockSelected.className = 'language-' + lan;\n            codePre.className = 'language-' + lan;\n          } else {\n            codeBlockSelected.className = '';\n            codePre.className = '';\n          }\n          wysiwygCodeHightlighterService.hightlightCode(codeBlockSelected);\n          mediumInstance.checkContentChanged(mediumInstance.elements[0]);\n        } else {\n          codeBlockSelected.parentNode.parentNode.removeChild(codeBlockSelected.parentNode);\n          mediumInstance.checkContentChanged(mediumInstance.elements[0]);\n        }\n        throttleChange();\n        return null;\n      };\n      $scope.setMode = function(mode) {\n        if (attachmentsService.replaceing) {\n          return;\n        }\n        $storage.set('editor-mode', mode);\n        if (mode === 'markdown') {\n          updateMarkdownWithCurrentHtml();\n        } else {\n          setHtmlMedium($scope.markdown);\n        }\n        $scope.mode = mode;\n        if (mediumInstance) {\n          return mediumInstance.trigger('editableBlur', {}, editorMedium[0]);\n        }\n      };\n      $scope.save = function(e) {\n        if (attachmentsService.replaceing) {\n          return;\n        }\n        if (e) {\n          e.preventDefault();\n        }\n        if ($scope.mode === 'html') {\n          updateMarkdownWithCurrentHtml();\n        }\n        setHtmlMedium($scope.markdown);\n        if ($scope.required && !$scope.markdown.length) {\n          return;\n        }\n        $scope.saving = true;\n        $scope.outdated = false;\n        $scope.onSave({\n          text: $scope.markdown,\n          cb: saveEnd\n        });\n      };\n      $scope.cancel = function(e) {\n        if (e) {\n          e.preventDefault();\n        }\n        if (!isEditOnly) {\n          setEditMode(false);\n        }\n        if (notPersist) {\n          clean();\n        } else if ($scope.mode === 'html') {\n          setHtmlMedium($scope.content || null);\n        }\n        $scope.markdown = $scope.content;\n        discardLocalStorage();\n        mediumInstance.trigger('blur', {}, editorMedium[0]);\n        $scope.outdated = false;\n        refreshCodeBlocks(mediumInstance);\n        $scope.onCancel();\n      };\n      clean = function() {\n        $scope.markdown = '';\n        return editorMedium.html('');\n      };\n      saveEnd = function() {\n        $scope.saving = false;\n        if (!isEditOnly) {\n          setEditMode(false);\n        }\n        if (notPersist) {\n          clean();\n        }\n        discardLocalStorage();\n        mediumInstance.trigger('blur', {}, editorMedium[0]);\n        return analytics.trackEvent('develop', 'save wysiwyg', $scope.mode, 1);\n      };\n      uploadEnd = function(name, url) {\n        if (taiga.isImage(name)) {\n          return mediumInstance.pasteHTML(\"<img src='\" + url + \"' /><br/>\");\n        } else {\n          name = $('<div/>').text(name).html();\n          return mediumInstance.pasteHTML(\"<a target='_blank' href='\" + url + \"'>\" + name + \"</a><br/>\");\n        }\n      };\n      isOutdated = function() {\n        var store;\n        store = $storage.get($scope.storageKey);\n        if (store && store.version && store.version !== $scope.version) {\n          return true;\n        }\n        return false;\n      };\n      isDraft = function() {\n        var store;\n        store = $storage.get($scope.storageKey);\n        if (store) {\n          return true;\n        }\n        return false;\n      };\n      getCurrentContent = function() {\n        var store;\n        store = $storage.get($scope.storageKey);\n        if (store) {\n          return store.text;\n        }\n        return $scope.content;\n      };\n      discardLocalStorage = function() {\n        return $storage.remove($scope.storageKey);\n      };\n      cancelWithConfirmation = function() {\n        var message, title;\n        if ($scope.content === $scope.markdown) {\n          $scope.cancel();\n          document.activeElement.blur();\n          document.body.click();\n          return null;\n        }\n        title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n        message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n        return $confirm.ask(title, null, message).then(function(askResponse) {\n          $scope.cancel();\n          return askResponse.finish();\n        });\n      };\n      replaceCodeBrToNl = function() {\n        var html;\n        html = $('<div></div>').html(editorMedium.html());\n        html.find('code br').replaceWith('\\n');\n        return html.html();\n      };\n      updateMarkdownWithCurrentHtml = function() {\n        var html;\n        html = replaceCodeBrToNl();\n        return $scope.markdown = wysiwygService.getMarkdown(html);\n      };\n      localSave = function(markdown) {\n        var store;\n        if ($scope.storageKey) {\n          store = {};\n          store.version = $scope.version || 0;\n          store.text = markdown;\n          return $storage.set($scope.storageKey, store);\n        }\n      };\n      change = function() {\n        if ($scope.mode === 'html') {\n          updateMarkdownWithCurrentHtml();\n        }\n        localSave($scope.markdown);\n        return $scope.onChange({\n          markdown: $scope.markdown\n        });\n      };\n      throttleChange = _.throttle(change, 200);\n      create = function(text, editMode) {\n        var html;\n        if (editMode == null) {\n          editMode = false;\n        }\n        if (text.length) {\n          html = wysiwygService.getHTML(text);\n          editorMedium.html(html);\n        }\n        mediumInstance = new MediumEditor(editorMedium[0], {\n          imageDragging: false,\n          placeholder: {\n            text: $scope.placeholder\n          },\n          toolbar: {\n            buttons: [\n              {\n                name: 'bold',\n                contentDefault: getIcon('editor-bold')\n              }, {\n                name: 'italic',\n                contentDefault: getIcon('editor-italic')\n              }, {\n                name: 'strikethrough',\n                contentDefault: getIcon('editor-cross-out')\n              }, {\n                name: 'anchor',\n                contentDefault: getIcon('editor-link')\n              }, {\n                name: 'image',\n                contentDefault: getIcon('editor-image')\n              }, {\n                name: 'orderedlist',\n                contentDefault: getIcon('editor-list-n')\n              }, {\n                name: 'unorderedlist',\n                contentDefault: getIcon('editor-list-o')\n              }, {\n                name: 'h1',\n                contentDefault: getIcon('editor-h1')\n              }, {\n                name: 'h2',\n                contentDefault: getIcon('editor-h2')\n              }, {\n                name: 'h3',\n                contentDefault: getIcon('editor-h3')\n              }, {\n                name: 'quote',\n                contentDefault: getIcon('editor-quote')\n              }, {\n                name: 'removeFormat',\n                contentDefault: getIcon('editor-no-format')\n              }, {\n                name: 'rtl',\n                contentDefault: getIcon('editor-rtl')\n              }, {\n                name: 'code',\n                contentDefault: getIcon('editor-code')\n              }\n            ]\n          },\n          extensions: {\n            paste: new CustomPasteHandler(this),\n            code: new CodeButton(),\n            autolist: new AutoList(),\n            alignright: new AlignRightButton(),\n            mediumMention: new MentionExtension({\n              getItems: function(mention, mentionCb) {\n                return wysiwygMentionService.search(mention).then(mentionCb);\n              }\n            })\n          }\n        });\n        $scope.changeMarkdown = throttleChange;\n        mediumInstance.subscribe('editableInput', function(e) {\n          return $scope.$applyAsync(throttleChange);\n        });\n        mediumInstance.subscribe(\"editableClick\", function(e) {\n          var r;\n          r = new RegExp('^(?:[a-z]+:)?//', 'i');\n          if (e.target.href) {\n            if (r.test(e.target.getAttribute('href')) || e.target.getAttribute('target') === '_blank') {\n              e.stopPropagation();\n              return window.open(e.target.href);\n            } else {\n              return $location.url(e.target.href);\n            }\n          }\n        });\n        mediumInstance.subscribe('editableDrop', function(event) {\n          return $scope.onUploadFile({\n            files: event.dataTransfer.files,\n            cb: uploadEnd\n          });\n        });\n        mediumInstance.subscribe('editableKeydown', function(e) {\n          var code, mention;\n          code = e.keyCode ? e.keyCode : e.which;\n          mention = $('.medium-mention');\n          if ((code === 40 || code === 38) && mention.length) {\n            e.stopPropagation();\n            e.preventDefault();\n            return;\n          }\n          if ($scope.editMode && code === 27) {\n            e.stopPropagation();\n            return $scope.$applyAsync(cancelWithConfirmation);\n          } else if (code === 27) {\n            return editorMedium.blur();\n          }\n        });\n        setEditMode(editMode);\n        return $scope.$applyAsync(function() {\n          wysiwygCodeHightlighterService.addHightlighter(mediumInstance.elements[0]);\n          return refreshCodeBlocks(mediumInstance);\n        });\n      };\n      $(editorMedium[0]).on('mousedown', function(e) {\n        if (e.target.href) {\n          e.preventDefault();\n          return e.stopPropagation();\n        } else {\n          return $scope.$applyAsync(function() {\n            if (!$scope.editMode) {\n              setEditMode(true);\n              return refreshCodeBlocks(mediumInstance);\n            }\n          });\n        }\n      });\n      $(editorMedium[0]).on('dblclick', 'pre', function(e) {\n        return $scope.$applyAsync(function() {\n          $scope.codeEditorVisible = true;\n          codeBlockSelected = e.currentTarget.querySelector('code');\n          $scope.currentCodeLanguage = wysiwygCodeHightlighterService.getLanguageInClassList(codeBlockSelected.classList);\n          return $scope.code = codeBlockSelected.innerText;\n        });\n      });\n      unwatch = $scope.$watch('content', function(content) {\n        var unwatchLoader;\n        if (!_.isUndefined(content)) {\n          $scope.outdated = isOutdated();\n          if (!mediumInstance && isDraft()) {\n            setEditMode(true);\n          }\n          if ($scope.markdown && ($scope.markdown.length || content.length) && $scope.markdown === content) {\n            return;\n          }\n          content = getCurrentContent();\n          $scope.markdown = content;\n          if (mediumInstance) {\n            mediumInstance.destroy();\n          }\n          if (tgLoader.open()) {\n            unwatchLoader = tgLoader.onEnd(function() {\n              create(content, $scope.editMode);\n              return unwatchLoader();\n            });\n          } else {\n            create(content, $scope.editMode);\n          }\n          return unwatch();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        if (mediumInstance) {\n          if (editorMedium.length) {\n            $(editorMedium[0]).off();\n          }\n          return mediumInstance.destroy();\n        }\n      });\n    };\n    return {\n      templateUrl: \"common/components/wysiwyg-toolbar.html\",\n      scope: {\n        placeholder: '@',\n        version: '<',\n        storageKey: '<',\n        content: '<',\n        onCancel: '&',\n        onSave: '&',\n        onUploadFile: '&',\n        onChange: '&'\n      },\n      link: link\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWysiwyg\", [\"$translate\", \"$tgConfirm\", \"$tgStorage\", \"tgWysiwygService\", \"animationFrame\", \"tgLoader\", \"tgWysiwygCodeHightlighterService\", \"tgWysiwygMentionService\", \"$tgAnalytics\", \"$location\", \"tgAttachmentsService\", \"$q\", Medium]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/wysiwyg/wysiwyg.service.coffee\n */\n\n(function() {\n  var WysiwygService;\n\n  WysiwygService = (function() {\n    WysiwygService.$inject = [\"tgWysiwygCodeHightlighterService\", \"tgProjectService\", \"$tgNavUrls\"];\n\n    function WysiwygService(wysiwygCodeHightlighterService, projectService, navurls) {\n      this.wysiwygCodeHightlighterService = wysiwygCodeHightlighterService;\n      this.projectService = projectService;\n      this.navurls = navurls;\n    }\n\n    WysiwygService.prototype.searchEmojiByName = function(name) {\n      return _.filter(this.emojis, function(it) {\n        return it.name.indexOf(name) !== -1;\n      });\n    };\n\n    WysiwygService.prototype.setEmojiImagePath = function(emojis) {\n      return this.emojis = _.map(emojis, function(it) {\n        it.image = (\"/\" + window._version + \"/emojis/\") + it.image;\n        return it;\n      });\n    };\n\n    WysiwygService.prototype.loadEmojis = function() {\n      return $.getJSON(\"/\" + window._version + \"/emojis/emojis-data.json\").then(this.setEmojiImagePath.bind(this));\n    };\n\n    WysiwygService.prototype.getEmojiById = function(id) {\n      return _.find(this.emojis, function(it) {\n        return it.id === id;\n      });\n    };\n\n    WysiwygService.prototype.getEmojiByName = function(name) {\n      return _.find(this.emojis, function(it) {\n        return it.name === name;\n      });\n    };\n\n    WysiwygService.prototype.replaceImgsByEmojiName = function(html) {\n      var emoji, emojiId, emojiIds, i, len, regexImgs;\n      emojiIds = taiga.getMatches(html, /emojis\\/([^\"]+).png\"/gi);\n      for (i = 0, len = emojiIds.length; i < len; i++) {\n        emojiId = emojiIds[i];\n        regexImgs = new RegExp('<img(.*)' + emojiId + '[^>]+\\>', 'g');\n        emoji = this.getEmojiById(emojiId);\n        html = html.replace(regexImgs, ':' + emoji.name + ':');\n      }\n      return html;\n    };\n\n    WysiwygService.prototype.replaceEmojiNameByImgs = function(text) {\n      var emoji, emojiId, emojiIds, i, len, regexImgs;\n      emojiIds = taiga.getMatches(text, /:([\\w ]*):/g);\n      for (i = 0, len = emojiIds.length; i < len; i++) {\n        emojiId = emojiIds[i];\n        regexImgs = new RegExp(':' + emojiId + ':', 'g');\n        emoji = this.getEmojiByName(emojiId);\n        if (emoji) {\n          text = text.replace(regexImgs, '![alt](' + emoji.image + ')');\n        }\n      }\n      return text;\n    };\n\n    WysiwygService.prototype.pipeLinks = function(text) {\n      return text.replace(/\\[\\[(.*?)\\]\\]/g, function(match, p1, offset, str) {\n        var link, linkParams, title;\n        linkParams = p1.split('|');\n        link = linkParams[0];\n        title = linkParams[1] || linkParams[0];\n        return '[' + title + '](' + link + ')';\n      });\n    };\n\n    WysiwygService.prototype.replaceUrls = function(html) {\n      var el, i, len, link, links;\n      el = document.createElement('html');\n      el.innerHTML = html;\n      links = el.querySelectorAll('a');\n      for (i = 0, len = links.length; i < len; i++) {\n        link = links[i];\n        if (link.getAttribute('href').indexOf('/profile/') !== -1) {\n          link.parentNode.replaceChild(document.createTextNode(link.innerText), link);\n        } else if (link.getAttribute('href').indexOf('/t/') !== -1) {\n          link.parentNode.replaceChild(document.createTextNode(link.innerText), link);\n        }\n      }\n      return el.innerHTML;\n    };\n\n    WysiwygService.prototype.searchWikiLinks = function(html) {\n      var el, i, len, link, links, url;\n      el = document.createElement('html');\n      el.innerHTML = html;\n      links = el.querySelectorAll('a');\n      for (i = 0, len = links.length; i < len; i++) {\n        link = links[i];\n        if (link.getAttribute('href').indexOf('/') === -1) {\n          url = this.navurls.resolve('project-wiki-page', {\n            project: this.projectService.project.get('slug'),\n            slug: link.getAttribute('href')\n          });\n          link.setAttribute('href', url);\n        }\n      }\n      return el.innerHTML;\n    };\n\n    WysiwygService.prototype.removeTrailingListBr = function(text) {\n      return text.replace(/<li>(.*?)<br><\\/li>/g, '<li>$1</li>');\n    };\n\n    WysiwygService.prototype.getMarkdown = function(html) {\n      var cleanIssueConverter, codeLanguageConverter, markdown;\n      cleanIssueConverter = {\n        filter: ['html', 'body', 'span', 'div'],\n        replacement: function(innerHTML) {\n          return innerHTML;\n        }\n      };\n      codeLanguageConverter = {\n        filter: (function(_this) {\n          return function(node) {\n            return node.nodeName === 'PRE' && node.firstChild && node.firstChild.nodeName === 'CODE';\n          };\n        })(this),\n        replacement: (function(_this) {\n          return function(content, node) {\n            var lan;\n            lan = _this.wysiwygCodeHightlighterService.getLanguageInClassList(node.firstChild.classList);\n            if (!lan) {\n              lan = '';\n            }\n            return '\\n\\n```' + lan + '\\n' + _.trim(node.firstChild.textContent) + '\\n```\\n\\n';\n          };\n        })(this)\n      };\n      html = html.replace(/&nbsp;(<\\/.*>)/g, \"$1\");\n      html = this.replaceImgsByEmojiName(html);\n      html = this.replaceUrls(html);\n      html = this.removeTrailingListBr(html);\n      markdown = toMarkdown(html, {\n        gfm: true,\n        converters: [cleanIssueConverter, codeLanguageConverter]\n      });\n      return markdown;\n    };\n\n    WysiwygService.prototype.parseMentionMatches = function(text) {\n      var m, matches, offset, prevChar, regex, serviceName, tagBuilder;\n      serviceName = 'twitter';\n      tagBuilder = this.tagBuilder;\n      matches = [];\n      regex = /@[^\\s]{1,50}[^.\\s]/g;\n      m = regex.exec(text);\n      while (m !== null) {\n        offset = m.index;\n        prevChar = text.charAt(offset - 1);\n        if (m.index === regex.lastIndex) {\n          regex.lastIndex++;\n        }\n        m.forEach(function(match, groupIndex) {\n          return matches.push(new Autolinker.match.Mention({\n            tagBuilder: tagBuilder,\n            matchedText: match,\n            offset: offset,\n            serviceName: serviceName,\n            mention: match.slice(1)\n          }));\n        });\n        m = regex.exec(text);\n      }\n      return matches;\n    };\n\n    WysiwygService.prototype.autoLinkHTML = function(html) {\n      var autolinker, matchRegexStr;\n      matchRegexStr = String(Autolinker.matcher.Mention.prototype.matcherRegexes.twitter);\n      if (matchRegexStr.indexOf('.') === -1) {\n        matchRegexStr = '@[^\\s]{1,50}[^.\\s]';\n      }\n      autolinker = new Autolinker({\n        mention: 'twitter',\n        hashtag: 'twitter',\n        replaceFn: (function(_this) {\n          return function(match) {\n            var profileUrl, url;\n            if (match.getType() === 'mention') {\n              profileUrl = _this.navurls.resolve('user-profile', {\n                project: _this.projectService.project.get('slug'),\n                username: match.getMention()\n              });\n              return '<a class=\"autolink\" href=\"' + profileUrl + '\">@' + match.getMention() + '</a>';\n            } else if (match.getType() === 'hashtag') {\n              url = _this.navurls.resolve('project-detail-ref', {\n                project: _this.projectService.project.get('slug'),\n                ref: match.getHashtag()\n              });\n              return '<a class=\"autolink\" href=\"' + url + '\">#' + match.getHashtag() + '</a>';\n            }\n          };\n        })(this)\n      });\n      Autolinker.matcher.Mention.prototype.parseMatches = this.parseMentionMatches.bind(autolinker);\n      return autolinker.link(html);\n    };\n\n    WysiwygService.prototype.getHTML = function(text) {\n      var md, options, result;\n      if (!text || !text.length) {\n        return \"\";\n      }\n      options = {\n        breaks: true\n      };\n      text = this.replaceEmojiNameByImgs(text);\n      text = this.pipeLinks(text);\n      md = window.markdownit({\n        breaks: true\n      });\n      md.use(window.markdownitLazyHeaders);\n      result = md.render(text);\n      result = this.searchWikiLinks(result);\n      result = this.autoLinkHTML(result);\n      return result;\n    };\n\n    return WysiwygService;\n\n  })();\n\n  angular.module(\"taigaComponents\").service(\"tgWysiwygService\", WysiwygService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      compile: function(element, attrs) {\n        if (!attrs.q) {\n          return attrs.q = '';\n        }\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', '$tgLocation', '$tgAnalytics', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, location, analytics, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.location = location;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n      this.analytics.trackPage(this.location.url(), \"Discover Search\");\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      this.analytics.trackPage(this.location.url(), \"Discover Search\");\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      this.analytics.trackPage(this.location.url(), \"Discover Search\");\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-epic.controller.coffee\n */\n\n(function() {\n  var CreateEpicController, getRandomDefaultColor, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = taiga.trim;\n\n  getRandomDefaultColor = taiga.getRandomDefaultColor;\n\n  CreateEpicController = (function() {\n    CreateEpicController.$inject = [\"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\", \"$tgAnalytics\"];\n\n    function CreateEpicController(confirm, projectService, epicsService, analytics) {\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.analytics = analytics;\n      this.project = this.projectService.project.toJS();\n      this.newEpic = {\n        color: getRandomDefaultColor(),\n        status: this.project.default_epic_status,\n        tags: []\n      };\n      this.attachments = Immutable.List();\n      this.loading = false;\n    }\n\n    CreateEpicController.prototype.createEpic = function() {\n      if (!this.validateForm()) {\n        return;\n      }\n      this.loading = true;\n      return this.epicsService.createEpic(this.newEpic, this.attachments).then((function(_this) {\n        return function(response) {\n          _this.analytics.trackEvent(\"epic\", \"create\", \"create epic\", 1);\n          _this.onCreateEpic();\n          return _this.loading = false;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(response) {\n          _this.loading = false;\n          _this.setFormErrors(response.data);\n          if (response.data._error_message) {\n            return _this.confirm.notify(\"error\", response.data._error_message);\n          }\n        };\n      })(this));\n    };\n\n    CreateEpicController.prototype.selectColor = function(color) {\n      return this.newEpic.color = color;\n    };\n\n    CreateEpicController.prototype.addTag = function(name, color) {\n      name = trim(name.toLowerCase());\n      if (!_.find(this.newEpic.tags, function(it) {\n        return it[0] === name;\n      })) {\n        return this.newEpic.tags.push([name, color]);\n      }\n    };\n\n    CreateEpicController.prototype.deleteTag = function(tag) {\n      return _.remove(this.newEpic.tags, function(it) {\n        return it[0] === tag[0];\n      });\n    };\n\n    CreateEpicController.prototype.addAttachment = function(attachment) {\n      return this.attachments.push(attachment);\n    };\n\n    return CreateEpicController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"CreateEpicCtrl\", CreateEpicController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-epic.directive.coffee\n */\n\n(function() {\n  var CreateEpicDirective;\n\n  CreateEpicDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var form;\n      form = el.find(\"form\").checksley();\n      ctrl.validateForm = (function(_this) {\n        return function() {\n          return form.validate();\n        };\n      })(this);\n      return ctrl.setFormErrors = (function(_this) {\n        return function(errors) {\n          return form.setErrors(errors);\n        };\n      })(this);\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/create-epic/create-epic.html\",\n      controller: \"CreateEpicCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        onCreateEpic: '&'\n      },\n      scope: {}\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgCreateEpic\", CreateEpicDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var EpicRowController;\n\n  EpicRowController = (function() {\n    EpicRowController.$inject = [\"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\"];\n\n    function EpicRowController(confirm, projectService, epicsService) {\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.displayUserStories = false;\n      this.displayAssignedTo = false;\n      this.displayStatusList = false;\n      this.loadingStatus = false;\n      this.project = this.projectService.project.toJS();\n      this._calculateProgressBar();\n    }\n\n    EpicRowController.prototype._calculateProgressBar = function() {\n      var progress, total;\n      if (this.epic.getIn(['status_extra_info', 'is_closed']) === true) {\n        return this.percentage = \"100%\";\n      } else {\n        progress = this.epic.getIn(['user_stories_counts', 'progress']);\n        total = this.epic.getIn(['user_stories_counts', 'total']);\n        if (total === 0) {\n          return this.percentage = \"0%\";\n        } else {\n          return this.percentage = (progress * 100 / total) + \"%\";\n        }\n      }\n    };\n\n    EpicRowController.prototype.canEditEpics = function() {\n      return this.projectService.hasPermission(\"modify_epic\");\n    };\n\n    EpicRowController.prototype.toggleUserStoryList = function() {\n      if (!this.displayUserStories) {\n        return this.epicsService.listRelatedUserStories(this.epic).then((function(_this) {\n          return function(userStories) {\n            _this.epicStories = userStories;\n            return _this.displayUserStories = true;\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function() {\n            return _this.confirm.notify('error');\n          };\n        })(this));\n      } else {\n        return this.displayUserStories = false;\n      }\n    };\n\n    EpicRowController.prototype.updateStatus = function(statusId) {\n      this.displayStatusList = false;\n      this.loadingStatus = true;\n      return this.epicsService.updateEpicStatus(this.epic, statusId)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loadingStatus = false;\n        };\n      })(this));\n    };\n\n    EpicRowController.prototype.updateAssignedTo = function(member) {\n      this.assignLoader = true;\n      return this.epicsService.updateEpicAssignedTo(this.epic, (member != null ? member.id : void 0) || null)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify('error');\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.assignLoader = false;\n        };\n      })(this));\n    };\n\n    return EpicRowController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicRowCtrl\", EpicRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var EpicRowDirective;\n\n  EpicRowDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/epic-row/epic-row.html\",\n      controller: \"EpicRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        epic: '=',\n        column: '='\n      }\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgEpicRow\", EpicRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics.dashboard.controller.coffee\n */\n\n(function() {\n  var EpicsDashboardController, taiga;\n\n  taiga = this.taiga;\n\n  EpicsDashboardController = (function() {\n    EpicsDashboardController.$inject = [\"$routeParams\", \"tgErrorHandlingService\", \"tgLightboxFactory\", \"lightboxService\", \"$tgConfirm\", \"tgProjectService\", \"tgEpicsService\", \"tgAppMetaService\", \"$translate\"];\n\n    function EpicsDashboardController(params, errorHandlingService, lightboxFactory, lightboxService, confirm, projectService, epicsService, appMetaService, translate) {\n      this.params = params;\n      this.errorHandlingService = errorHandlingService;\n      this.lightboxFactory = lightboxFactory;\n      this.lightboxService = lightboxService;\n      this.confirm = confirm;\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.sectionName = \"EPICS.SECTION_NAME\";\n      taiga.defineImmutableProperty(this, 'project', (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this.epicsService.epics;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    EpicsDashboardController.prototype._setMeta = function() {\n      var ctx;\n      if (!this.project) {\n        return null;\n      }\n      ctx = {\n        projectName: this.project.get(\"name\"),\n        projectDescription: this.project.get(\"description\")\n      };\n      return {\n        title: this.translate.instant(\"EPICS.PAGE_TITLE\", ctx),\n        description: this.translate.instant(\"EPICS.PAGE_DESCRIPTION\", ctx)\n      };\n    };\n\n    EpicsDashboardController.prototype.loadInitialData = function() {\n      this.epicsService.clear();\n      return this.projectService.setProjectBySlug(this.params.pslug).then((function(_this) {\n        return function() {\n          if (!_this.projectService.isEpicsDashboardEnabled()) {\n            return _this.errorHandlingService.notFound();\n          }\n          if (!_this.projectService.hasPermission(\"view_epics\")) {\n            return _this.errorHandlingService.permissionDenied();\n          }\n          return _this.epicsService.fetchEpics();\n        };\n      })(this));\n    };\n\n    EpicsDashboardController.prototype.canCreateEpics = function() {\n      return this.projectService.hasPermission(\"add_epic\");\n    };\n\n    EpicsDashboardController.prototype.onCreateEpic = function() {\n      var onCreateEpic;\n      onCreateEpic = (function(_this) {\n        return function() {\n          _this.lightboxService.closeAll();\n          _this.confirm.notify(\"success\");\n        };\n      })(this);\n      return this.lightboxFactory.create('tg-create-epic', {\n        \"class\": \"lightbox lightbox-create-epic open\",\n        \"on-create-epic\": \"onCreateEpic()\"\n      }, {\n        \"onCreateEpic\": onCreateEpic.bind(this)\n      });\n    };\n\n    return EpicsDashboardController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicsDashboardCtrl\", EpicsDashboardController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-sortable.directive.coffee\n */\n\n(function() {\n  var EpicsSortableDirective;\n\n  EpicsSortableDirective = function($parse, projectService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      if (!projectService.hasPermission(\"modify_epic\")) {\n        return;\n      }\n      callback = $parse(attrs.tgEpicsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div.epics-table-body-row');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var epic, itemEl, newIndex;\n        itemEl = $(item);\n        epic = itemEl.scope().epic;\n        newIndex = itemEl.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            epic: epic,\n            newIndex: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  EpicsSortableDirective.$inject = [\"$parse\", \"tgProjectService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgEpicsSortable\", EpicsSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var EpicsTableController, generateHash, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = this.taiga.generateHash;\n\n  EpicsTableController = (function() {\n    EpicsTableController.$inject = [\"$tgConfirm\", \"tgEpicsService\", \"$timeout\", \"$tgStorage\", \"tgProjectService\"];\n\n    function EpicsTableController(confirm, epicsService, timeout, storage, projectService) {\n      this.confirm = confirm;\n      this.epicsService = epicsService;\n      this.timeout = timeout;\n      this.storage = storage;\n      this.projectService = projectService;\n      this.hash = generateHash([this.projectService.project.get('id'), 'epics']);\n      this.displayOptions = false;\n      this.displayVotes = true;\n      this.column = this.storage.get(this.hash, {\n        votes: true,\n        name: true,\n        project: true,\n        sprint: true,\n        assigned: true,\n        status: true,\n        progress: true\n      });\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this.epicsService.epics;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'disabledEpicsPagination', (function(_this) {\n        return function() {\n          return _this.epicsService._disablePagination;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'loadingEpics', (function(_this) {\n        return function() {\n          return _this.epicsService._loadingEpics;\n        };\n      })(this));\n    }\n\n    EpicsTableController.prototype.toggleEpicTableOptions = function() {\n      return this.displayOptions = !this.displayOptions;\n    };\n\n    EpicsTableController.prototype.reorderEpic = function(epic, newIndex) {\n      if (epic.get('epics_order') === newIndex) {\n        return null;\n      }\n      return this.epicsService.reorderEpic(epic, newIndex).then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    EpicsTableController.prototype.nextPage = function() {\n      return this.epicsService.nextPage();\n    };\n\n    EpicsTableController.prototype.hoverEpicTableOption = function() {\n      if (this.timer) {\n        return this.timeout.cancel(this.timer);\n      }\n    };\n\n    EpicsTableController.prototype.hideEpicTableOption = function() {\n      return this.timer = this.timeout(((function(_this) {\n        return function() {\n          return _this.displayOptions = false;\n        };\n      })(this)), 400);\n    };\n\n    EpicsTableController.prototype.updateViewOptions = function() {\n      return this.storage.set(this.hash, this.column);\n    };\n\n    return EpicsTableController;\n\n  })();\n\n  angular.module(\"taigaEpics\").controller(\"EpicsTableCtrl\", EpicsTableController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var EpicsTableDirective;\n\n  EpicsTableDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/epics-table/epics-table.html\",\n      controller: \"EpicsTableCtrl\",\n      controllerAs: \"vm\",\n      scope: {}\n    };\n  };\n\n  angular.module('taigaEpics').directive(\"tgEpicsTable\", EpicsTableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.controller.coffee\n */\n\n(function() {\n  var StoryRowController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  StoryRowController = (function() {\n    StoryRowController.$inject = [];\n\n    function StoryRowController() {\n      this._calculateProgressBar();\n    }\n\n    StoryRowController.prototype._calculateProgressBar = function() {\n      var totalTasks, totalTasksCompleted;\n      if (this.story.get('is_closed') === true) {\n        return this.percentage = \"100%\";\n      } else {\n        totalTasks = this.story.get('tasks').size;\n        totalTasksCompleted = this.story.get('tasks').filter(function(it) {\n          return it.get(\"is_closed\");\n        }).size;\n        if (totalTasks === 0) {\n          return this.percentage = \"0%\";\n        } else {\n          return this.percentage = (totalTasksCompleted * 100 / totalTasks) + \"%\";\n        }\n      }\n    };\n\n    return StoryRowController;\n\n  })();\n\n  module.controller(\"StoryRowCtrl\", StoryRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-table.directive.coffee\n */\n\n(function() {\n  var StoryRowDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  StoryRowDirective = function() {\n    return {\n      templateUrl: \"epics/dashboard/story-row/story-row.html\",\n      controller: \"StoryRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        story: '=',\n        column: '='\n      }\n    };\n  };\n\n  module.directive(\"tgStoryRow\", StoryRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics.service.coffee\n */\n\n(function() {\n  var EpicsService, taiga;\n\n  taiga = this.taiga;\n\n  EpicsService = (function() {\n    EpicsService.$inject = ['tgProjectService', 'tgAttachmentsService', 'tgResources', 'tgXhrErrorService'];\n\n    function EpicsService(projectService, attachmentsService, resources, xhrError) {\n      this.projectService = projectService;\n      this.attachmentsService = attachmentsService;\n      this.resources = resources;\n      this.xhrError = xhrError;\n      this.clear();\n      taiga.defineImmutableProperty(this, 'epics', (function(_this) {\n        return function() {\n          return _this._epics;\n        };\n      })(this));\n    }\n\n    EpicsService.prototype.clear = function() {\n      this._loadingEpics = false;\n      this._disablePagination = false;\n      this._page = 1;\n      return this._epics = Immutable.List();\n    };\n\n    EpicsService.prototype.fetchEpics = function(reset) {\n      if (reset == null) {\n        reset = false;\n      }\n      this._loadingEpics = true;\n      this._disablePagination = true;\n      return this.resources.epics.list(this.projectService.project.get('id'), this._page).then((function(_this) {\n        return function(result) {\n          if (reset) {\n            _this.clear();\n            _this._epics = result.list;\n          } else {\n            _this._epics = _this._epics.concat(result.list);\n          }\n          _this._loadingEpics = false;\n          return _this._disablePagination = !result.headers('x-pagination-next');\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.nextPage = function() {\n      this._page++;\n      return this.fetchEpics();\n    };\n\n    EpicsService.prototype.listRelatedUserStories = function(epic) {\n      return this.resources.userstories.listInEpic(epic.get('id'));\n    };\n\n    EpicsService.prototype.createEpic = function(epicData, attachments) {\n      epicData.project = this.projectService.project.get('id');\n      return this.resources.epics.post(epicData).then((function(_this) {\n        return function(epic) {\n          var promises;\n          promises = _.map(attachments.toJS(), function(attachment) {\n            return _this.attachmentsService.upload(attachment.file, epic.get('id'), epic.get('project'), 'epic');\n          });\n          return Promise.all(promises).then(_this.fetchEpics.bind(_this, true));\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.reorderEpic = function(epic, newIndex) {\n      var afterDestination, beforeDestination, data, newOrder, orderList, previous, previousWithTheSameOrder, setOrders, withoutMoved;\n      orderList = {};\n      this._epics.forEach(function(it) {\n        return orderList[it.get('id')] = it.get('epics_order');\n      });\n      withoutMoved = this.epics.filter((function(_this) {\n        return function(it) {\n          return it.get('id') !== epic.get('id');\n        };\n      })(this));\n      beforeDestination = withoutMoved.slice(0, newIndex);\n      afterDestination = withoutMoved.slice(newIndex);\n      previous = beforeDestination.last();\n      newOrder = !previous ? 0 : previous.get('epics_order') + 1;\n      orderList[epic.get('id')] = newOrder;\n      previousWithTheSameOrder = beforeDestination.filter((function(_this) {\n        return function(it) {\n          return it.get('epics_order') === previous.get('epics_order');\n        };\n      })(this));\n      setOrders = _.fromPairs(previousWithTheSameOrder.map((function(_this) {\n        return function(it) {\n          return [it.get('id'), it.get('epics_order')];\n        };\n      })(this)).toJS());\n      afterDestination.forEach(function(it) {\n        return orderList[it.get('id')] = it.get('epics_order') + 1;\n      });\n      this._epics = this._epics.map(function(it) {\n        return it.set('epics_order', orderList[it.get('id')]);\n      });\n      this._epics = this._epics.sortBy(function(it) {\n        return it.get('epics_order');\n      });\n      data = {\n        epics_order: newOrder,\n        version: epic.get('version')\n      };\n      return this.resources.epics.reorder(epic.get('id'), data, setOrders).then((function(_this) {\n        return function(newEpic) {\n          return _this._epics = _this._epics.map(function(it) {\n            if (it.get('id') === newEpic.get('id')) {\n              return newEpic;\n            }\n            return it;\n          });\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.reorderRelatedUserstory = function(epic, epicUserstories, userstory, newIndex) {\n      var beforeDestination, data, epicId, newOrder, previous, previousWithTheSameOrder, setOrders, userstoryId, withoutMoved;\n      withoutMoved = epicUserstories.filter((function(_this) {\n        return function(it) {\n          return it.get('id') !== userstory.get('id');\n        };\n      })(this));\n      beforeDestination = withoutMoved.slice(0, newIndex);\n      previous = beforeDestination.last();\n      newOrder = !previous ? 0 : previous.get('epic_order') + 1;\n      previousWithTheSameOrder = beforeDestination.filter((function(_this) {\n        return function(it) {\n          return it.get('epic_order') === previous.get('epic_order');\n        };\n      })(this));\n      setOrders = _.fromPairs(previousWithTheSameOrder.map((function(_this) {\n        return function(it) {\n          return [it.get('id'), it.get('epic_order')];\n        };\n      })(this)).toJS());\n      data = {\n        order: newOrder\n      };\n      epicId = epic.get('id');\n      userstoryId = userstory.get('id');\n      return this.resources.epics.reorderRelatedUserstory(epicId, userstoryId, data, setOrders).then((function(_this) {\n        return function() {\n          return _this.listRelatedUserStories(epic);\n        };\n      })(this));\n    };\n\n    EpicsService.prototype.replaceEpic = function(epic) {\n      return this._epics = this._epics.map(function(it) {\n        if (it.get('id') === epic.get('id')) {\n          return epic;\n        }\n        return it;\n      });\n    };\n\n    EpicsService.prototype.updateEpicStatus = function(epic, statusId) {\n      var data;\n      data = {\n        status: statusId,\n        version: epic.get('version')\n      };\n      return this.resources.epics.patch(epic.get('id'), data).then(this.replaceEpic.bind(this));\n    };\n\n    EpicsService.prototype.updateEpicAssignedTo = function(epic, userId) {\n      var data;\n      data = {\n        assigned_to: userId,\n        version: epic.get('version')\n      };\n      return this.resources.epics.patch(epic.get('id'), data).then(this.replaceEpic.bind(this));\n    };\n\n    return EpicsService;\n\n  })();\n\n  angular.module('taigaEpics').service('tgEpicsService', EpicsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories.controller.coffee\n */\n\n(function() {\n  var RelatedUserStoriesController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserStoriesController = (function() {\n    RelatedUserStoriesController.$inject = [\"tgProjectService\", \"tgEpicsService\"];\n\n    function RelatedUserStoriesController(projectService, epicsService) {\n      this.projectService = projectService;\n      this.epicsService = epicsService;\n      this.sectionName = \"Epics\";\n      this.showCreateRelatedUserstoriesLightbox = false;\n    }\n\n    RelatedUserStoriesController.prototype.showRelatedUserStoriesSection = function() {\n      var ref;\n      return this.projectService.hasPermission(\"view_epics\") || ((ref = this.userstories) != null ? ref.length : void 0) > 0;\n    };\n\n    RelatedUserStoriesController.prototype.userCanSort = function() {\n      return this.projectService.hasPermission(\"modify_epic\");\n    };\n\n    RelatedUserStoriesController.prototype.loadRelatedUserstories = function() {\n      return this.epicsService.listRelatedUserStories(this.epic).then((function(_this) {\n        return function(userstories) {\n          return _this.userstories = userstories;\n        };\n      })(this));\n    };\n\n    RelatedUserStoriesController.prototype.reorderRelatedUserstory = function(us, newIndex) {\n      return this.epicsService.reorderRelatedUserstory(this.epic, this.userstories, us, newIndex).then((function(_this) {\n        return function(userstories) {\n          return _this.userstories = userstories;\n        };\n      })(this));\n    };\n\n    return RelatedUserStoriesController;\n\n  })();\n\n  module.controller(\"RelatedUserStoriesCtrl\", RelatedUserStoriesController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-create.controller.coffee\n */\n\n(function() {\n  var RelatedUserstoriesCreateController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserstoriesCreateController = (function() {\n    RelatedUserstoriesCreateController.$inject = [\"tgCurrentUserService\", \"tgResources\", \"$tgConfirm\", \"$tgAnalytics\"];\n\n    function RelatedUserstoriesCreateController(currentUserService, rs, confirm, analytics) {\n      this.currentUserService = currentUserService;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.analytics = analytics;\n      this.projects = null;\n      this.projectUserstories = Immutable.List();\n      this.loading = false;\n    }\n\n    RelatedUserstoriesCreateController.prototype.loadProjects = function() {\n      if (this.projects === null) {\n        return this.projects = this.currentUserService.projects.get(\"all\");\n      }\n    };\n\n    RelatedUserstoriesCreateController.prototype.filterUss = function(selectedProjectId, filterText) {\n      var promise;\n      promise = this.rs.userstories.listInAllProjects({\n        project: selectedProjectId,\n        q: filterText\n      }, true).then((function(_this) {\n        return function(data) {\n          var excludeIds, filteredData;\n          excludeIds = _this.epicUserstories.map(function(us) {\n            return us.get('id');\n          });\n          filteredData = data.filter(function(us) {\n            return excludeIds.indexOf(us.get('id')) === -1;\n          });\n          return _this.projectUserstories = filteredData;\n        };\n      })(this));\n      return promise;\n    };\n\n    RelatedUserstoriesCreateController.prototype.saveRelatedUserStory = function(selectedUserstoryId, onSavedRelatedUserstory) {\n      var epicId, onError, onSuccess;\n      if (!this.validateExistingUserstoryForm()) {\n        return;\n      }\n      this.loading = true;\n      onError = (function(_this) {\n        return function(data) {\n          _this.loading = false;\n          _this.confirm.notify(\"error\");\n          return _this.setExistingUserstoryFormErrors(data);\n        };\n      })(this);\n      onSuccess = (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"epic related user story\", \"create\", \"create related user story on epic\", 1);\n          _this.loading = false;\n          if (onSavedRelatedUserstory) {\n            onSavedRelatedUserstory();\n          }\n          return _this.loadRelatedUserstories();\n        };\n      })(this);\n      epicId = this.epic.get('id');\n      return this.rs.epics.addRelatedUserstory(epicId, selectedUserstoryId).then(onSuccess, onError);\n    };\n\n    RelatedUserstoriesCreateController.prototype.bulkCreateRelatedUserStories = function(selectedProjectId, userstoriesText, onCreatedRelatedUserstory) {\n      var epicId, onError, onSuccess;\n      if (!this.validateNewUserstoryForm()) {\n        return;\n      }\n      this.loading = true;\n      onError = (function(_this) {\n        return function(data) {\n          _this.loading = false;\n          _this.confirm.notify(\"error\");\n          return _this.setNewUserstoryFormErrors(data);\n        };\n      })(this);\n      onSuccess = (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"epic related user story\", \"create\", \"create related user story on epic\", 1);\n          _this.loading = false;\n          if (onCreatedRelatedUserstory) {\n            onCreatedRelatedUserstory();\n          }\n          return _this.loadRelatedUserstories();\n        };\n      })(this);\n      epicId = this.epic.get('id');\n      return this.rs.epics.bulkCreateRelatedUserStories(epicId, selectedProjectId, userstoriesText).then(onSuccess, onError);\n    };\n\n    return RelatedUserstoriesCreateController;\n\n  })();\n\n  module.controller(\"RelatedUserstoriesCreateCtrl\", RelatedUserstoriesCreateController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-create.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoriesCreateDirective, debounceLeading, module;\n\n  module = angular.module('taigaEpics');\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  RelatedUserstoriesCreateDirective = function(lightboxService1) {\n    var link;\n    this.lightboxService = lightboxService1;\n    link = function(scope, el, attrs, ctrl) {\n      var existingUserstoryForm, newUserstoryForm;\n      newUserstoryForm = el.find(\".new-user-story-form\").checksley();\n      existingUserstoryForm = el.find(\".existing-user-story-form\").checksley();\n      ctrl.validateNewUserstoryForm = (function(_this) {\n        return function() {\n          return newUserstoryForm.validate();\n        };\n      })(this);\n      ctrl.setNewUserstoryFormErrors = (function(_this) {\n        return function(errors) {\n          return newUserstoryForm.setErrors(errors);\n        };\n      })(this);\n      ctrl.validateExistingUserstoryForm = (function(_this) {\n        return function() {\n          return existingUserstoryForm.validate();\n        };\n      })(this);\n      ctrl.setExistingUserstoryFormErrors = (function(_this) {\n        return function(errors) {\n          return existingUserstoryForm.setErrors(errors);\n        };\n      })(this);\n      scope.showLightbox = function(selectedProjectId) {\n        ctrl.loadProjects();\n        return scope.selectProject(selectedProjectId).then((function(_this) {\n          return function() {\n            return lightboxService.open(el.find(\".lightbox-create-related-user-stories\"));\n          };\n        })(this));\n      };\n      scope.closeLightbox = function() {\n        scope.selectedUserstory = null;\n        scope.searchUserstory = \"\";\n        scope.relatedUserstoriesText = \"\";\n        return lightboxService.close(el.find(\".lightbox-create-related-user-stories\"));\n      };\n      scope.$watch('vm.project', function(project) {\n        if (project != null) {\n          return scope.selectedProject = project.get('id');\n        }\n      });\n      scope.selectProject = function(selectedProjectId) {\n        scope.selectedUserstory = null;\n        scope.searchUserstory = \"\";\n        return ctrl.filterUss(selectedProjectId, scope.searchUserstory);\n      };\n      return scope.onUpdateSearchUserstory = debounceLeading(300, function() {\n        scope.selectedUserstory = null;\n        return ctrl.filterUss(scope.selectedProject, scope.searchUserstory);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/related-userstories/related-userstories-create/related-userstories-create.html\",\n      controller: \"RelatedUserstoriesCreateCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        showCreateRelatedUserstoriesLightbox: \"=\",\n        project: \"=\",\n        epic: \"=\",\n        epicUserstories: \"=\",\n        loadRelatedUserstories: \"&\"\n      }\n    };\n  };\n\n  RelatedUserstoriesCreateDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgRelatedUserstoriesCreate\", RelatedUserstoriesCreateDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories-sortable.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoriesSortableDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserstoriesSortableDirective = function($parse, projectService) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      if (!projectService.hasPermission(\"modify_epic\")) {\n        return;\n      }\n      callback = $parse(attrs.tgRelatedUserstoriesSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('tg-related-userstory-row');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemEl, newIndex, us;\n        itemEl = $(item);\n        us = itemEl.scope().us;\n        newIndex = itemEl.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            us: us,\n            newIndex: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  RelatedUserstoriesSortableDirective.$inject = [\"$parse\", \"tgProjectService\"];\n\n  module.directive(\"tgRelatedUserstoriesSortable\", RelatedUserstoriesSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstories.directive.coffee\n */\n\n(function() {\n  var RelatedUserStoriesDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserStoriesDirective = function() {\n    return {\n      templateUrl: \"epics/related-userstories/related-userstories.html\",\n      controller: \"RelatedUserStoriesCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        userstories: '=',\n        project: '=',\n        epic: '='\n      }\n    };\n  };\n\n  RelatedUserStoriesDirective.$inject = [];\n\n  module.directive(\"tgRelatedUserstories\", RelatedUserStoriesDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: reñated-userstory-row.controller.coffee\n */\n\n(function() {\n  var RelatedUserstoryRowController, module;\n\n  module = angular.module(\"taigaEpics\");\n\n  RelatedUserstoryRowController = (function() {\n    RelatedUserstoryRowController.$inject = [\"tgAvatarService\", \"$translate\", \"$tgConfirm\", \"tgResources\"];\n\n    function RelatedUserstoryRowController(avatarService, translate, confirm, rs) {\n      this.avatarService = avatarService;\n      this.translate = translate;\n      this.confirm = confirm;\n      this.rs = rs;\n    }\n\n    RelatedUserstoryRowController.prototype.setAvatarData = function() {\n      var member;\n      member = this.userstory.get('assigned_to_extra_info');\n      return this.avatar = this.avatarService.getAvatar(member);\n    };\n\n    RelatedUserstoryRowController.prototype.getAssignedToFullNameDisplay = function() {\n      if (this.userstory.get('assigned_to')) {\n        return this.userstory.getIn(['assigned_to_extra_info', 'full_name_display']);\n      }\n      return this.translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\");\n    };\n\n    RelatedUserstoryRowController.prototype.onDeleteRelatedUserstory = function() {\n      var message, title;\n      title = this.translate.instant('EPIC.TITLE_LIGHTBOX_UNLINK_RELATED_USERSTORY');\n      message = this.translate.instant('EPIC.MSG_LIGHTBOX_UNLINK_RELATED_USERSTORY', {\n        subject: this.userstory.get('subject')\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var epicId, onError, onSuccess, userstoryId;\n          onError = function() {\n            message = _this.translate.instant('EPIC.ERROR_UNLINK_RELATED_USERSTORY', {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            _this.loadRelatedUserstories();\n            return askResponse.finish();\n          };\n          epicId = _this.epic.get('id');\n          userstoryId = _this.userstory.get('id');\n          return _this.rs.epics.deleteRelatedUserstory(epicId, userstoryId).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return RelatedUserstoryRowController;\n\n  })();\n\n  module.controller(\"RelatedUserstoryRowCtrl\", RelatedUserstoryRowController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: related-userstory-row.directive.coffee\n */\n\n(function() {\n  var RelatedUserstoryRowDirective, module;\n\n  module = angular.module('taigaEpics');\n\n  RelatedUserstoryRowDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.setAvatarData();\n    };\n    return {\n      link: link,\n      templateUrl: \"epics/related-userstories/related-userstory-row/related-userstory-row.html\",\n      controller: \"RelatedUserstoryRowCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        userstory: '=',\n        epic: '=',\n        project: '=',\n        loadRelatedUserstories: \"&\"\n      }\n    };\n  };\n\n  RelatedUserstoryRowDirective.$inject = [];\n\n  module.directive(\"tgRelatedUserstoryRow\", RelatedUserstoryRowDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var CommentController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  CommentController = (function() {\n    CommentController.$inject = [\"tgCurrentUserService\", \"tgCheckPermissionsService\", \"tgLightboxFactory\"];\n\n    function CommentController(currentUserService, permissionService, lightboxFactory) {\n      this.currentUserService = currentUserService;\n      this.permissionService = permissionService;\n      this.lightboxFactory = lightboxFactory;\n      this.hiddenDeletedComment = true;\n    }\n\n    CommentController.prototype.showDeletedComment = function() {\n      return this.hiddenDeletedComment = false;\n    };\n\n    CommentController.prototype.hideDeletedComment = function() {\n      return this.hiddenDeletedComment = true;\n    };\n\n    CommentController.prototype.checkCancelComment = function(event) {\n      if (event.keyCode === 27) {\n        return this.onEditMode({\n          commentId: this.comment.id\n        });\n      }\n    };\n\n    CommentController.prototype.canEditDeleteComment = function() {\n      if (this.currentUserService.getUser()) {\n        this.user = this.currentUserService.getUser();\n        return this.user.get('id') === this.comment.user.pk || this.permissionService.check('modify_project');\n      }\n    };\n\n    CommentController.prototype.saveComment = function(text, cb) {\n      return this.onEditComment({\n        commentId: this.comment.id,\n        commentData: text,\n        callback: cb\n      });\n    };\n\n    CommentController.prototype.displayCommentHistory = function() {\n      return this.lightboxFactory.create('tg-lb-display-historic', {\n        \"class\": \"lightbox lightbox-display-historic\",\n        \"comment\": \"comment\",\n        \"name\": \"name\",\n        \"object\": \"object\"\n      }, {\n        \"comment\": this.comment,\n        \"name\": this.name,\n        \"object\": this.object\n      });\n    };\n\n    return CommentController;\n\n  })();\n\n  module.controller(\"CommentCtrl\", CommentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var CommentDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  CommentDirective = function() {\n    return {\n      scope: {\n        name: \"@\",\n        object: \"@\",\n        comment: \"<\",\n        type: \"<\",\n        loading: \"<\",\n        editing: \"<\",\n        deleting: \"<\",\n        objectId: \"<\",\n        editMode: \"<\",\n        onEditMode: \"&\",\n        onDeleteComment: \"&\",\n        onRestoreDeletedComment: \"&\",\n        onEditComment: \"&\"\n      },\n      templateUrl: \"history/comments/comment.html\",\n      bindToController: true,\n      controller: 'CommentCtrl',\n      controllerAs: \"vm\"\n    };\n  };\n\n  module.directive(\"tgComment\", CommentDirective);\n\n}).call(this);\n\n\n/*\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comments.controller.coffee\n */\n\n(function() {\n  var CommentsController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  CommentsController = (function() {\n    CommentsController.$inject = [];\n\n    function CommentsController() {}\n\n    CommentsController.prototype.initializePermissions = function() {\n      return this.canAddCommentPermission = 'comment_' + this.name;\n    };\n\n    return CommentsController;\n\n  })();\n\n  module.controller(\"CommentsCtrl\", CommentsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comments.directive.coffee\n */\n\n(function() {\n  var CommentsDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  CommentsDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initializePermissions();\n    };\n    return {\n      scope: {\n        type: \"<\",\n        name: \"@\",\n        object: \"@\",\n        comments: \"<\",\n        onEditMode: \"&\",\n        onDeleteComment: \"&\",\n        onRestoreDeletedComment: \"&\",\n        onAddComment: \"&\",\n        onEditComment: \"&\",\n        editMode: \"<\",\n        loading: \"<\",\n        deleting: \"<\",\n        editing: \"<\",\n        projectId: \"=\"\n      },\n      templateUrl: \"history/comments/comments.html\",\n      bindToController: true,\n      controller: 'CommentsCtrl',\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgComments\", CommentsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var LightboxDisplayHistoricController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  LightboxDisplayHistoricController = (function() {\n    LightboxDisplayHistoricController.$inject = [\"$tgResources\"];\n\n    function LightboxDisplayHistoricController(rs) {\n      this.rs = rs;\n    }\n\n    LightboxDisplayHistoricController.prototype._loadHistoric = function() {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.object;\n      activityId = this.comment.id;\n      return this.rs.history.getCommentHistory(type, objectId, activityId).then((function(_this) {\n        return function(data) {\n          return _this.commentHistoryEntries = data;\n        };\n      })(this));\n    };\n\n    return LightboxDisplayHistoricController;\n\n  })();\n\n  module.controller(\"LightboxDisplayHistoricCtrl\", LightboxDisplayHistoricController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var LightboxDisplayHistoricDirective;\n\n  LightboxDisplayHistoricDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      ctrl._loadHistoric();\n      return lightboxService.open(el);\n    };\n    return {\n      scope: {},\n      bindToController: {\n        name: '=',\n        object: '=',\n        comment: '='\n      },\n      templateUrl: \"history/history-lightbox/comment-history-lightbox.html\",\n      controller: \"LightboxDisplayHistoricCtrl\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  LightboxDisplayHistoricDirective.$inject = [\"lightboxService\"];\n\n  angular.module('taigaHistory').directive(\"tgLbDisplayHistoric\", LightboxDisplayHistoricDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: comment.directive.coffee\n */\n\n(function() {\n  var HistoryEntryDirective;\n\n  HistoryEntryDirective = function() {\n    return {\n      scope: {\n        entry: \"<\"\n      },\n      templateUrl: \"history/history-lightbox/history-entry.html\"\n    };\n  };\n\n  angular.module('taigaHistory').directive(\"tgHistoryEntry\", HistoryEntryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history-tabs.directive.coffee\n */\n\n(function() {\n  var HistoryTabsDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryTabsDirective = function() {\n    return {\n      templateUrl: \"history/history-tabs/history-tabs.html\",\n      scope: {\n        showCommentTab: \"&\",\n        showActivityTab: \"&\",\n        onActiveComments: \"&\",\n        onActiveActivities: \"&\",\n        onOrderComments: \"&\",\n        activeTab: \"<\",\n        commentsNum: \"<\",\n        activitiesNum: \"<\",\n        onReverse: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgHistoryTabs\", HistoryTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var HistorySectionController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  HistorySectionController = (function() {\n    HistorySectionController.$inject = [\"$tgResources\", \"$tgRepo\", \"$tgStorage\", \"tgProjectService\"];\n\n    function HistorySectionController(rs, repo, storage, projectService) {\n      this.rs = rs;\n      this.repo = repo;\n      this.storage = storage;\n      this.projectService = projectService;\n      this.editing = null;\n      this.deleting = null;\n      this.editMode = {};\n      this.viewComments = true;\n      this.reverse = this.storage.get(\"orderComments\");\n      this._loadHistory();\n    }\n\n    HistorySectionController.prototype._loadHistory = function() {\n      return this.rs.history.get(this.name, this.id).then((function(_this) {\n        return function(history) {\n          _this._getComments(history);\n          return _this._getActivities(history);\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype._getComments = function(comments) {\n      this.comments = _.filter(comments, function(item) {\n        return item.comment !== \"\";\n      });\n      if (this.reverse) {\n        this.comments - _.reverse(this.comments);\n      }\n      return this.commentsNum = this.comments.length;\n    };\n\n    HistorySectionController.prototype._getActivities = function(activities) {\n      this.activities = _.filter(activities, function(item) {\n        return Object.keys(item.values_diff).length > 0;\n      });\n      return this.activitiesNum = this.activities.length;\n    };\n\n    HistorySectionController.prototype.showHistorySection = function() {\n      return this.showCommentTab() || this.showActivityTab();\n    };\n\n    HistorySectionController.prototype.showCommentTab = function() {\n      return this.commentsNum > 0 || this.projectService.hasPermission(\"comment_\" + this.name);\n    };\n\n    HistorySectionController.prototype.showActivityTab = function() {\n      return this.activitiesNum > 0;\n    };\n\n    HistorySectionController.prototype.toggleEditMode = function(commentId) {\n      return this.editMode[commentId] = !this.editMode[commentId];\n    };\n\n    HistorySectionController.prototype.onActiveHistoryTab = function(active) {\n      return this.viewComments = active;\n    };\n\n    HistorySectionController.prototype.deleteComment = function(commentId) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.deleting = commentId;\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return _this.deleting = null;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.editComment = function(commentId, comment) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.editing = commentId;\n      return this.rs.history.editComment(type, objectId, activityId, comment).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          _this.toggleEditMode(commentId);\n          return _this.editing = null;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.restoreDeletedComment = function(commentId) {\n      var activityId, objectId, type;\n      type = this.name;\n      objectId = this.id;\n      activityId = commentId;\n      this.editing = commentId;\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return _this.editing = null;\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.addComment = function(cb) {\n      return this.repo.save(this.type).then((function(_this) {\n        return function() {\n          _this._loadHistory();\n          return cb();\n        };\n      })(this));\n    };\n\n    HistorySectionController.prototype.onOrderComments = function() {\n      this.reverse = !this.reverse;\n      this.storage.set(\"orderComments\", this.reverse);\n      return this._loadHistory();\n    };\n\n    return HistorySectionController;\n\n  })();\n\n  module.controller(\"HistorySection\", HistorySectionController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistorySectionDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistorySectionDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {\n      return scope.$on(\"object:updated\", function() {\n        return ctrl._loadHistory(scope.type, scope.id);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"history/history.html\",\n      controller: \"HistorySection\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        type: \"=\",\n        name: \"@\",\n        id: \"=\",\n        projectId: \"=\"\n      }\n    };\n  };\n\n  HistorySectionDirective.$inject = [];\n\n  module.directive(\"tgHistorySection\", HistorySectionDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.controller.coffee\n */\n\n(function() {\n  var ActivitiesDiffController, module;\n\n  module = angular.module(\"taigaHistory\");\n\n  ActivitiesDiffController = (function() {\n    ActivitiesDiffController.$inject = [];\n\n    function ActivitiesDiffController() {}\n\n    ActivitiesDiffController.prototype.diffTags = function() {\n      if (this.type === 'tags') {\n        this.diffRemoveTags = _.difference(this.diff[0], this.diff[1]).toString();\n        return this.diffAddTags = _.difference(this.diff[1], this.diff[0]).toString();\n      }\n    };\n\n    return ActivitiesDiffController;\n\n  })();\n\n  module.controller(\"ActivitiesDiffCtrl\", ActivitiesDiffController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistoryDiffDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryDiffDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.diffTags();\n    };\n    return {\n      scope: {\n        type: \"<\",\n        diff: \"<\"\n      },\n      templateUrl: \"history/history/history-diff.html\",\n      controller: \"ActivitiesDiffCtrl\",\n      controllerAs: 'vm',\n      bindToController: true,\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistoryDiff\", HistoryDiffDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: history.directive.coffee\n */\n\n(function() {\n  var HistoryDirective, module;\n\n  module = angular.module('taigaHistory');\n\n  HistoryDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      scope: {\n        activities: \"<\"\n      },\n      templateUrl: \"history/history/history.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", HistoryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      scope.vm.type = scope.type;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"epics\") {\n            return $translate.instant(\"COMMON.EPIC\");\n          }\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\",\n        \"type\": \"@\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, _getValidDutiesAndAttachProjectInfo, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('project', project);\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      _getValidDutiesAndAttachProjectInfo = function(duties, dutyType) {\n        duties = duties.filter(function(duty) {\n          return projectsById.get(String(duty.get('project')));\n        });\n        duties = duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, dutyType);\n        });\n        return duties;\n      };\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"epics\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"epics\"), \"epics\");\n        assignedTo = assignedTo.set(\"epics\", _duties);\n      }\n      if (assignedTo.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"userStories\"), \"userstories\");\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"tasks\"), \"tasks\");\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"issues\"), \"issues\");\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"epics\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"epics\"), \"epics\");\n        watching = watching.set(\"epics\", _duties);\n      }\n      if (watching.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"userStories\"), \"userstories\");\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"tasks\"), \"tasks\");\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"issues\"), \"issues\");\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedEpicsPromise, assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params_epics, params_issues, params_tasks, params_uss, projectsById, projectsPromise, watching, watchingEpicsPromise, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params_epics = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_uss = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      params_tasks = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_issues = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      assignedEpicsPromise = this.rs.epics.listInAllProjects(params_epics).then(function(epics) {\n        return assignedTo = assignedTo.set(\"epics\", epics);\n      });\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_uss).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params_tasks).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params_issues).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params_epics = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_uss = {\n        is_closed: false,\n        watchers: userId\n      };\n      params_tasks = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_issues = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingEpicsPromise = this.rs.epics.listInAllProjects(params_epics).then(function(epics) {\n        return watching = watching.set(\"epics\", epics);\n      });\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_uss).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params_tasks).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params_issues).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedEpicsPromise, watchingEpicsPromise, assignedUserStoriesPromise, watchingUserStoriesPromise, assignedTasksPromise, watchingTasksPromise, assignedIssuesPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      return taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var epics, issues, tasks, userStories;\n      epics = workInProgress.get(\"assignedTo\").get(\"epics\");\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues).concat(epics);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var epics, issues, tasks, userStories;\n      epics = workInProgress.get(\"watching\").get(\"epics\");\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues).concat(epics);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: add-members.controller.coffee\n */\n\n(function() {\n  var InviteMembersFormController, taiga;\n\n  taiga = this.taiga;\n\n  InviteMembersFormController = (function() {\n    InviteMembersFormController.$inject = [\"tgProjectService\", \"$tgResources\", \"lightboxService\", \"$tgConfirm\", \"$rootScope\"];\n\n    function InviteMembersFormController(projectService, rs, lightboxService, confirm, rootScope) {\n      this.projectService = projectService;\n      this.rs = rs;\n      this.lightboxService = lightboxService;\n      this.confirm = confirm;\n      this.rootScope = rootScope;\n      this.project = this.projectService.project;\n      this.roles = this.projectService.project.get('roles');\n      this.rolesValues = {};\n      this.loading = false;\n      this.defaultMaxInvites = 4;\n    }\n\n    InviteMembersFormController.prototype._areRolesValidated = function() {\n      return Object.defineProperty(this, 'areRolesValidated', {\n        get: (function(_this) {\n          return function() {\n            var roleIds;\n            roleIds = _.filter(Object.values(_this.rolesValues), function(it) {\n              return it;\n            });\n            return roleIds.length === _this.contactsToInvite.size + _this.emailsToInvite.size;\n          };\n        })(this)\n      });\n    };\n\n    InviteMembersFormController.prototype._checkLimitMemberships = function() {\n      var pendingMembersCount;\n      if (this.project.get('max_memberships') === null) {\n        this.membersLimit = this.defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.get('max_memberships') - this.project.get('total_memberships'), 0);\n        this.membersLimit = Math.min(pendingMembersCount, this.defaultMaxInvites);\n      }\n      return this.showWarningMessage = this.membersLimit < this.defaultMaxInvites;\n    };\n\n    InviteMembersFormController.prototype.sendInvites = function() {\n      this.setInvitedContacts = [];\n      _.forEach(this.rolesValues, (function(_this) {\n        return function(key, value) {\n          return _this.setInvitedContacts.push({\n            'role_id': key,\n            'username': value\n          });\n        };\n      })(this));\n      this.loading = true;\n      return this.rs.memberships.bulkCreateMemberships(this.project.get('id'), this.setInvitedContacts, this.inviteContactsMessage).then((function(_this) {\n        return function(response) {\n          return _this.projectService.fetchProject().then(function() {\n            _this.loading = false;\n            _this.lightboxService.closeAll();\n            _this.rootScope.$broadcast(\"membersform:new:success\");\n            return _this.confirm.notify('success');\n          });\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(response) {\n          _this.loading = false;\n          if (response.data._error_message) {\n            return _this.confirm.notify(\"error\", response.data._error_message);\n          }\n        };\n      })(this));\n    };\n\n    return InviteMembersFormController;\n\n  })();\n\n  angular.module(\"taigaAdmin\").controller(\"InviteMembersFormCtrl\", InviteMembersFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: invite-members.directive.coffee\n */\n\n(function() {\n  var InviteMembersFormDirective;\n\n  InviteMembersFormDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      ctrl._areRolesValidated();\n      return ctrl._checkLimitMemberships();\n    };\n    return {\n      scope: {},\n      templateUrl: \"invite-members/invite-members-form/invite-members-form.html\",\n      controller: \"InviteMembersFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        contactsToInvite: '<',\n        emailsToInvite: '=',\n        onDisplayContactList: '&',\n        onRemoveInvitedContact: '&',\n        onRemoveInvitedEmail: '&',\n        onSendInvites: '&'\n      },\n      link: link\n    };\n  };\n\n  angular.module(\"taigaAdmin\").directive(\"tgInviteMembersForm\", InviteMembersFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: add-members.controller.coffee\n */\n\n(function() {\n  var AddMembersController, taiga;\n\n  taiga = this.taiga;\n\n  AddMembersController = (function() {\n    AddMembersController.$inject = [\"tgUserService\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function AddMembersController(userService, currentUserService, projectService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n      this.contactsToInvite = Immutable.List();\n      this.emailsToInvite = Immutable.List();\n      this.displayContactList = false;\n    }\n\n    AddMembersController.prototype._getContacts = function() {\n      var excludeProjectId, userId;\n      userId = this.currentUserService.getUser().get(\"id\");\n      excludeProjectId = this.projectService.project.get(\"id\");\n      return this.userService.getContacts(userId, excludeProjectId).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    AddMembersController.prototype._filterContacts = function(invited) {\n      return this.contacts = this.contacts.filter((function(_this) {\n        return function(contact) {\n          return contact.get('id') !== invited.get('id');\n        };\n      })(this));\n    };\n\n    AddMembersController.prototype.inviteSuggested = function(contact) {\n      this.contactsToInvite = this.contactsToInvite.push(contact);\n      this._filterContacts(contact);\n      return this.displayContactList = true;\n    };\n\n    AddMembersController.prototype.removeContact = function(invited) {\n      this.contactsToInvite = this.contactsToInvite.filter((function(_this) {\n        return function(contact) {\n          return contact.get('id') !== invited.id;\n        };\n      })(this));\n      invited = Immutable.fromJS(invited);\n      this.contacts = this.contacts.push(invited);\n      return this.testEmptyContacts();\n    };\n\n    AddMembersController.prototype.inviteEmail = function(email) {\n      var emailData;\n      emailData = Immutable.Map({\n        'email': email\n      });\n      this.emailsToInvite = this.emailsToInvite.push(emailData);\n      return this.displayContactList = true;\n    };\n\n    AddMembersController.prototype.removeEmail = function(invited) {\n      this.emailsToInvite = this.emailsToInvite.filter((function(_this) {\n        return function(email) {\n          return email.get('email') !== invited.email;\n        };\n      })(this));\n      return this.testEmptyContacts();\n    };\n\n    AddMembersController.prototype.testEmptyContacts = function() {\n      if (this.emailsToInvite.size + this.contactsToInvite.size === 0) {\n        return this.displayContactList = false;\n      }\n    };\n\n    return AddMembersController;\n\n  })();\n\n  angular.module(\"taigaAdmin\").controller(\"AddMembersCtrl\", AddMembersController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: add-member.directive.coffee\n */\n\n(function() {\n  var LightboxAddMembersDirective;\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl._getContacts();\n    };\n    return {\n      scope: {},\n      templateUrl: \"invite-members/lightbox-add-members.html\",\n      controller: \"AddMembersCtrl\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  angular.module(\"taigaAdmin\").directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: suggest-add-members.controller.coffee\n */\n\n(function() {\n  var SuggestAddMembersController, taiga;\n\n  taiga = this.taiga;\n\n  SuggestAddMembersController = (function() {\n    SuggestAddMembersController.$inject = [];\n\n    function SuggestAddMembersController() {\n      this.contactQuery = \"\";\n    }\n\n    SuggestAddMembersController.prototype.isEmail = function() {\n      return taiga.isEmail(this.contactQuery);\n    };\n\n    SuggestAddMembersController.prototype.filterContacts = function() {\n      return this.filteredContacts = this.contacts.filter((function(_this) {\n        return function(contact) {\n          return contact.get('full_name_display').toLowerCase().includes(_this.contactQuery.toLowerCase()) || contact.get('username').toLowerCase().includes(_this.contactQuery.toLowerCase());\n        };\n      })(this)).slice(0, 12);\n    };\n\n    SuggestAddMembersController.prototype.setInvited = function(contact) {\n      return this.onInviteSuggested({\n        'contact': contact\n      });\n    };\n\n    return SuggestAddMembersController;\n\n  })();\n\n  angular.module(\"taigaAdmin\").controller(\"SuggestAddMembersCtrl\", SuggestAddMembersController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: suggest-add-member.directive.coffee\n */\n\n(function() {\n  var SuggestAddMembersDirective;\n\n  SuggestAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.$watch(\"vm.contacts\", (function(_this) {\n        return function(contacts) {\n          if (contacts) {\n            return ctrl.filterContacts();\n          }\n        };\n      })(this));\n    };\n    return {\n      scope: {},\n      templateUrl: \"invite-members/suggest-add-members/suggest-add-members.html\",\n      controller: \"SuggestAddMembersCtrl\",\n      controllerAs: \"vm\",\n      bindToController: {\n        contacts: '=',\n        onInviteSuggested: '&',\n        onInviteEmail: '&'\n      },\n      link: link\n    };\n  };\n\n  angular.module(\"taigaAdmin\").directive(\"tgSuggestAddMembers\", [\"lightboxService\", SuggestAddMembersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.supportUrl = config.get(\"supportUrl\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileCalendarController, ProfileLikedController, ProfileReadyController, ProfileVotedController, ProfileWatchedController, ProfileWeeklyController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByEpics = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      console.log(this.user);\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showEpicsOnly = function() {\n      if (this.type !== \"epic\") {\n        this.type = \"epic\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.tabName = 'likes';\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByEpics = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.tabName = 'upvotes';\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByEpics = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this.tabName = 'watchers';\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n  ProfileReadyController = (function(superClass) {\n    extend(ProfileReadyController, superClass);\n\n    ProfileReadyController.$inject = [\"tgUserService\"];\n\n    function ProfileReadyController(userService) {\n      this.userService = userService;\n      ProfileReadyController.__super__.constructor.call(this);\n      this.tabName = 'MySelf';\n      this._getItems = this.userService.getMySelf;\n    }\n\n    return ProfileReadyController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileReady\", ProfileReadyController);\n\n  ProfileWeeklyController = (function(superClass) {\n    extend(ProfileWeeklyController, superClass);\n\n    ProfileWeeklyController.$inject = [\"tgUserService\"];\n\n    function ProfileWeeklyController(userService) {\n      this.userService = userService;\n      this.scrollDisabled = false;\n      this.data = {};\n      this._getItems = this.userService.getWeekly;\n      this.data.estimated_start = moment().day(1).format('YYYY-MM-DD');\n      this.data.estimated_end = moment().day(7).format('YYYY-MM-DD');\n    }\n\n    ProfileWeeklyController.prototype.loadItems = function() {\n      var estimated_end, estimated_start;\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      if ($('.date-begin').val()) {\n        estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD\");\n      }\n      if ($('.date-over').val()) {\n        estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD\");\n      }\n      return this._getItems(this.user.get(\"id\"), estimated_start, estimated_end).then((function(_this) {\n        return function(response) {\n          _this.data.description = response.get(\"data\");\n          _this._disableScroll();\n          _this._disableLoadingSpinner();\n          return _this.data;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.data;\n        };\n      })(this));\n    };\n\n    return ProfileWeeklyController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWeekly\", ProfileWeeklyController);\n\n  ProfileCalendarController = (function(superClass) {\n    extend(ProfileCalendarController, superClass);\n\n    ProfileCalendarController.$inject = [\"tgUserService\", \"tgResources\"];\n\n    function ProfileCalendarController(userService, rs) {\n      this.userService = userService;\n      this.rs = rs;\n      this.scrollDisabled = false;\n      this.data = {};\n      this._getUrl = this.userService.getCalendarUrl;\n      this.data.estimated_start = '';\n      this.data.estimated_end = '';\n      this.data.project_id = '订阅指定项目的任务';\n      this.rs.projects.getProjects().then((function(_this) {\n        return function(response) {\n          var projects;\n          projects = response.data;\n          return _this.data.projects = projects;\n        };\n      })(this));\n    }\n\n    ProfileCalendarController.prototype.loadItems = function() {\n      console.log(this.data);\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      this.loadUrl();\n      window.open(this.url, '_blank');\n      return this._disableLoadingSpinner();\n    };\n\n    ProfileCalendarController.prototype.loadUrl = function() {\n      var estimated_end, estimated_start;\n      if ($('.date-begin').val()) {\n        estimated_start = moment($('.date-begin').val()).format(\"YYYY-MM-DD\");\n      }\n      if ($('.date-over').val()) {\n        estimated_end = moment($('.date-over').val()).format(\"YYYY-MM-DD\");\n      }\n      this.url = this._getUrl();\n      this.url = this.url.replace('https', 'webcal');\n      this.url = this.url.replace('http', 'webcal');\n      this.url += '?user_id=' + this.user.get('id');\n      if (estimated_start) {\n        this.url += '&start=' + estimated_start;\n      }\n      if (estimated_end) {\n        this.url += '&end=' + estimated_end;\n      }\n      if (typeof this.data.project_id === 'number') {\n        this.url += '&project_id=' + this.data.project_id;\n      }\n      return this.loadDocs();\n    };\n\n    ProfileCalendarController.prototype.loadDocs = function() {\n      this.data.docs = '# 日历订阅\\n ##订阅\\n ### 方法1(一步到位)、点击订阅按钮\\n### 方法2(手动操作)、打开calendar 选择新建订阅选项，输入url\\n ```\\n' + this.url + '\\n```\\n ## 高级选项\\n ```\\n - 起始时间(输入框-上)：订阅任务的起始时间-可选，默认40天前\\n - 结束时间(输入框-中): 订阅任务的结束时间-可选，最好不选，以免超过该时间的数据无法更新\\n - 指定项目(输入框-下): 订阅指定项目的任务-可选，项目所有任务，与人无关\\n```\\n';\n      return this.data.docs;\n    };\n\n    return ProfileCalendarController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileCalendar\", ProfileCalendarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileCalendarDirective, ProfileLikedDirective, ProfileReadyDirective, ProfileVotedDirective, ProfileWatchedDirective, ProfileWeeklyDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n  ProfileReadyDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileReady\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileReady\", ProfileReadyDirective);\n\n  ProfileWeeklyDirective = function() {\n    var base1;\n    base1 = {\n      scope: {},\n      bindToController: {\n        user: \"=\",\n        type: \"@\",\n        q: \"@\",\n        scrollDisabled: \"@\",\n        isLoading: \"@\",\n        hasNoResults: \"@\"\n      },\n      controller: null,\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-favs/profile-weekly.html\"\n    };\n    return _.extend({}, base1, {\n      controller: \"ProfileWeekly\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWeekly\", ProfileWeeklyDirective);\n\n  ProfileCalendarDirective = function() {\n    var base2;\n    base2 = {\n      scope: {},\n      bindToController: {\n        user: \"=\",\n        type: \"@\",\n        q: \"@\",\n        scrollDisabled: \"@\",\n        isLoading: \"@\",\n        hasNoResults: \"@\"\n      },\n      controller: null,\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-favs/profile-calendar.html\"\n    };\n    return _.extend({}, base2, {\n      controller: \"ProfileCalendar\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileCalendar\", ProfileCalendarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://tree.taiga.io/support/admin/import-export-projects/\"\n      }, {\n        url: \"https://tree.taiga.io/support/admin/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var ContactProjectButtonController;\n\n  ContactProjectButtonController = (function() {\n    ContactProjectButtonController.$inject = ['tgLightboxFactory'];\n\n    function ContactProjectButtonController(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ContactProjectButtonController.prototype.launchContactForm = function() {\n      return this.lightboxFactory.create('tg-lb-contact-project', {\n        \"class\": \"lightbox lightbox-contact-project e2e-lightbox-contact-project\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.project\n      });\n    };\n\n    return ContactProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ContactProjectButtonCtrl\", ContactProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: contact-project-button.directive.coffee\n */\n\n(function() {\n  var ContactProjectButtonDirective;\n\n  ContactProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"ContactProjectButtonCtrl\",\n      bindToController: {\n        project: '=',\n        layout: '@'\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/contact-project-button/contact-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgContactProjectButton\", ContactProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lb-contact-team.controller.coffee\n */\n\n(function() {\n  var ContactProjectLbController;\n\n  ContactProjectLbController = (function() {\n    ContactProjectLbController.$inject = [\"lightboxService\", \"tgResources\", \"$tgConfirm\"];\n\n    function ContactProjectLbController(lightboxService, rs, confirm) {\n      this.lightboxService = lightboxService;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.contact = {};\n    }\n\n    ContactProjectLbController.prototype.contactProject = function() {\n      var message, project, promise;\n      project = this.project.get('id');\n      message = this.contact.message;\n      promise = this.rs.projects.contactProject(project, message);\n      this.sendingFeedback = true;\n      return promise.then((function(_this) {\n        return function() {\n          _this.lightboxService.closeAll();\n          _this.sendingFeedback = false;\n          return _this.confirm.notify(\"success\");\n        };\n      })(this));\n    };\n\n    return ContactProjectLbController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ContactProjectLbCtrl\", ContactProjectLbController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lb-contact-team.directive.coffee\n */\n\n(function() {\n  var ContactProjectLbDirective;\n\n  ContactProjectLbDirective = function(lightboxService) {\n    var link;\n    this.inject = ['lightboxService'];\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      controller: \"ContactProjectLbCtrl\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/lb-contact-project/lb-contact-project.html\",\n      link: link\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLbContactProject\", [\"lightboxService\", ContactProjectLbDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var drake, itemEl, scroll;\n      itemEl = null;\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).hasClass('list-itemtype-project');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = $(item);\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: asana-import-project-form.controller.coffee\n */\n\n(function() {\n  var AsanaImportProjectFormController;\n\n  AsanaImportProjectFormController = (function() {\n    AsanaImportProjectFormController.$inject = [\"tgCurrentUserService\"];\n\n    function AsanaImportProjectFormController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      this.projectForm = this.project.toJS();\n      this.platformName = \"Asana\";\n      this.projectForm.is_private = false;\n      this.projectForm.keepExternalReference = false;\n      this.projectForm.project_type = \"scrum\";\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n    }\n\n    AsanaImportProjectFormController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.members.size);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.members.size);\n    };\n\n    AsanaImportProjectFormController.prototype.saveForm = function() {\n      return this.onSaveProjectDetails({\n        project: Immutable.fromJS(this.projectForm)\n      });\n    };\n\n    AsanaImportProjectFormController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid;\n      } else {\n        return this.canCreatePublicProjects.valid;\n      }\n    };\n\n    AsanaImportProjectFormController.prototype.isDisabled = function() {\n      return !this.canCreateProject();\n    };\n\n    return AsanaImportProjectFormController;\n\n  })();\n\n  angular.module('taigaProjects').controller('AsanaImportProjectFormCtrl', AsanaImportProjectFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: asana-import-project-form.directive.coffee\n */\n\n(function() {\n  var AsanaImportProjectFormDirective;\n\n  AsanaImportProjectFormDirective = function() {\n    return {\n      link: function(scope, elm, attr, ctrl) {\n        return scope.$watch('vm.members', ctrl.checkUsersLimit.bind(ctrl));\n      },\n      templateUrl: \"projects/create/asana-import/asana-import-project-form/asana-import-project-form.html\",\n      controller: \"AsanaImportProjectFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        members: '<',\n        project: '<',\n        onSaveProjectDetails: '&',\n        onCancelForm: '&',\n        fetchingUsers: '<'\n      }\n    };\n  };\n\n  AsanaImportProjectFormDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgAsanaImportProjectForm\", AsanaImportProjectFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: asana-import.controller.coffee\n */\n\n(function() {\n  var AsanaImportController;\n\n  AsanaImportController = (function() {\n    AsanaImportController.$inject = ['tgAsanaImportService', '$tgConfirm', '$translate', 'tgImportProjectService'];\n\n    function AsanaImportController(asanaImportService, confirm, translate, importProjectService) {\n      this.asanaImportService = asanaImportService;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.importProjectService = importProjectService;\n      this.step = 'autorization-asana';\n      this.project = null;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.asanaImportService.projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'members', (function(_this) {\n        return function() {\n          return _this.asanaImportService.projectUsers;\n        };\n      })(this));\n    }\n\n    AsanaImportController.prototype.startProjectSelector = function() {\n      this.step = 'project-select-asana';\n      return this.asanaImportService.fetchProjects();\n    };\n\n    AsanaImportController.prototype.onSelectProject = function(project) {\n      this.step = 'project-form-asana';\n      this.project = project;\n      this.fetchingUsers = true;\n      return this.asanaImportService.fetchUsers(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.fetchingUsers = false;\n        };\n      })(this));\n    };\n\n    AsanaImportController.prototype.onSaveProjectDetails = function(project) {\n      this.project = project;\n      return this.step = 'project-members-asana';\n    };\n\n    AsanaImportController.prototype.onCancelMemberSelection = function() {\n      return this.step = 'project-form-asana';\n    };\n\n    AsanaImportController.prototype.startImport = function(users) {\n      var loader, promise;\n      loader = this.confirm.loader(this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.TITLE'), this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION'), true);\n      loader.start();\n      promise = this.asanaImportService.importProject(this.project.get('name'), this.project.get('description'), this.project.get('id'), users, this.project.get('keepExternalReference'), this.project.get('is_private'), this.project.get('project_type'));\n      return this.importProjectService.importPromise(promise).then((function(_this) {\n        return function() {\n          return loader.stop();\n        };\n      })(this));\n    };\n\n    AsanaImportController.prototype.submitUserSelection = function(users) {\n      this.startImport(users);\n      return null;\n    };\n\n    return AsanaImportController;\n\n  })();\n\n  angular.module('taigaProjects').controller('AsanaImportCtrl', AsanaImportController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: asana-import.directive.coffee\n */\n\n(function() {\n  var AsanaImportDirective;\n\n  AsanaImportDirective = function() {\n    return {\n      link: function(scope, elm, attrs, ctrl) {\n        return ctrl.startProjectSelector();\n      },\n      templateUrl: \"projects/create/asana-import/asana-import.html\",\n      controller: \"AsanaImportCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        onCancel: '&'\n      }\n    };\n  };\n\n  AsanaImportDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgAsanaImport\", AsanaImportDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: asana-import.service.coffee\n */\n\n(function() {\n  var AsanaImportService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AsanaImportService = (function(superClass) {\n    extend(AsanaImportService, superClass);\n\n    AsanaImportService.$inject = ['tgResources', '$location'];\n\n    function AsanaImportService(resources, location) {\n      this.resources = resources;\n      this.location = location;\n      this.projects = Immutable.List();\n      this.projectUsers = Immutable.List();\n      this.token = null;\n    }\n\n    AsanaImportService.prototype.setToken = function(token) {\n      return this.token = token;\n    };\n\n    AsanaImportService.prototype.fetchProjects = function() {\n      return this.resources.asanaImporter.listProjects(this.token).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    AsanaImportService.prototype.fetchUsers = function(projectId) {\n      return this.resources.asanaImporter.listUsers(this.token, projectId).then((function(_this) {\n        return function(users) {\n          return _this.projectUsers = users;\n        };\n      })(this));\n    };\n\n    AsanaImportService.prototype.importProject = function(name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType) {\n      return this.resources.asanaImporter.importProject(this.token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType);\n    };\n\n    AsanaImportService.prototype.getAuthUrl = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          return _this.resources.asanaImporter.getAuthUrl().then(function(response) {\n            _this.authUrl = response.data.url;\n            return resolve(_this.authUrl);\n          });\n        };\n      })(this));\n    };\n\n    AsanaImportService.prototype.authorize = function(code) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          return _this.resources.asanaImporter.authorize(code).then((function(response) {\n            _this.token = response.data.token;\n            return resolve(_this.token);\n          }), function(error) {\n            return reject(new Error(error.status));\n          });\n        };\n      })(this));\n    };\n\n    return AsanaImportService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgAsanaImportService\", AsanaImportService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-project-form.controller.coffee\n */\n\n(function() {\n  var CreatetProjectFormController;\n\n  CreatetProjectFormController = (function() {\n    CreatetProjectFormController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\", \"$projectUrl\", \"$location\", \"$tgNavUrls\", \"$tgAnalytics\"];\n\n    function CreatetProjectFormController(currentUserService, projectsService, projectUrl, location, navUrls, analytics) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      this.projectUrl = projectUrl;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.projectForm = {\n        is_private: false\n      };\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n      if (this.type === 'scrum') {\n        this.projectForm.creation_template = 1;\n      } else {\n        this.projectForm.creation_template = 2;\n      }\n    }\n\n    CreatetProjectFormController.prototype.submit = function() {\n      this.formSubmitLoading = true;\n      return this.projectsService.create(this.projectForm).then((function(_this) {\n        return function(project) {\n          _this.analytics.trackEvent(\"project\", \"create\", \"project creation\", {\n            slug: project.get('slug'),\n            id: project.get('id')\n          });\n          return _this.location.url(_this.projectUrl.get(project));\n        };\n      })(this));\n    };\n\n    CreatetProjectFormController.prototype.onCancelForm = function() {\n      return this.location.path(this.navUrls.resolve(\"create-project\"));\n    };\n\n    CreatetProjectFormController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid;\n      } else {\n        return this.canCreatePublicProjects.valid;\n      }\n    };\n\n    CreatetProjectFormController.prototype.isDisabled = function() {\n      return this.formSubmitLoading || !this.canCreateProject();\n    };\n\n    return CreatetProjectFormController;\n\n  })();\n\n  angular.module('taigaProjects').controller('CreateProjectFormCtrl', CreatetProjectFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: create-project-form.directive.coffee\n */\n\n(function() {\n  var CreateProjectFormDirective;\n\n  CreateProjectFormDirective = function() {\n    return {\n      templateUrl: \"projects/create/create-project-form/create-project-form.html\",\n      controller: \"CreateProjectFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        type: '@'\n      }\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCreateProjectForm\", CreateProjectFormDirective);\n\n}).call(this);\n\n(function() {\n  var createProjectMembersRestrictionsDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectMembersRestrictionsDirective = function() {\n    return {\n      scope: {\n        isPrivate: '=',\n        limitMembersPrivateProject: '=',\n        limitMembersPublicProject: '='\n      },\n      templateUrl: \"projects/create/create-project-members-restrictions/create-project-members-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectMembersRestrictions', [createProjectMembersRestrictionsDirective]);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionsDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        isPrivate: '=',\n        canCreatePrivateProjects: '=',\n        canCreatePublicProjects: '='\n      },\n      templateUrl: \"projects/create/create-project-restrictions/create-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestrictions', [createProjectRestrictionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var CreateProjectController;\n\n  CreateProjectController = (function() {\n    CreateProjectController.$inject = [\"tgAppMetaService\", \"$translate\", \"tgProjectService\", \"$location\", \"$tgAuth\"];\n\n    function CreateProjectController(appMetaService, translate, projectService, location, authService) {\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n      this.authService.refresh();\n      this.displayScrumDesc = false;\n      this.displayKanbanDesc = false;\n    }\n\n    CreateProjectController.prototype._setMeta = function() {\n      var ctx;\n      if (!this.project) {\n        return null;\n      }\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      return {\n        title: this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx),\n        description: this.project.get(\"description\")\n      };\n    };\n\n    CreateProjectController.prototype.displayHelp = function(type, $event) {\n      $event.stopPropagation();\n      $event.preventDefault();\n      if (type === 'scrum') {\n        this.displayScrumDesc = !this.displayScrumDesc;\n      }\n      if (type === 'kanban') {\n        return this.displayKanbanDesc = !this.displayKanbanDesc;\n      }\n    };\n\n    return CreateProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"CreateProjectCtrl\", CreateProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var DuplicateProjectController;\n\n  DuplicateProjectController = (function() {\n    DuplicateProjectController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\", \"$tgLocation\", \"$tgNavUrls\"];\n\n    function DuplicateProjectController(currentUserService, projectsService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.user = this.currentUserService.getUser();\n      this.members = Immutable.List();\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n      this.projectForm = {\n        is_private: false\n      };\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n    }\n\n    DuplicateProjectController.prototype.refreshReferenceProject = function(slug) {\n      return this.projectsService.getProjectBySlug(slug).then((function(_this) {\n        return function(project) {\n          _this.referenceProject = project;\n          _this.members = project.get('members').filter(function(it) {\n            return it.get('id') !== _this.user.get('id');\n          });\n          _this.invitedMembers = _this.members.map(function(it) {\n            return it.get('id');\n          });\n          return _this.checkUsersLimit();\n        };\n      })(this));\n    };\n\n    DuplicateProjectController.prototype.toggleInvitedMember = function(member) {\n      if (this.invitedMembers.includes(member)) {\n        this.invitedMembers = this.invitedMembers.filter(function(it) {\n          return it !== member;\n        });\n      } else {\n        this.invitedMembers = this.invitedMembers.push(member);\n      }\n      return this.checkUsersLimit();\n    };\n\n    DuplicateProjectController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.invitedMembers.size + 1);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.invitedMembers.size + 1);\n    };\n\n    DuplicateProjectController.prototype.submit = function() {\n      var data, projectId;\n      projectId = this.referenceProject.get('id');\n      data = this.projectForm;\n      data.users = this.invitedMembers;\n      this.formSubmitLoading = true;\n      return this.projectsService.duplicate(projectId, data).then((function(_this) {\n        return function(newProject) {\n          _this.formSubmitLoading = false;\n          _this.location.path(_this.navUrls.resolve(\"project\", {\n            project: newProject.data.slug\n          }));\n          return _this.currentUserService.loadProjects();\n        };\n      })(this));\n    };\n\n    DuplicateProjectController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid && this.limitMembersPrivateProject.valid;\n      } else {\n        return this.canCreatePublicProjects.valid && this.limitMembersPublicProject.valid;\n      }\n    };\n\n    DuplicateProjectController.prototype.isDisabled = function() {\n      return this.formSubmitLoading || !this.canCreateProject();\n    };\n\n    DuplicateProjectController.prototype.onCancelForm = function() {\n      return this.location.path(this.navUrls.resolve(\"create-project\"));\n    };\n\n    return DuplicateProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"DuplicateProjectCtrl\", DuplicateProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duplicate-project.directive.coffee\n */\n\n(function() {\n  var DuplicateProjectDirective;\n\n  DuplicateProjectDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {};\n    return {\n      link: link,\n      templateUrl: \"projects/create/duplicate/duplicate-project.html\",\n      controller: \"DuplicateProjectCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {}\n    };\n  };\n\n  DuplicateProjectDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgDuplicateProject\", DuplicateProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: github-import-project-form.controller.coffee\n */\n\n(function() {\n  var GithubImportProjectFormController;\n\n  GithubImportProjectFormController = (function() {\n    GithubImportProjectFormController.$inject = [\"tgCurrentUserService\"];\n\n    function GithubImportProjectFormController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      this.projectForm = this.project.toJS();\n      this.platformName = \"Github\";\n      this.projectForm.is_private = false;\n      this.projectForm.keepExternalReference = false;\n      this.projectForm.project_type = \"kanban\";\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n    }\n\n    GithubImportProjectFormController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.members.size);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.members.size);\n    };\n\n    GithubImportProjectFormController.prototype.saveForm = function() {\n      return this.onSaveProjectDetails({\n        project: Immutable.fromJS(this.projectForm)\n      });\n    };\n\n    GithubImportProjectFormController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid;\n      } else {\n        return this.canCreatePublicProjects.valid;\n      }\n    };\n\n    GithubImportProjectFormController.prototype.isDisabled = function() {\n      return !this.canCreateProject();\n    };\n\n    return GithubImportProjectFormController;\n\n  })();\n\n  angular.module('taigaProjects').controller('GithubImportProjectFormCtrl', GithubImportProjectFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: github-import-project-form.directive.coffee\n */\n\n(function() {\n  var GithubImportProjectFormDirective;\n\n  GithubImportProjectFormDirective = function() {\n    return {\n      link: function(scope, elm, attr, ctrl) {\n        return scope.$watch('vm.members', ctrl.checkUsersLimit.bind(ctrl));\n      },\n      templateUrl: \"projects/create/github-import/github-import-project-form/github-import-project-form.html\",\n      controller: \"GithubImportProjectFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        members: '<',\n        project: '<',\n        onSaveProjectDetails: '&',\n        onCancelForm: '&',\n        fetchingUsers: '<'\n      }\n    };\n  };\n\n  GithubImportProjectFormDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgGithubImportProjectForm\", GithubImportProjectFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: github-import.controller.coffee\n */\n\n(function() {\n  var GithubImportController;\n\n  GithubImportController = (function() {\n    GithubImportController.$inject = ['tgGithubImportService', '$tgConfirm', '$translate', 'tgImportProjectService'];\n\n    function GithubImportController(githubImportService, confirm, translate, importProjectService) {\n      this.githubImportService = githubImportService;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.importProjectService = importProjectService;\n      this.step = 'autorization-github';\n      this.project = null;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.githubImportService.projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'members', (function(_this) {\n        return function() {\n          return _this.githubImportService.projectUsers;\n        };\n      })(this));\n    }\n\n    GithubImportController.prototype.startProjectSelector = function() {\n      this.step = 'project-select-github';\n      return this.githubImportService.fetchProjects();\n    };\n\n    GithubImportController.prototype.onSelectProject = function(project) {\n      this.step = 'project-form-github';\n      this.project = project;\n      this.fetchingUsers = true;\n      return this.githubImportService.fetchUsers(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.fetchingUsers = false;\n        };\n      })(this));\n    };\n\n    GithubImportController.prototype.onSaveProjectDetails = function(project) {\n      this.project = project;\n      return this.step = 'project-members-github';\n    };\n\n    GithubImportController.prototype.onCancelMemberSelection = function() {\n      return this.step = 'project-form-github';\n    };\n\n    GithubImportController.prototype.startImport = function(users) {\n      var loader, promise;\n      loader = this.confirm.loader(this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.TITLE'), this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION'), true);\n      loader.start();\n      promise = this.githubImportService.importProject(this.project.get('name'), this.project.get('description'), this.project.get('id'), users, this.project.get('keepExternalReference'), this.project.get('is_private'), this.project.get('project_type'));\n      return this.importProjectService.importPromise(promise).then((function(_this) {\n        return function() {\n          return loader.stop();\n        };\n      })(this));\n    };\n\n    GithubImportController.prototype.submitUserSelection = function(users) {\n      this.startImport(users);\n      return null;\n    };\n\n    return GithubImportController;\n\n  })();\n\n  angular.module('taigaProjects').controller('GithubImportCtrl', GithubImportController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: github-import.directive.coffee\n */\n\n(function() {\n  var GithubImportDirective;\n\n  GithubImportDirective = function() {\n    return {\n      link: function(scope, elm, attrs, ctrl) {\n        return ctrl.startProjectSelector();\n      },\n      templateUrl: \"projects/create/github-import/github-import.html\",\n      controller: \"GithubImportCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        onCancel: '&'\n      }\n    };\n  };\n\n  GithubImportDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgGithubImport\", GithubImportDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: github-import.service.coffee\n */\n\n(function() {\n  var GithubImportService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  GithubImportService = (function(superClass) {\n    extend(GithubImportService, superClass);\n\n    GithubImportService.$inject = ['tgResources'];\n\n    function GithubImportService(resources, location) {\n      this.resources = resources;\n      this.location = location;\n      this.projects = Immutable.List();\n      this.projectUsers = Immutable.List();\n    }\n\n    GithubImportService.prototype.setToken = function(token) {\n      return this.token = token;\n    };\n\n    GithubImportService.prototype.fetchProjects = function() {\n      return this.resources.githubImporter.listProjects(this.token).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    GithubImportService.prototype.fetchUsers = function(projectId) {\n      return this.resources.githubImporter.listUsers(this.token, projectId).then((function(_this) {\n        return function(users) {\n          return _this.projectUsers = users;\n        };\n      })(this));\n    };\n\n    GithubImportService.prototype.importProject = function(name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType) {\n      return this.resources.githubImporter.importProject(this.token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType);\n    };\n\n    GithubImportService.prototype.getAuthUrl = function(callbackUri) {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          return _this.resources.githubImporter.getAuthUrl(callbackUri).then(function(response) {\n            _this.authUrl = response.data.url;\n            return resolve(_this.authUrl);\n          });\n        };\n      })(this));\n    };\n\n    GithubImportService.prototype.authorize = function(code) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          return _this.resources.githubImporter.authorize(code).then((function(response) {\n            _this.token = response.data.token;\n            return resolve(_this.token);\n          }), function(error) {\n            return reject(new Error(error.status));\n          });\n        };\n      })(this));\n    };\n\n    return GithubImportService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgGithubImportService\", GithubImportService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project-members.controller.coffee\n */\n\n(function() {\n  var ImportProjectMembersController;\n\n  ImportProjectMembersController = (function() {\n    ImportProjectMembersController.$inject = ['tgCurrentUserService', 'tgUserService'];\n\n    function ImportProjectMembersController(currentUserService, userService) {\n      this.currentUserService = currentUserService;\n      this.userService = userService;\n      this.selectImportUserLightbox = false;\n      this.warningImportUsers = false;\n      this.displayEmailSelector = true;\n      this.cancelledUsers = Immutable.List();\n      this.selectedUsers = Immutable.List();\n      this.selectableUsers = Immutable.List();\n      this.userContacts = Immutable.List();\n    }\n\n    ImportProjectMembersController.prototype.fetchUser = function() {\n      this.currentUser = this.currentUserService.getUser();\n      return this.userService.getContacts(this.currentUser.get('id')).then((function(_this) {\n        return function(userContacts) {\n          _this.userContacts = userContacts;\n          return _this.refreshSelectableUsers();\n        };\n      })(this));\n    };\n\n    ImportProjectMembersController.prototype.searchUser = function(user) {\n      this.selectImportUserLightbox = true;\n      return this.searchingUser = user;\n    };\n\n    ImportProjectMembersController.prototype.beforeSubmitUsers = function() {\n      if (this.selectedUsers.size !== this.members.size) {\n        return this.warningImportUsers = true;\n      } else {\n        return this.submit();\n      }\n    };\n\n    ImportProjectMembersController.prototype.confirmUser = function(externalUser, taigaUser) {\n      var user;\n      this.selectImportUserLightbox = false;\n      user = Immutable.Map();\n      user = user.set('user', externalUser);\n      user = user.set('taigaUser', taigaUser);\n      this.selectedUsers = this.selectedUsers.push(user);\n      this.discardSuggestedUser(externalUser);\n      return this.refreshSelectableUsers();\n    };\n\n    ImportProjectMembersController.prototype.unselectUser = function(user) {\n      var index;\n      index = this.selectedUsers.findIndex(function(it) {\n        return it.getIn(['user', 'id']) === user.get('id');\n      });\n      this.selectedUsers = this.selectedUsers[\"delete\"](index);\n      return this.refreshSelectableUsers();\n    };\n\n    ImportProjectMembersController.prototype.discardSuggestedUser = function(member) {\n      return this.cancelledUsers = this.cancelledUsers.push(member.get('id'));\n    };\n\n    ImportProjectMembersController.prototype.getSelectedMember = function(member) {\n      return this.selectedUsers.find(function(it) {\n        return it.getIn(['user', 'id']) === member.get('id');\n      });\n    };\n\n    ImportProjectMembersController.prototype.isMemberSelected = function(member) {\n      return !!this.getSelectedMember(member);\n    };\n\n    ImportProjectMembersController.prototype.getUser = function(user) {\n      var userSelected;\n      userSelected = this.getSelectedMember(user);\n      if (userSelected) {\n        return userSelected.get('taigaUser');\n      } else {\n        return null;\n      }\n    };\n\n    ImportProjectMembersController.prototype.submit = function() {\n      var users;\n      this.warningImportUsers = false;\n      users = Immutable.Map();\n      this.selectedUsers.map(function(it) {\n        var id;\n        id = '';\n        if (_.isString(it.get('taigaUser'))) {\n          id = it.get('taigaUser');\n        } else {\n          id = it.getIn(['taigaUser', 'id']);\n        }\n        return users = users.set(it.getIn(['user', 'id']), id);\n      });\n      return this.onSubmit({\n        users: users\n      });\n    };\n\n    ImportProjectMembersController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.members.size + 1);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.members.size + 1);\n    };\n\n    ImportProjectMembersController.prototype.showSuggestedMatch = function(member) {\n      return member.get('user') && this.cancelledUsers.indexOf(member.get('id')) === -1 && !this.isMemberSelected(member);\n    };\n\n    ImportProjectMembersController.prototype.getDistinctSelectedTaigaUsers = function() {\n      var ids, users;\n      ids = [];\n      users = this.selectedUsers.filter(function(it) {\n        var id;\n        id = it.getIn(['taigaUser', 'id']);\n        if (ids.indexOf(id) === -1) {\n          ids.push(id);\n          return true;\n        }\n        return false;\n      });\n      return users.filter((function(_this) {\n        return function(it) {\n          return it.getIn(['taigaUser', 'id']) !== _this.currentUser.get('id');\n        };\n      })(this));\n    };\n\n    ImportProjectMembersController.prototype.refreshSelectableUsers = function() {\n      var users;\n      this.importMoreUsersDisabled = this.isImportMoreUsersDisabled();\n      if (this.importMoreUsersDisabled) {\n        users = this.getDistinctSelectedTaigaUsers();\n        this.selectableUsers = users.map(function(it) {\n          return it.get('taigaUser');\n        });\n        this.displayEmailSelector = false;\n      } else {\n        this.selectableUsers = this.userContacts;\n        this.displayEmailSelector = true;\n      }\n      return this.selectableUsers = this.selectableUsers.push(this.currentUser);\n    };\n\n    ImportProjectMembersController.prototype.isImportMoreUsersDisabled = function() {\n      var total, users;\n      users = this.getDistinctSelectedTaigaUsers();\n      total = users.size + 2;\n      if (this.project.get('is_private')) {\n        return !this.currentUserService.canAddMembersPrivateProject(total).valid;\n      } else {\n        return !this.currentUserService.canAddMembersPublicProject(total).valid;\n      }\n    };\n\n    return ImportProjectMembersController;\n\n  })();\n\n  angular.module('taigaProjects').controller('ImportProjectMembersCtrl', ImportProjectMembersController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project-form.directive.coffee\n */\n\n(function() {\n  var ImportProjectMembersDirective;\n\n  ImportProjectMembersDirective = function() {\n    return {\n      link: function(scope, elm, attr, ctrl) {\n        ctrl.fetchUser();\n        return scope.$watch('vm.members', ctrl.checkUsersLimit.bind(ctrl));\n      },\n      templateUrl: \"projects/create/import-project-members/import-project-members.html\",\n      controller: \"ImportProjectMembersCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        members: '<',\n        project: '<',\n        onSubmit: '&',\n        platform: '@',\n        logo: '@',\n        onCancel: '&'\n      }\n    };\n  };\n\n  ImportProjectMembersDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgImportProjectMembers\", ImportProjectMembersDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project-selector.controller.coffee\n */\n\n(function() {\n  var ImportProjectSelectorController;\n\n  ImportProjectSelectorController = (function() {\n    function ImportProjectSelectorController() {}\n\n    ImportProjectSelectorController.prototype.selectProject = function(project) {\n      return this.onSelectProject({\n        project: Immutable.fromJS(project)\n      });\n    };\n\n    return ImportProjectSelectorController;\n\n  })();\n\n  angular.module('taigaProjects').controller('ImportProjectSelectorCtrl', ImportProjectSelectorController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project-selector.directive.coffee\n */\n\n(function() {\n  var ImportProjectSelectorDirective;\n\n  ImportProjectSelectorDirective = function() {\n    return {\n      templateUrl: \"projects/create/import-project-selector/import-project-selector.html\",\n      controller: \"ImportProjectSelectorCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        projects: '<',\n        onCancel: '&',\n        onSelectProject: '&',\n        logo: '@',\n        noProjectsMsg: '@',\n        search: '@'\n      }\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgImportProjectSelector\", ImportProjectSelectorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project.controller.coffee\n */\n\n(function() {\n  var ImportTaigaController;\n\n  ImportTaigaController = (function() {\n    ImportTaigaController.$inject = ['$tgConfirm', '$tgResources', 'tgImportProjectService', '$translate', '$tgAnalytics'];\n\n    function ImportTaigaController(confirm, rs, importProjectService, translate, analytics) {\n      this.confirm = confirm;\n      this.rs = rs;\n      this.importProjectService = importProjectService;\n      this.translate = translate;\n      this.analytics = analytics;\n    }\n\n    ImportTaigaController.prototype.importTaiga = function(files) {\n      var file, loader, promise;\n      this.analytics.trackEvent(\"import\", \"taiga\", \"Start import from taiga\", 1);\n      file = files[0];\n      loader = this.confirm.loader(this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.TITLE'), this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION'), true);\n      loader.start();\n      promise = this.rs.projects[\"import\"](file, loader.update);\n      this.importProjectService.importPromise(promise)[\"finally\"]((function(_this) {\n        return function() {\n          return loader.stop();\n        };\n      })(this));\n    };\n\n    return ImportTaigaController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ImportTaigaCtrl\", ImportTaigaController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-taiga.directive.coffee\n */\n\n(function() {\n  var ImportTaigaDirective;\n\n  ImportTaigaDirective = function() {\n    return {\n      templateUrl: \"projects/create/import-taiga/import-taiga.html\",\n      controller: \"ImportTaigaCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {}\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgImportTaiga\", ImportTaigaDirective);\n\n}).call(this);\n\n(function() {\n  var LbImportErrorDirective;\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"projects/create/import/import-project-error-lb.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  angular.module(\"taigaProjects\").directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project.controller.coffee\n */\n\n(function() {\n  var ImportProjectController;\n\n  ImportProjectController = (function() {\n    ImportProjectController.$inject = ['tgTrelloImportService', 'tgJiraImportService', 'tgGithubImportService', 'tgAsanaImportService', '$location', '$window', '$routeParams', '$tgNavUrls', '$tgConfig', '$tgConfirm', '$tgAnalytics'];\n\n    function ImportProjectController(trelloService, jiraService, githubService, asanaService, location, window, routeParams, tgNavUrls, config, confirm, analytics) {\n      this.trelloService = trelloService;\n      this.jiraService = jiraService;\n      this.githubService = githubService;\n      this.asanaService = asanaService;\n      this.location = location;\n      this.window = window;\n      this.routeParams = routeParams;\n      this.tgNavUrls = tgNavUrls;\n      this.config = config;\n      this.confirm = confirm;\n      this.analytics = analytics;\n    }\n\n    ImportProjectController.prototype.start = function() {\n      var asanaOauthToken, githubOauthToken, jiraOauthToken, jiraOauthVerifier, locationSearch, trelloOauthToken;\n      this.token = null;\n      this.from = this.routeParams.platform;\n      locationSearch = this.location.search();\n      if (this.from) {\n        this.analytics.trackEvent(\"import\", this.from, \"Start import from \" + this.from, 1);\n      }\n      if (this.from === \"asana\") {\n        asanaOauthToken = locationSearch.code;\n        if (locationSearch.code) {\n          asanaOauthToken = locationSearch.code;\n          return this.asanaService.authorize(asanaOauthToken).then(((function(_this) {\n            return function(token) {\n              return _this.location.search({\n                token: encodeURIComponent(JSON.stringify(token))\n              });\n            };\n          })(this)), this.cancelCurrentImport.bind(this));\n        } else {\n          this.token = JSON.parse(decodeURIComponent(locationSearch.token));\n          this.asanaService.setToken(this.token);\n        }\n      }\n      if (this.from === 'trello') {\n        if (locationSearch.oauth_verifier) {\n          trelloOauthToken = locationSearch.oauth_verifier;\n          return this.trelloService.authorize(trelloOauthToken).then(((function(_this) {\n            return function(token) {\n              return _this.location.search({\n                token: token\n              });\n            };\n          })(this)), this.cancelCurrentImport.bind(this));\n        } else if (locationSearch.token) {\n          this.token = locationSearch.token;\n          this.trelloService.setToken(locationSearch.token);\n        }\n      }\n      if (this.from === \"github\") {\n        if (locationSearch.code) {\n          githubOauthToken = locationSearch.code;\n          return this.githubService.authorize(githubOauthToken).then(((function(_this) {\n            return function(token) {\n              return _this.location.search({\n                token: token\n              });\n            };\n          })(this)), this.cancelCurrentImport.bind(this));\n        } else if (locationSearch.token) {\n          this.token = locationSearch.token;\n          this.githubService.setToken(locationSearch.token);\n        }\n      }\n      if (this.from === \"jira\") {\n        jiraOauthToken = locationSearch.oauth_token;\n        if (jiraOauthToken) {\n          jiraOauthVerifier = locationSearch.oauth_verifier;\n          return this.jiraService.authorize(jiraOauthVerifier).then(((function(_this) {\n            return function(data) {\n              return _this.location.search({\n                token: data.token,\n                url: data.url\n              });\n            };\n          })(this)), this.cancelCurrentImport.bind(this));\n        } else {\n          this.token = locationSearch.token;\n          return this.jiraService.setToken(locationSearch.token, locationSearch.url);\n        }\n      }\n    };\n\n    ImportProjectController.prototype.select = function(from) {\n      var callbackUri;\n      if (from === \"trello\") {\n        return this.trelloService.getAuthUrl().then((function(_this) {\n          return function(url) {\n            return _this.window.open(url, \"_self\");\n          };\n        })(this));\n      } else if (from === \"jira\") {\n        return this.jiraService.getAuthUrl(this.jiraUrl).then((function(_this) {\n          return function(url) {\n            return _this.window.open(url, \"_self\");\n          };\n        })(this), (function(_this) {\n          return function(err) {\n            return _this.confirm.notify('error', err);\n          };\n        })(this));\n      } else if (from === \"github\") {\n        callbackUri = this.location.absUrl() + \"/github\";\n        return this.githubService.getAuthUrl(callbackUri).then((function(_this) {\n          return function(url) {\n            return _this.window.open(url, \"_self\");\n          };\n        })(this));\n      } else if (from === \"asana\") {\n        return this.asanaService.getAuthUrl().then((function(_this) {\n          return function(url) {\n            return _this.window.open(url, \"_self\");\n          };\n        })(this));\n      } else {\n        return this.from = from;\n      }\n    };\n\n    ImportProjectController.prototype.unfoldOptions = function(options) {\n      return this.unfoldedOptions = options;\n    };\n\n    ImportProjectController.prototype.isActiveImporter = function(importer) {\n      if (this.config.get('importers').indexOf(importer) === -1) {\n        return false;\n      }\n      return true;\n    };\n\n    ImportProjectController.prototype.cancelCurrentImport = function() {\n      return this.location.url(this.tgNavUrls.resolve('create-project-import'));\n    };\n\n    ImportProjectController.prototype.backToCreate = function() {\n      return this.location.url(this.tgNavUrls.resolve('create-project'));\n    };\n\n    return ImportProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ImportProjectCtrl\", ImportProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project.directive.coffee\n */\n\n(function() {\n  var ImportProjectDirective;\n\n  ImportProjectDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {\n      return ctrl.start();\n    };\n    return {\n      link: link,\n      templateUrl: \"projects/create/import/import-project.html\",\n      controller: \"ImportProjectCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        onCancelImport: '&'\n      }\n    };\n  };\n\n  ImportProjectDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgImportProject\", ImportProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: import-project.service.coffee\n */\n\n(function() {\n  var ImportProjectService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ImportProjectService = (function(superClass) {\n    extend(ImportProjectService, superClass);\n\n    ImportProjectService.$inject = ['tgCurrentUserService', '$tgAuth', 'tgLightboxFactory', '$translate', '$tgConfirm', '$location', '$tgNavUrls'];\n\n    function ImportProjectService(currentUserService, tgAuth, lightboxFactory, translate, confirm, location, tgNavUrls) {\n      this.currentUserService = currentUserService;\n      this.tgAuth = tgAuth;\n      this.lightboxFactory = lightboxFactory;\n      this.translate = translate;\n      this.confirm = confirm;\n      this.location = location;\n      this.tgNavUrls = tgNavUrls;\n    }\n\n    ImportProjectService.prototype.importPromise = function(promise) {\n      return promise.then(this.importSuccess.bind(this), this.importError.bind(this));\n    };\n\n    ImportProjectService.prototype.importSuccess = function(result) {\n      var promise;\n      promise = this.currentUserService.loadProjects();\n      promise.then((function(_this) {\n        return function() {\n          var ctx, message, msg, title;\n          if (result.status === 202) {\n            title = _this.translate.instant('PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE');\n            message = _this.translate.instant('PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE');\n            _this.location.path(_this.tgNavUrls.resolve('home'));\n            return _this.confirm.success(title, message);\n          } else {\n            ctx = {\n              project: result.data.slug\n            };\n            _this.location.path(_this.tgNavUrls.resolve('project-admin-project-profile-details', ctx));\n            msg = _this.translate.instant('PROJECT.IMPORT.SYNC_SUCCESS');\n            return _this.confirm.notify('success', msg);\n          }\n        };\n      })(this));\n      return promise;\n    };\n\n    ImportProjectService.prototype.importError = function(result) {\n      var promise;\n      promise = this.tgAuth.refresh();\n      promise.then((function(_this) {\n        return function() {\n          var errorMsg, ref, restrictionError;\n          restrictionError = _this.getRestrictionError(result);\n          if (restrictionError) {\n            return _this.lightboxFactory.create('tg-lb-import-error', {\n              \"class\": 'lightbox lightbox-import-error'\n            }, restrictionError);\n          } else {\n            errorMsg = _this.translate.instant(\"PROJECT.IMPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = _this.translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = _this.translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                error_message: result.data._error_message\n              });\n            }\n            return _this.confirm.notify(\"error\", errorMsg);\n          }\n        };\n      })(this));\n      return promise;\n    };\n\n    ImportProjectService.prototype.getRestrictionError = function(result) {\n      var errorKey, maxMemberships, membersError, privateError, publicError, user;\n      if (result.headers) {\n        errorKey = '';\n        user = this.currentUserService.getUser();\n        maxMemberships = null;\n        if (result.headers.isPrivate) {\n          privateError = !this.currentUserService.canCreatePrivateProjects().valid;\n          if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n            membersError = true;\n          } else {\n            membersError = false;\n          }\n          if (privateError && membersError) {\n            errorKey = 'private-space-members';\n            maxMemberships = user.get('max_memberships_private_projects');\n          } else if (privateError) {\n            errorKey = 'private-space';\n          } else if (membersError) {\n            errorKey = 'private-members';\n            maxMemberships = user.get('max_memberships_private_projects');\n          }\n        } else {\n          publicError = !this.currentUserService.canCreatePublicProjects().valid;\n          if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n            membersError = true;\n          } else {\n            membersError = false;\n          }\n          if (publicError && membersError) {\n            errorKey = 'public-space-members';\n            maxMemberships = user.get('max_memberships_public_projects');\n          } else if (publicError) {\n            errorKey = 'public-space';\n          } else if (membersError) {\n            errorKey = 'public-members';\n            maxMemberships = user.get('max_memberships_public_projects');\n          }\n        }\n        if (!errorKey) {\n          return false;\n        }\n        return {\n          key: errorKey,\n          values: {\n            max_memberships: maxMemberships,\n            members: result.headers.memberships\n          }\n        };\n      } else {\n        return false;\n      }\n    };\n\n    return ImportProjectService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgImportProjectService\", ImportProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: invite-members.controller.coffee\n */\n\n(function() {\n  var InviteMembersController;\n\n  InviteMembersController = (function() {\n    function InviteMembersController() {}\n\n    InviteMembersController.$inject = [];\n\n    InviteMembersController.prototype.isDisabled = function(id) {\n      return this.invitedMembers.indexOf(id) === -1;\n    };\n\n    return InviteMembersController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"InviteMembersCtrl\", InviteMembersController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: invite-members.directive.coffee\n */\n\n(function() {\n  var InviteMembersDirective;\n\n  InviteMembersDirective = function() {\n    var link;\n    link = function(scope, el, attr, ctrl) {};\n    return {\n      link: link,\n      templateUrl: \"projects/create/invite-members/invite-members.html\",\n      controller: \"InviteMembersCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        invitedMembers: '<',\n        members: '<',\n        onToggleInvitedMember: '&'\n      }\n    };\n  };\n\n  InviteMembersDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgInviteMembers\", InviteMembersDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: single-member.directive.coffee\n */\n\n(function() {\n  var SingleMemberDirective;\n\n  SingleMemberDirective = function() {\n    return {\n      templateUrl: \"projects/create/invite-members/single-member/single-member.html\",\n      scope: {\n        disabled: \"<\",\n        avatar: \"=\"\n      }\n    };\n  };\n\n  SingleMemberDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgSingleMember\", SingleMemberDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: jira-import-project-form.controller.coffee\n */\n\n(function() {\n  var JiraImportProjectFormController;\n\n  JiraImportProjectFormController = (function() {\n    JiraImportProjectFormController.$inject = [\"tgCurrentUserService\"];\n\n    function JiraImportProjectFormController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      this.projectForm = this.project.toJS();\n      this.projectForm.is_private = false;\n      this.projectForm.keepExternalReference = false;\n      if (this.projectForm.importer_type === \"agile\") {\n        this.projectForm.project_type = null;\n      } else {\n        this.projectForm.project_type = \"scrum\";\n      }\n      this.projectForm.create_subissues = true;\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n    }\n\n    JiraImportProjectFormController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.members.size);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.members.size);\n    };\n\n    JiraImportProjectFormController.prototype.saveForm = function() {\n      return this.onSaveProjectDetails({\n        project: Immutable.fromJS(this.projectForm)\n      });\n    };\n\n    JiraImportProjectFormController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid;\n      } else {\n        return this.canCreatePublicProjects.valid;\n      }\n    };\n\n    JiraImportProjectFormController.prototype.isDisabled = function() {\n      return !this.canCreateProject();\n    };\n\n    return JiraImportProjectFormController;\n\n  })();\n\n  angular.module('taigaProjects').controller('JiraImportProjectFormCtrl', JiraImportProjectFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: jira-import-project-form.directive.coffee\n */\n\n(function() {\n  var JiraImportProjectFormDirective;\n\n  JiraImportProjectFormDirective = function() {\n    return {\n      link: function(scope, elm, attr, ctrl) {\n        return scope.$watch('vm.members', ctrl.checkUsersLimit.bind(ctrl));\n      },\n      templateUrl: \"projects/create/jira-import/jira-import-project-form/jira-import-project-form.html\",\n      controller: \"JiraImportProjectFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        members: '<',\n        project: '<',\n        onSaveProjectDetails: '&',\n        onCancelForm: '&',\n        fetchingUsers: '<'\n      }\n    };\n  };\n\n  JiraImportProjectFormDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgJiraImportProjectForm\", JiraImportProjectFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: jira-import.controller.coffee\n */\n\n(function() {\n  var JiraImportController;\n\n  JiraImportController = (function() {\n    JiraImportController.$inject = ['tgJiraImportService', '$tgConfirm', '$translate', 'tgImportProjectService'];\n\n    function JiraImportController(jiraImportService, confirm, translate, importProjectService) {\n      this.jiraImportService = jiraImportService;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.importProjectService = importProjectService;\n      this.step = 'autorization-jira';\n      this.project = null;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.jiraImportService.projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'members', (function(_this) {\n        return function() {\n          return _this.jiraImportService.projectUsers;\n        };\n      })(this));\n    }\n\n    JiraImportController.prototype.startProjectSelector = function() {\n      this.step = 'project-select-jira';\n      return this.jiraImportService.fetchProjects();\n    };\n\n    JiraImportController.prototype.onSelectProject = function(project) {\n      this.step = 'project-form-jira';\n      this.project = project;\n      this.fetchingUsers = true;\n      return this.jiraImportService.fetchUsers(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.fetchingUsers = false;\n        };\n      })(this));\n    };\n\n    JiraImportController.prototype.onSaveProjectDetails = function(project) {\n      this.project = project;\n      return this.step = 'project-members-jira';\n    };\n\n    JiraImportController.prototype.onCancelMemberSelection = function() {\n      return this.step = 'project-form-jira';\n    };\n\n    JiraImportController.prototype.startImport = function(users) {\n      var loader, projectType, promise;\n      loader = this.confirm.loader(this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.TITLE'), this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION'), true);\n      loader.start();\n      projectType = this.project.get('project_type');\n      if (projectType === \"issues\" && this.project.get('create_subissues')) {\n        projectType = \"issues-with-subissues\";\n      }\n      promise = this.jiraImportService.importProject(this.project.get('name'), this.project.get('description'), this.project.get('id'), users, this.project.get('keepExternalReference'), this.project.get('is_private'), projectType, this.project.get('importer_type'));\n      return this.importProjectService.importPromise(promise).then((function(_this) {\n        return function() {\n          return loader.stop();\n        };\n      })(this));\n    };\n\n    JiraImportController.prototype.submitUserSelection = function(users) {\n      this.startImport(users);\n      return null;\n    };\n\n    return JiraImportController;\n\n  })();\n\n  angular.module('taigaProjects').controller('JiraImportCtrl', JiraImportController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: jira-import.directive.coffee\n */\n\n(function() {\n  var JiraImportDirective;\n\n  JiraImportDirective = function() {\n    return {\n      link: function(scope, elm, attrs, ctrl) {\n        return ctrl.startProjectSelector();\n      },\n      templateUrl: \"projects/create/jira-import/jira-import.html\",\n      controller: \"JiraImportCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        onCancel: '&'\n      }\n    };\n  };\n\n  JiraImportDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgJiraImport\", JiraImportDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: jira-import.service.coffee\n */\n\n(function() {\n  var JiraImportService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JiraImportService = (function(superClass) {\n    extend(JiraImportService, superClass);\n\n    JiraImportService.$inject = ['tgResources', '$location'];\n\n    function JiraImportService(resources, location) {\n      this.resources = resources;\n      this.location = location;\n      this.projects = Immutable.List();\n      this.projectUsers = Immutable.List();\n    }\n\n    JiraImportService.prototype.setToken = function(token, url) {\n      this.token = token;\n      return this.url = url;\n    };\n\n    JiraImportService.prototype.fetchProjects = function() {\n      return this.resources.jiraImporter.listProjects(this.url, this.token).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    JiraImportService.prototype.fetchUsers = function(projectId) {\n      return this.resources.jiraImporter.listUsers(this.url, this.token, projectId).then((function(_this) {\n        return function(users) {\n          return _this.projectUsers = users;\n        };\n      })(this));\n    };\n\n    JiraImportService.prototype.importProject = function(name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType, importerType) {\n      return this.resources.jiraImporter.importProject(this.url, this.token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType, importerType);\n    };\n\n    JiraImportService.prototype.getAuthUrl = function(url) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          return _this.resources.jiraImporter.getAuthUrl(url).then(function(response) {\n            _this.authUrl = response.data.url;\n            return resolve(_this.authUrl);\n          }, function(err) {\n            return reject(err.data._error_message);\n          });\n        };\n      })(this));\n    };\n\n    JiraImportService.prototype.authorize = function(oauth_verifier) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          return _this.resources.jiraImporter.authorize(oauth_verifier).then((function(response) {\n            _this.token = response.data.token;\n            _this.url = response.data.url;\n            return resolve(response.data);\n          }), function(error) {\n            return reject(new Error(error.status));\n          });\n        };\n      })(this));\n    };\n\n    return JiraImportService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgJiraImportService\", JiraImportService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import-project-members.controller.coffee\n */\n\n(function() {\n  var SelectImportUserLightboxCtrl;\n\n  SelectImportUserLightboxCtrl = (function() {\n    SelectImportUserLightboxCtrl.$inject = [];\n\n    function SelectImportUserLightboxCtrl() {}\n\n    SelectImportUserLightboxCtrl.prototype.start = function() {\n      this.mode = 'search';\n      return this.invalid = false;\n    };\n\n    SelectImportUserLightboxCtrl.prototype.assignUser = function() {\n      return this.onSelectUser({\n        user: this.user,\n        taigaUser: this.userEmail\n      });\n    };\n\n    SelectImportUserLightboxCtrl.prototype.selectUser = function(taigaUser) {\n      return this.onSelectUser({\n        user: this.user,\n        taigaUser: Immutable.fromJS(taigaUser)\n      });\n    };\n\n    return SelectImportUserLightboxCtrl;\n\n  })();\n\n  angular.module('taigaProjects').controller('SelectImportUserLightboxCtrl', SelectImportUserLightboxCtrl);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: select-import-user-lightbox.directive.coffee\n */\n\n(function() {\n  var SelectImportUserLightboxDirective;\n\n  SelectImportUserLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.$watch('vm.visible', function(visible) {\n        if (visible && !el.hasClass('open')) {\n          ctrl.start();\n          return lightboxService.open(el, null, scope.vm.onClose).then(function() {\n            el.find('input').focus();\n            return lightboxKeyboardNavigationService.init(el);\n          });\n        } else if (!visible && el.hasClass('open')) {\n          return lightboxService.close(el).then(function() {\n            ctrl.userEmail = '';\n            return ctrl.usersSearch = '';\n          });\n        }\n      });\n    };\n    return {\n      controller: \"SelectImportUserLightboxCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        user: '<',\n        visible: '<',\n        onClose: '&',\n        onSelectUser: '&',\n        selectableUsers: '<',\n        isPrivate: '<',\n        limitMembersPrivateProject: '<',\n        limitMembersPublicProject: '<',\n        displayEmailSelector: '<'\n      },\n      templateUrl: 'projects/create/select-import-user-lightbox/select-import-user-lightbox.html',\n      link: link\n    };\n  };\n\n  SelectImportUserLightboxDirective.$inject = ['lightboxService', 'lightboxKeyboardNavigationService'];\n\n  angular.module(\"taigaProjects\").directive(\"tgSelectImportUserLightbox\", SelectImportUserLightboxDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import-project-form.controller.coffee\n */\n\n(function() {\n  var TrelloImportProjectFormController;\n\n  TrelloImportProjectFormController = (function() {\n    TrelloImportProjectFormController.$inject = [\"tgCurrentUserService\"];\n\n    function TrelloImportProjectFormController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.canCreatePublicProjects = this.currentUserService.canCreatePublicProjects();\n      this.canCreatePrivateProjects = this.currentUserService.canCreatePrivateProjects();\n      this.projectForm = this.project.toJS();\n      this.platformName = \"Trello\";\n      this.projectForm.is_private = false;\n      this.projectForm.keepExternalReference = false;\n      if (!this.canCreatePublicProjects.valid && this.canCreatePrivateProjects.valid) {\n        this.projectForm.is_private = true;\n      }\n    }\n\n    TrelloImportProjectFormController.prototype.checkUsersLimit = function() {\n      this.limitMembersPrivateProject = this.currentUserService.canAddMembersPrivateProject(this.members.size);\n      return this.limitMembersPublicProject = this.currentUserService.canAddMembersPublicProject(this.members.size);\n    };\n\n    TrelloImportProjectFormController.prototype.saveForm = function() {\n      return this.onSaveProjectDetails({\n        project: Immutable.fromJS(this.projectForm)\n      });\n    };\n\n    TrelloImportProjectFormController.prototype.canCreateProject = function() {\n      if (this.projectForm.is_private) {\n        return this.canCreatePrivateProjects.valid;\n      } else {\n        return this.canCreatePublicProjects.valid;\n      }\n    };\n\n    TrelloImportProjectFormController.prototype.isDisabled = function() {\n      return !this.canCreateProject();\n    };\n\n    return TrelloImportProjectFormController;\n\n  })();\n\n  angular.module('taigaProjects').controller('TrelloImportProjectFormCtrl', TrelloImportProjectFormController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import-project-form.directive.coffee\n */\n\n(function() {\n  var TrelloImportProjectFormDirective;\n\n  TrelloImportProjectFormDirective = function() {\n    return {\n      link: function(scope, elm, attr, ctrl) {\n        return scope.$watch('vm.members', ctrl.checkUsersLimit.bind(ctrl));\n      },\n      templateUrl: \"projects/create/trello-import/trello-import-project-form/trello-import-project-form.html\",\n      controller: \"TrelloImportProjectFormCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        members: '<',\n        project: '<',\n        onSaveProjectDetails: '&',\n        onCancelForm: '&',\n        fetchingUsers: '<'\n      }\n    };\n  };\n\n  TrelloImportProjectFormDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgTrelloImportProjectForm\", TrelloImportProjectFormDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import.controller.coffee\n */\n\n(function() {\n  var TrelloImportController;\n\n  TrelloImportController = (function() {\n    TrelloImportController.$inject = ['tgTrelloImportService', '$tgConfirm', '$translate', 'tgImportProjectService'];\n\n    function TrelloImportController(trelloImportService, confirm, translate, importProjectService) {\n      this.trelloImportService = trelloImportService;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.importProjectService = importProjectService;\n      this.project = null;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.trelloImportService.projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'members', (function(_this) {\n        return function() {\n          return _this.trelloImportService.projectUsers;\n        };\n      })(this));\n    }\n\n    TrelloImportController.prototype.startProjectSelector = function() {\n      return this.trelloImportService.fetchProjects().then((function(_this) {\n        return function() {\n          return _this.step = 'project-select-trello';\n        };\n      })(this));\n    };\n\n    TrelloImportController.prototype.onSelectProject = function(project) {\n      this.step = 'project-form-trello';\n      this.project = project;\n      this.fetchingUsers = true;\n      return this.trelloImportService.fetchUsers(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.fetchingUsers = false;\n        };\n      })(this));\n    };\n\n    TrelloImportController.prototype.onSaveProjectDetails = function(project) {\n      this.project = project;\n      return this.step = 'project-members-trello';\n    };\n\n    TrelloImportController.prototype.onCancelMemberSelection = function() {\n      return this.step = 'project-form-trello';\n    };\n\n    TrelloImportController.prototype.startImport = function(users) {\n      var loader, promise;\n      loader = this.confirm.loader(this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.TITLE'), this.translate.instant('PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION'), true);\n      loader.start();\n      promise = this.trelloImportService.importProject(this.project.get('name'), this.project.get('description'), this.project.get('id'), users, this.project.get('keepExternalReference'), this.project.get('is_private'));\n      return this.importProjectService.importPromise(promise).then((function(_this) {\n        return function() {\n          return loader.stop();\n        };\n      })(this));\n    };\n\n    TrelloImportController.prototype.submitUserSelection = function(users) {\n      this.startImport(users);\n      return null;\n    };\n\n    return TrelloImportController;\n\n  })();\n\n  angular.module('taigaProjects').controller('TrelloImportCtrl', TrelloImportController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import.directive.coffee\n */\n\n(function() {\n  var TrelloImportDirective;\n\n  TrelloImportDirective = function() {\n    return {\n      link: function(scope, elm, attrs, ctrl) {\n        return ctrl.startProjectSelector();\n      },\n      templateUrl: \"projects/create/trello-import/trello-import.html\",\n      controller: \"TrelloImportCtrl\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      scope: {\n        onCancel: '&'\n      }\n    };\n  };\n\n  TrelloImportDirective.$inject = [];\n\n  angular.module(\"taigaProjects\").directive(\"tgTrelloImport\", TrelloImportDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: trello-import.service.coffee\n */\n\n(function() {\n  var TrelloImportService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  TrelloImportService = (function(superClass) {\n    extend(TrelloImportService, superClass);\n\n    TrelloImportService.$inject = ['tgResources'];\n\n    function TrelloImportService(resources) {\n      this.resources = resources;\n      this.projects = Immutable.List();\n      this.projectUsers = Immutable.List();\n      this.token = null;\n    }\n\n    TrelloImportService.prototype.setToken = function(token) {\n      return this.token = token;\n    };\n\n    TrelloImportService.prototype.fetchProjects = function() {\n      return this.resources.trelloImporter.listProjects(this.token).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    TrelloImportService.prototype.fetchUsers = function(projectId) {\n      return this.resources.trelloImporter.listUsers(this.token, projectId).then((function(_this) {\n        return function(users) {\n          return _this.projectUsers = users;\n        };\n      })(this));\n    };\n\n    TrelloImportService.prototype.importProject = function(name, description, projectId, userBindings, keepExternalReference, isPrivate) {\n      return this.resources.trelloImporter.importProject(this.token, name, description, projectId, userBindings, keepExternalReference, isPrivate);\n    };\n\n    TrelloImportService.prototype.getAuthUrl = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          return _this.resources.trelloImporter.getAuthUrl().then(function(response) {\n            _this.authUrl = response.data.url;\n            return resolve(_this.authUrl);\n          });\n        };\n      })(this));\n    };\n\n    TrelloImportService.prototype.authorize = function(verifyCode) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          return _this.resources.trelloImporter.authorize(verifyCode).then((function(response) {\n            _this.token = response.data.token;\n            return resolve(_this.token);\n          }), function(error) {\n            return reject(new Error(error.status));\n          });\n        };\n      })(this));\n    };\n\n    return TrelloImportService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgTrelloImportService\", TrelloImportService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: warning-user-import.directive.coffee\n */\n\n(function() {\n  var WarningUserImportDirective;\n\n  WarningUserImportDirective = function(lightboxService, lightboxKeyboardNavigationService) {\n    return {\n      link: function(scope, el, attr) {\n        return scope.$watch('visible', function(visible) {\n          if (visible && !el.hasClass('open')) {\n            return lightboxService.open(el, scope.onClose).then(function() {\n              el.find('input').focus();\n              return lightboxKeyboardNavigationService.init(el);\n            });\n          } else if (!visible && el.hasClass('open')) {\n            return lightboxService.close(el);\n          }\n        });\n      },\n      templateUrl: \"projects/create/warning-user-import-lightbox/warning-user-import-lightbox.html\",\n      scope: {\n        visible: '<',\n        onClose: '&',\n        onConfirm: '&'\n      }\n    };\n  };\n\n  WarningUserImportDirective.$inject = ['lightboxService', 'lightboxKeyboardNavigationService'];\n\n  angular.module(\"taigaProjects\").directive(\"tgWarningUserImportLightbox\", WarningUserImportDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\"];\n\n    function ProjectsListingController(currentUserService) {\n      this.currentUserService = currentUserService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function() {\n      var ctx;\n      if (!this.project) {\n        return null;\n      }\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      return {\n        title: this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx),\n        description: this.project.get(\"description\")\n      };\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\"];\n\n    function ProjectsService(rs, projectUrl) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n    }\n\n    ProjectsService.prototype.create = function(data) {\n      return this.rs.projects.create(data);\n    };\n\n    ProjectsService.prototype.duplicate = function(projectId, data) {\n      return this.rs.projects.duplicate(projectId, data);\n    };\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      return project;\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\", \"tgErrorHandlingService\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService, errorHandlingService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n      this.errorHandlingService = errorHandlingService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.errorHandlingService.notfound();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      this.loadingAccept = true;\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingAccept = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      this.loadingReject = true;\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"home\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingReject = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId, from_comment) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      if (from_comment === void 0) {\n        from_comment = false;\n      }\n      params = {\n        object_id: objectId,\n        project: projectId,\n        from_comment: from_comment\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file, from_comment) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      data.append(\"from_comment\", from_comment);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: epics-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"epics\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.list = function(projectId, page) {\n      var params, url;\n      if (page == null) {\n        page = 0;\n      }\n      url = urlsService.resolve(\"epics\");\n      params = {\n        project: projectId,\n        page: page\n      };\n      return http.get(url, params).then(function(result) {\n        return {\n          list: Immutable.fromJS(result.data),\n          headers: result.headers\n        };\n      });\n    };\n    service.patch = function(id, patch) {\n      var url;\n      url = urlsService.resolve(\"epics\") + (\"/\" + id);\n      return http.patch(url, patch).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.post = function(params) {\n      var url;\n      url = urlsService.resolve(\"epics\");\n      return http.post(url, params).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.reorder = function(id, data, setOrders) {\n      var options, url;\n      url = urlsService.resolve(\"epics\") + (\"/\" + id);\n      options = {\n        \"headers\": {\n          \"set-orders\": JSON.stringify(setOrders)\n        }\n      };\n      return http.patch(url, data, null, options).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.addRelatedUserstory = function(epicId, userstoryId) {\n      var params, url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId);\n      params = {\n        user_story: userstoryId,\n        epic: epicId\n      };\n      return http.post(url, params);\n    };\n    service.reorderRelatedUserstory = function(epicId, userstoryId, data, setOrders) {\n      var options, url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId) + (\"/\" + userstoryId);\n      options = {\n        \"headers\": {\n          \"set-orders\": JSON.stringify(setOrders)\n        }\n      };\n      return http.patch(url, data, null, options);\n    };\n    service.bulkCreateRelatedUserStories = function(epicId, projectId, bulk_userstories) {\n      var params, url;\n      url = urlsService.resolve(\"epic-related-userstories-bulk-create\", epicId);\n      params = {\n        bulk_userstories: bulk_userstories,\n        project_id: projectId\n      };\n      return http.post(url, params);\n    };\n    service.deleteRelatedUserstory = function(epicId, userstoryId) {\n      var url;\n      url = urlsService.resolve(\"epic-related-userstories\", epicId) + (\"/\" + userstoryId);\n      return http[\"delete\"](url);\n    };\n    return function() {\n      return {\n        \"epics\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgEpicsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/importers.coffee\n */\n\n(function() {\n  var AsanaResource, GithubResource, JiraResource, TrelloResource, module, taiga;\n\n  taiga = this.taiga;\n\n  TrelloResource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getAuthUrl = function(url) {\n      url = urlsService.resolve(\"importers-trello-auth-url\");\n      return http.get(url);\n    };\n    service.authorize = function(verifyCode) {\n      var url;\n      url = urlsService.resolve(\"importers-trello-authorize\");\n      return http.post(url, {\n        code: verifyCode\n      });\n    };\n    service.listProjects = function(token) {\n      var url;\n      url = urlsService.resolve(\"importers-trello-list-projects\");\n      return http.post(url, {\n        token: token\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.listUsers = function(token, projectId) {\n      var url;\n      url = urlsService.resolve(\"importers-trello-list-users\");\n      return http.post(url, {\n        token: token,\n        project: projectId\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.importProject = function(token, name, description, projectId, userBindings, keepExternalReference, isPrivate) {\n      var data, url;\n      url = urlsService.resolve(\"importers-trello-import-project\");\n      data = {\n        token: token,\n        name: name,\n        description: description,\n        project: projectId,\n        users_bindings: userBindings.toJS(),\n        keep_external_reference: keepExternalReference,\n        is_private: isPrivate,\n        template: \"kanban\"\n      };\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"trelloImporter\": service\n      };\n    };\n  };\n\n  TrelloResource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  JiraResource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getAuthUrl = function(jira_url) {\n      var url;\n      url = urlsService.resolve(\"importers-jira-auth-url\") + \"?url=\" + jira_url;\n      return http.get(url);\n    };\n    service.authorize = function(oauth_verifier) {\n      var url;\n      url = urlsService.resolve(\"importers-jira-authorize\");\n      return http.post(url, {\n        oauth_verifier: oauth_verifier\n      });\n    };\n    service.listProjects = function(jira_url, token) {\n      var url;\n      url = urlsService.resolve(\"importers-jira-list-projects\");\n      return http.post(url, {\n        url: jira_url,\n        token: token\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.listUsers = function(jira_url, token, projectId) {\n      var url;\n      url = urlsService.resolve(\"importers-jira-list-users\");\n      return http.post(url, {\n        url: jira_url,\n        token: token,\n        project: projectId\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.importProject = function(jira_url, token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType, importerType) {\n      var data, projectTemplate, url;\n      url = urlsService.resolve(\"importers-jira-import-project\");\n      projectTemplate = \"kanban\";\n      if (projectType !== \"kanban\") {\n        projectTemplate = \"scrum\";\n      }\n      data = {\n        url: jira_url,\n        token: token,\n        name: name,\n        description: description,\n        project: projectId,\n        users_bindings: userBindings.toJS(),\n        keep_external_reference: keepExternalReference,\n        is_private: isPrivate,\n        project_type: projectType,\n        importer_type: importerType,\n        template: projectTemplate\n      };\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"jiraImporter\": service\n      };\n    };\n  };\n\n  JiraResource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  GithubResource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getAuthUrl = function(callbackUri) {\n      var url;\n      url = urlsService.resolve(\"importers-github-auth-url\") + \"?uri=\" + callbackUri;\n      return http.get(url);\n    };\n    service.authorize = function(code) {\n      var url;\n      url = urlsService.resolve(\"importers-github-authorize\");\n      return http.post(url, {\n        code: code\n      });\n    };\n    service.listProjects = function(token) {\n      var url;\n      url = urlsService.resolve(\"importers-github-list-projects\");\n      return http.post(url, {\n        token: token\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.listUsers = function(token, projectId) {\n      var url;\n      url = urlsService.resolve(\"importers-github-list-users\");\n      return http.post(url, {\n        token: token,\n        project: projectId\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.importProject = function(token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType) {\n      var data, url;\n      url = urlsService.resolve(\"importers-github-import-project\");\n      data = {\n        token: token,\n        name: name,\n        description: description,\n        project: projectId,\n        users_bindings: userBindings.toJS(),\n        keep_external_reference: keepExternalReference,\n        is_private: isPrivate,\n        template: projectType\n      };\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"githubImporter\": service\n      };\n    };\n  };\n\n  GithubResource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  AsanaResource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getAuthUrl = function() {\n      var url;\n      url = urlsService.resolve(\"importers-asana-auth-url\");\n      return http.get(url);\n    };\n    service.authorize = function(code) {\n      var url;\n      url = urlsService.resolve(\"importers-asana-authorize\");\n      return http.post(url, {\n        code: code\n      });\n    };\n    service.listProjects = function(token) {\n      var url;\n      url = urlsService.resolve(\"importers-asana-list-projects\");\n      return http.post(url, {\n        token: token\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.listUsers = function(token, projectId) {\n      var url;\n      url = urlsService.resolve(\"importers-asana-list-users\");\n      return http.post(url, {\n        token: token,\n        project: projectId\n      }).then(function(response) {\n        return Immutable.fromJS(response.data);\n      });\n    };\n    service.importProject = function(token, name, description, projectId, userBindings, keepExternalReference, isPrivate, projectType) {\n      var data, url;\n      url = urlsService.resolve(\"importers-asana-import-project\");\n      data = {\n        token: token,\n        name: name,\n        description: description,\n        project: projectId,\n        users_bindings: userBindings.toJS(),\n        keep_external_reference: keepExternalReference,\n        is_private: isPrivate,\n        template: projectType\n      };\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"asanaImporter\": service\n      };\n    };\n  };\n\n  AsanaResource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTrelloImportResource\", TrelloResource);\n\n  module.factory(\"tgJiraImportResource\", JiraResource);\n\n  module.factory(\"tgGithubImportResource\", GithubResource);\n\n  module.factory(\"tgAsanaImportResource\", AsanaResource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.create = function(data) {\n      var url;\n      url = urlsService.resolve('projects');\n      return http.post(url, JSON.stringify(data)).then((function(_this) {\n        return function(result) {\n          return Immutable.fromJS(result.data);\n        };\n      })(this));\n    };\n    service.duplicate = function(projectId, data) {\n      var members, params, url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId + \"/duplicate\";\n      members = data.users.map((function(_this) {\n        return function(member) {\n          return {\n            \"id\": member\n          };\n        };\n      })(this));\n      params = {\n        \"name\": data.name,\n        \"description\": data.description,\n        \"is_private\": data.is_private,\n        \"users\": members\n      };\n      return http.post(url, params);\n    };\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.contactProject = function(projectId, message) {\n      var params, url;\n      params = {\n        project: projectId,\n        comment: message\n      };\n      url = urlsService.resolve(\"project-contact\");\n      return http.post(url, params);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\", \"tgWikiHistory\", \"tgEpicsResource\", \"tgTrelloImportResource\", \"tgJiraImportResource\", \"tgGithubImportResource\", \"tgAsanaImportResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warn(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId, excludeProjectId) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      params = {};\n      if (excludeProjectId != null) {\n        params.exclude_project = excludeProjectId;\n      }\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getMySelf = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-myself\", userId);\n      params = {};\n      params.status = 'new,in-progress,ready,doing';\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      if (page != null) {\n        params.page = page;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWeekly = function(userId, start, end) {\n      var params, url;\n      url = urlsService.resolve(\"user-weekly\");\n      params = {};\n      params.user_id = userId;\n      if (start) {\n        params.start = start;\n      }\n      if (end) {\n        params.end = end;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getCalendarUrl = function() {\n      var url;\n      url = urlsService.resolve(\"user-calendar\");\n      return url;\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (pagination == null) {\n        pagination = false;\n      }\n      url = urlsService.resolve(\"userstories\");\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-disable-pagination\": \"1\"\n          }\n        };\n      }\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.listAllInProject = function(projectId) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        project: projectId\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.listInEpic = function(epicIid) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        epic: epicIid,\n        order_by: 'epic_order',\n        include_tasks: true\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getWikiHistory = function(wikiId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"history/wiki\", wikiId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, null, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"wikiHistory\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgWikiHistory\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      this.objId = objId;\n      this.projectId = projectId;\n      this.ftype = type;\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type, from_comment) {\n      var promise;\n      if (from_comment == null) {\n        from_comment = false;\n      }\n      console.log(objId, projectId, type);\n      promise = this.rs.attachments.create(type, projectId, objId, file, from_comment);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: avatar.service.coffee\n */\n\n(function() {\n  var AvatarService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  AvatarService = (function() {\n    function AvatarService(config) {\n      var COLORS, IMAGES;\n      this.config = config;\n      IMAGES = [\"/\" + window._version + \"/images/user-avatars/user-avatar-01.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-02.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-03.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-04.png\", \"/\" + window._version + \"/images/user-avatars/user-avatar-05.png\"];\n      COLORS = [\"rgba( 178, 176, 204, 1 )\", \"rgba( 183, 203, 131, 1 )\", \"rgba( 210, 198, 139, 1 )\", \"rgba( 214, 161, 212, 1 )\", \"rgba( 247, 154, 154, 1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    AvatarService.prototype.getDefault = function(key) {\n      var idx, logo;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    AvatarService.prototype.getUnnamed = function() {\n      return {\n        url: \"/\" + window._version + \"/images/unnamed.png\"\n      };\n    };\n\n    AvatarService.prototype.getAvatar = function(user, type) {\n      var avatarParamName, gravatar, logo, logoUrl, photo, root;\n      if (!user) {\n        return this.getUnnamed();\n      }\n      avatarParamName = 'photo';\n      if (type === 'avatarBig') {\n        avatarParamName = 'big_photo';\n      }\n      photo = null;\n      if (user instanceof Immutable.Map) {\n        gravatar = user.get('gravatar_id');\n        photo = user.get(avatarParamName);\n      } else {\n        gravatar = user.gravatar_id;\n        photo = user[avatarParamName];\n      }\n      if (!gravatar) {\n        return this.getUnnamed();\n      }\n      if (photo) {\n        return {\n          url: photo\n        };\n      } else if (location.host.indexOf('localhost') !== -1 || !this.config.get(\"gravatar\", true)) {\n        root = location.protocol + '//' + location.host;\n        logo = this.getDefault(gravatar);\n        return {\n          url: root + logo.src,\n          bg: logo.color\n        };\n      } else {\n        root = location.protocol + '//' + location.host;\n        logo = this.getDefault(gravatar);\n        logoUrl = encodeURIComponent(root + logo.src);\n        return {\n          url: 'https://www.gravatar.com/avatar/' + gravatar + \"?s=200&d=\" + logoUrl,\n          bg: logo.color\n        };\n      }\n    };\n\n    return AvatarService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAvatarService\", [\"$tgConfig\", AvatarService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var CheckPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  CheckPermissionsService = (function() {\n    CheckPermissionsService.$inject = [\"tgProjectService\"];\n\n    function CheckPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    CheckPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return CheckPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", CheckPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (!this.isAuthenticated()) {\n        return;\n      }\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project',\n          current: user.get('total_private_projects'),\n          max: user.get('max_private_projects')\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project',\n          current: user.get('total_public_projects'),\n          max: user.get('max_public_projects')\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canAddMembersPublicProject = function(totalMembers) {\n      var user;\n      user = this.getUser();\n      if (user.get('max_memberships_public_projects') !== null && totalMembers > user.get('max_memberships_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_members_public_projects',\n          type: 'public_project',\n          current: totalMembers,\n          max: user.get('max_memberships_public_projects')\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canAddMembersPrivateProject = function(totalMembers) {\n      var user;\n      user = this.getUser();\n      if (user.get('max_memberships_private_projects') !== null && totalMembers > user.get('max_memberships_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_members_private_projects',\n          type: 'private_project',\n          current: totalMembers,\n          max: user.get('max_memberships_private_projects')\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var membersResult, result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        membersResult = this.canAddMembersPrivateProject(project.get('total_memberships'));\n        if (!membersResult.valid) {\n          return membersResult;\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        membersResult = this.canAddMembersPublicProject(project.get('total_memberships'));\n        if (!membersResult.valid) {\n          return membersResult;\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: error-handling.service.coffee\n */\n\n(function() {\n  var ErrorHandlingService, taiga;\n\n  taiga = this.taiga;\n\n  ErrorHandlingService = (function() {\n    ErrorHandlingService.$inject = [\"$rootScope\"];\n\n    function ErrorHandlingService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    ErrorHandlingService.prototype.init = function() {\n      return this.rootScope.errorHandling = {};\n    };\n\n    ErrorHandlingService.prototype.notfound = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.notfound = true;\n    };\n\n    ErrorHandlingService.prototype.error = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.error = true;\n    };\n\n    ErrorHandlingService.prototype.permissionDenied = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.permissionDenied = true;\n    };\n\n    ErrorHandlingService.prototype.block = function() {\n      this.rootScope.errorHandling.showingError = true;\n      return this.rootScope.errorHandling.blocked = true;\n    };\n\n    return ErrorHandlingService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgErrorHandlingService\", ErrorHandlingService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\", \"tgUserActivityService\", \"$interval\"];\n\n    function ProjectService(projectsService, xhrError, userActivityService, interval) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this.userActivityService = userActivityService;\n      this.interval = interval;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n      if (!window.localStorage.e2e) {\n        this.autoRefresh();\n      }\n    }\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.autoRefresh = function() {\n      var intervalId;\n      intervalId = this.interval((function(_this) {\n        return function() {\n          return _this.fetchProject();\n        };\n      })(this), 60 * 10 * 1000);\n      this.userActivityService.onInactive((function(_this) {\n        return function() {\n          return _this.interval.cancel(intervalId);\n        };\n      })(this));\n      return this.userActivityService.onActive((function(_this) {\n        return function() {\n          _this.fetchProject();\n          return _this.autoRefresh();\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      if (!this.project) {\n        return;\n      }\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.isEpicsDashboardEnabled = function() {\n      return this._project.get(\"is_epics_activated\");\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-activity.service.coffee\n */\n\n(function() {\n  var UserActivityService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  UserActivityService = (function() {\n    UserActivityService.$inject = ['$timeout'];\n\n    UserActivityService.prototype.idleTimeout = 60 * 5 * 1000;\n\n    function UserActivityService(timeout) {\n      this.timeout = timeout;\n      if (window.localStorage.e2e) {\n        return null;\n      }\n      window.addEventListener('mousemove', this.resetTimer.bind(this), false);\n      window.addEventListener('mousedown', this.resetTimer.bind(this), false);\n      window.addEventListener('keypress', this.resetTimer.bind(this), false);\n      window.addEventListener('mousewheel', this.resetTimer.bind(this), false);\n      window.addEventListener('touchmove', this.resetTimer.bind(this), false);\n      this.subscriptionsActive = [];\n      this.subscriptionsInactive = [];\n      this.isActive = true;\n      this.startTimer();\n    }\n\n    UserActivityService.prototype.startTimer = function() {\n      return this.timerId = this.timeout(this._fireInactive.bind(this), this.idleTimeout);\n    };\n\n    UserActivityService.prototype.resetTimer = function() {\n      if (!this.isActive) {\n        this._fireActive();\n      }\n      this.timeout.cancel(this.timerId);\n      this.startTimer();\n      return this.isActive = true;\n    };\n\n    UserActivityService.prototype.onActive = function(cb) {\n      this.subscriptionsActive.push(cb);\n      return this._unSubscriptionsActive.bind(this, cb);\n    };\n\n    UserActivityService.prototype.onInactive = function(cb) {\n      this.subscriptionsInactive.push(cb);\n      return this._unSubscriptionsInactive.bind(this, cb);\n    };\n\n    UserActivityService.prototype._fireActive = function() {\n      return this.subscriptionsActive.forEach(function(it) {\n        return it();\n      });\n    };\n\n    UserActivityService.prototype._fireInactive = function() {\n      this.isActive = false;\n      return this.subscriptionsInactive.forEach(function(it) {\n        return it();\n      });\n    };\n\n    UserActivityService.prototype._unSubscriptionsActive = function(cb) {\n      return this.subscriptionsActive = this.subscriptionsActive.filter(function(fn) {\n        return fn !== cb;\n      });\n    };\n\n    UserActivityService.prototype._unSubscriptionsInactive = function(cb) {\n      return this.subscriptionsInactive = this.subscriptionsInactive.filter(function(fn) {\n        return fn !== cb;\n      });\n    };\n\n    return UserActivityService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgUserActivityService\", UserActivityService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId, excludeProjectId) {\n      return this.rs.users.getContacts(userId, excludeProjectId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getMySelf = function(userId, pageNumber, type, q) {\n      return this.rs.users.getMySelf(userId, pageNumber, type, q);\n    };\n\n    UserService.prototype.getWeekly = function(userId, start, end) {\n      return this.rs.users.getWeekly(userId, start, end);\n    };\n\n    UserService.prototype.getCalendarUrl = function() {\n      return this.rs.users.getCalendarUrl();\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"tgErrorHandlingService\"];\n\n    function xhrError(q, errorHandlingService) {\n      this.q = q;\n      this.errorHandlingService = errorHandlingService;\n    }\n\n    xhrError.prototype.notFound = function() {\n      return this.errorHandlingService.notfound();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      return this.errorHandlingService.permissionDenied();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED',\n      'color': 'COMMON.FIELDS.COLOR'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      related_us_name: function(timeline, event) {\n        var obj, text, url;\n        obj = timeline.getIn([\"data\", \"userstory\"]);\n        url = \"project-userstories-detail:project=timeline.getIn(['data', 'userstory', 'project', 'slug']),ref=timeline.getIn(['data', 'userstory', 'ref'])\";\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      epic_name: function(timeline, event) {\n        var obj, text, url;\n        obj = timeline.getIn([\"data\", \"epic\"]);\n        url = \"project-epics-detail:project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['data', 'epic', 'ref'])\";\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"],\n        \"epic\": [\"project-epics-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      var span;\n      title = title || text;\n      span = $('<span>').attr('ng-non-bindable', true).text(text);\n      return $('<a>').attr('tg-nav', url).attr('title', title).append(span).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'create';\n        },\n        key: 'TIMELINE.EPIC_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'relateduserstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.EPIC_RELATED_USERSTORY_CREATED',\n        translate_params: ['username', 'project_name', 'related_us_name', 'epic_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'epic';\n        },\n        key: 'TIMELINE.NEW_COMMENT_EPIC',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.EPIC_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'color';\n        },\n        key: 'TIMELINE.EPIC_UPDATED_WITH_NEW_COLOR',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'epic' && event.type === 'change';\n        },\n        key: 'TIMELINE.EPIC_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2017 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2017 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2017 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2017 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2017 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone', 'color'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: isolate-click.directive.coffee\n */\n\n(function() {\n  var IsolateClickDirective;\n\n  IsolateClickDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {\n      return el.on('click', (function(_this) {\n        return function(e) {\n          return e.stopPropagation();\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  angular.module(\"taigaUtils\").directive(\"tgIsolateClick\", IsolateClickDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryDiffDirective, module;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryDiffDirective = function() {\n    return {\n      templateUrl: \"wiki/history/wiki-history-diff.html\",\n      scope: {\n        key: \"<\",\n        diff: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgWikiHistoryDiff\", WikiHistoryDiffDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryEntryDirective, module;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryEntryDirective = function() {\n    var link;\n    link = function(scope, el, attr) {\n      return scope.singleHistoryEntry = scope.historyEntry.toJS();\n    };\n    return {\n      link: link,\n      templateUrl: \"wiki/history/wiki-history-entry.html\",\n      scope: {\n        historyEntry: \"<\"\n      }\n    };\n  };\n\n  module.directive(\"tgWikiHistoryEntry\", WikiHistoryEntryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.controller.coffee\n */\n\n(function() {\n  var WikiHistoryController, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaWikiHistory\");\n\n  WikiHistoryController = (function() {\n    WikiHistoryController.$inject = [\"tgWikiHistoryService\"];\n\n    function WikiHistoryController(wikiHistoryService) {\n      this.wikiHistoryService = wikiHistoryService;\n      taiga.defineImmutableProperty(this, 'historyEntries', (function(_this) {\n        return function() {\n          return _this.wikiHistoryService.historyEntries;\n        };\n      })(this));\n    }\n\n    WikiHistoryController.prototype.initializeHistoryEntries = function(wikiId) {\n      if (wikiId) {\n        this.wikiHistoryService.setWikiId(wikiId);\n      }\n      return this.wikiHistoryService.loadHistoryEntries();\n    };\n\n    return WikiHistoryController;\n\n  })();\n\n  module.controller(\"WikiHistoryCtrl\", WikiHistoryController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.directive.coffee\n */\n\n(function() {\n  var WikiHistoryDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.wikiId', function(value) {\n        return ctrl.initializeHistoryEntries(value);\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        wikiId: \"<\"\n      },\n      controller: \"WikiHistoryCtrl\",\n      controllerAs: \"vm\",\n      templateUrl: \"wiki/history/wiki-history.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiHistory\", WikiHistoryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2017 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: wiki-history.service.coffee\n */\n\n(function() {\n  var WikiHistoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module('taigaWikiHistory');\n\n  WikiHistoryService = (function(superClass) {\n    extend(WikiHistoryService, superClass);\n\n    WikiHistoryService.$inject = [\"tgResources\", \"tgXhrErrorService\"];\n\n    function WikiHistoryService(rs, xhrError) {\n      this.rs = rs;\n      this.xhrError = xhrError;\n      this._wikiId = null;\n      this._historyEntries = Immutable.List();\n      taiga.defineImmutableProperty(this, \"wikiId\", (function(_this) {\n        return function() {\n          return _this._wikiId;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"historyEntries\", (function(_this) {\n        return function() {\n          return _this._historyEntries;\n        };\n      })(this));\n    }\n\n    WikiHistoryService.prototype.setWikiId = function(wikiId) {\n      this._wikiId = wikiId;\n      return this._historyEntries = Immutable.List();\n    };\n\n    WikiHistoryService.prototype.loadHistoryEntries = function() {\n      if (!this._wikiId) {\n        return;\n      }\n      return this.rs.wikiHistory.getWikiHistory(this._wikiId).then((function(_this) {\n        return function(historyEntries) {\n          if (historyEntries.size) {\n            return _this._historyEntries = historyEntries.reverse();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    _;\n\n    return WikiHistoryService;\n\n  })(taiga.Service);\n\n  module.service(\"tgWikiHistoryService\", WikiHistoryService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}